<html>

<head>
    <title>Note</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        h3 {
            font-family: Segoe UI;
            font-size: 21px;
            font-weight: normal;
            color: rgb(102, 102, 102);
        }

        label {
            color: rgb(102, 102, 102);
            font-size: 14px;
        }

        p {
            color: rgb(102, 102, 102);
        }

        body {
            border: 2px solid lightblue;
            font-family: Segoe UI;
            border-top-color: transparent;
        }


        #top {
            margin: 10px 10px;
        }

        #top p {
            font-size: 12px;
        }

        #main {
            margin: 10px 10px;
            width: inherit;
        }

        #title {
            width: 99%;
            height: 20px;
            color: rgb(102, 102, 102);
            font-family: "Segoe UI", Arial, Sans-Serif;
        }

        input[type="text"]:focus,
        textarea:focus {
            border: 1px solid lightblue;
        }

        #footer {
            margin: 20px 0px 0px 0px;
            width: inherit;
            height: 50px;
            background-color: #f8f8f8;
        }

        #text {
            width: 100%;
            height: 70%;
            overflow: hidden;
            color: rgb(102, 102, 102);
            font-family: "Segoe UI", Arial, Sans-Serif;
        }

        #done {
            float: right;
        }

        #fcontent {
            margin: 10px 10px;
            padding-top: 10px;
        }

        button,
        input[type="button"] {
            line-height: 16px;
            height: 20px;
            width: 84px;
            text-align: center;
            cursor: pointer;
            border-width: 1px;
            border-style: solid;
            background-repeat: repeat-x;
            padding-left: 5px;
            padding-right: 5px;
            font-size: 12px;
            color: #444444;
            background-color: #FFFFFF;
            height: 24px;
            font-family: Segoe UI, Tahoma, Arial;
            border: 1px solid #C6C6C6;
            background-image: none;
            margin-top: 10px;
            width: auto;
            min-width: 80px;
            white-space: nowrap;
        }

        button:hover,
        input[type="button"]:hover {
            background-color: #B1D6F0;
        }

        #fname {
            display: none;
        }

        #fname a {
            display: inline;
            color: #1160B7;
            text-decoration: none;
            font-size: 14px;
        }

        #cross {
            margin-left: 50px;
            text-decoration: none;
            cursor: pointer;
            vertical-align: bottom;
        }

        .loaderStyle {
            vertical-align: central;
            text-align: center;
            cursor: wait;
            background: #F0F0F0;
            font-size: 12px;
            position: absolute;
            display: none;
            left: 200px;
            top: 200px;
            width: 50px;
            height: 50px;
        }

        .loaderStyle img {
            margin-top: 10px;
            border: none;
        }
    </style>
    <script src="ClientGlobalContext.js.aspx"></script>
    <script src="bbo_SDK.REST.js"></script>
    <script>
        //debugger;
        var globelcontext = parent.Xrm.Utility.getGlobalContext();
        var param2 = "";
        var recordId = "";
        var FileName = "";
        var id = opener.parent.Xrm.Page.data.entity.getId();
        var nam = opener.parent.Xrm.Page.data.entity.getEntityName();
        var formName = opener.parent.Xrm.Page.ui.formSelector.getCurrentItem().getLabel();
        var entityname = opener.parent.Xrm.Page.data.entity.getEntityName();
        var universalid = "";
        var buffer = "";
        var opptitle = "";
        var res1 = "";

        function Onload() {
            gettitle();

            var url_string = window.location.href;
            var url = new URL(url_string);
            //console.log("URL "+url);
            //debugger;
            param2 = url.searchParams.get("data");
            var res1 = param2.match(/_CR/g);
            if (res1 != null && res1 != "") {
                var array = new Array();
                array = param2.split('_');
                param2 = array[0];
                param2 = param2.replace(/[""]/g, "");
                //param2 = ("\"" + param2 + "\"");
                universalid = param2.trim().toUpperCase();
            }
            // else if (param2 != null || param2 !== "") {
            //     param2 = param2.replace(/["]+/g, '');
            // }


            //console.log("Param "+param2);
            if(param2 === "TerminationProcess") {
                document.getElementById("lblDescription").style.display = "none";
                //document.getElementById('text').innerHTML='{{contract}}';
                document.getElementById('text').style.display = "none";
            }
            if (param2 === "Contract") {
                document.getElementById("lblDescription").style.display = "none";
                //document.getElementById('text').innerHTML='{{contract}}';
                document.getElementById('text').style.display = "none";
            }

            if (param2 === "ContractNDA") {
                document.getElementById("lblDescription").style.display = "none";
                //document.getElementById('text').innerHTML='{{contract}}';
                document.getElementById('text').style.display = "none";
            }

            if(param2 === "ProductContract") {
                document.getElementById("lblDescription").style.display = "none";
                //document.getElementById('text').innerHTML='{{contract}}';
                document.getElementById('text').style.display = "none";
            }
            if(param2 === "Approval") {
                document.getElementById("lblDescription").style.display = "none";
                //document.getElementById('text').innerHTML='{{contract}}';
                document.getElementById('text').style.display = "none";
            }

        }
        function gettitle() {
            var OPPID = "";
            var appid = "";
            if (nam === "ss_partner") {
                var partnerid = id.replace("{", "").replace("}", "");
                console.log("id is => " + partnerid);
                opener.parent.Xrm.WebApi.online.retrieveRecord("ss_partner", partnerid, "?$select=ss_name").then(
                    function success(result) {
                        console.log("success");
                        makepartnertitle(result);
                    },
                    function (error) {
                        var alertStrings = { confirmButtonLabel: "Ok", text: error.message, title: "" };
                        var alertOptions = { height: 120, width: 260 };
                        Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                            function success(result) {
                            },
                            function (error) {
                            }
                        );
                    }
                );
            }
            else if (nam === "ss_partneropprotunity") {
                var partneropp = id.replace("{", "").replace("}", "");
                console.log("id is => " + partnerid);
                opener.parent.Xrm.WebApi.online.retrieveRecord("ss_partneropprotunity", partneropp, "?$select=ss_name").then(
                    function success(result) {
                        console.log("success");
                        makepartnertitle(result);
                    },
                    function (error) {
                        var alertStrings = { confirmButtonLabel: "Ok", text: error.message, title: "" };
                        var alertOptions = { height: 120, width: 260 };
                        Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                            function success(result) {
                            },
                            function (error) {
                            }
                        );
                    }
                );
            }
            else if (nam === "account") {
                var new_name = opener.parent.Xrm.Page.getAttribute("name").getValue();
                var today = new Date();
                var dd = String(today.getDate()).padStart(2, '0');
                var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                var yyyy = today.getFullYear();

                today = mm + '/' + dd + '/' + yyyy;
                var finaltitle = new_name + " /CS/  " + today;
                document.getElementById("title").value = finaltitle;
            }
            else if(nam === "ss_approval" && formName === "Termination Process") {
                var new_name = opener.parent.Xrm.Page.getAttribute("ss_opportunityaccount").getValue()[0].name;
                var today = new Date();
                var dd = String(today.getDate()).padStart(2, '0');
                var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                var yyyy = today.getFullYear();

                today = mm + '/' + dd + '/' + yyyy;
                var finaltitle = new_name + " /CS/  " + today;
                document.getElementById("title").value = finaltitle;
            }
            else if(nam === "ss_saleschecklist") {
                var new_name = opener.parent.Xrm.Page.getAttribute("ss_opportunityaccount").getValue()[0].name;
                var today = new Date();
                var dd = String(today.getDate()).padStart(2, '0');
                var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                var yyyy = today.getFullYear();

                today = mm + '/' + dd + '/' + yyyy;
                var finaltitle = new_name + " /CS/  " + today;
                document.getElementById("title").value = finaltitle;
            }
            else {
                // if (nam === "account") {
                //     OPPID = universalid;
                //     console.log("ID is => " + universalid);
                // }
                if (nam === "ss_approval" || nam === "ss_saleschecklist") {
                    appid = id.replace("{", "").replace("}", "");
                    console.log("APP id => " + appid);
                }
                else {
                    OPPID = id.replace("{", "").replace("}", "");
                    console.log("OPP id => " + OPPID);
                }
                // console.log(id);

                var req = new XMLHttpRequest();
                req.open("GET", Xrm.Page.context.getClientUrl() + "/api/data/v9.1/opportunities(" + OPPID + ")?$select=name,_parentaccountid_value,ss_autocsnumber,ss_contractstartdate", true);
                req.setRequestHeader("OData-MaxVersion", "4.0");
                req.setRequestHeader("OData-Version", "4.0");
                req.setRequestHeader("Accept", "application/json");
                req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
                req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
                req.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        req.onreadystatechange = null;
                        if (this.status === 200) {
                            var result = JSON.parse(this.response);
                            if (param2 === "Contract") {
                                makeContractTitle(result);
                            }
                            else if (param2 === "Approval") {
                                makeapprovaltitle();
                            }
                            else if (param2 != null || param2 != "") {
                                makeContractTitle(result);
                            }
                            else {
                                document.getElementById("title").value = result["name"];
                            }


                        } else {
                            //Xrm.Utility.alertDialog(this.statusText);
                            var alertStrings = { confirmButtonLabel: "Ok", text: this.errorMessage, title: "" };
                            var alertOptions = { height: 120, width: 260 };
                            Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                                function success(result) {
                                    //console.log("Alert dialog closed");
                                },
                                function (error) {
                                    //console.log(error.message);
                                }
                            );
                        }
                    }
                };
                req.send();
            }
        }
        function makepartnertitle(result) {
            var new_name = result["ss_name"];
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = today.getFullYear();

            today = mm + '/' + dd + '/' + yyyy;
            var finaltitle = new_name + " /CS/  " + today;
            document.getElementById("title").value = finaltitle;
        }
        function makeapprovaltitle() {
            var finaltitle = "";
            var name = opener.parent.Xrm.Page.getAttribute("ss_opportunitytopic").getValue();
            finaltitle += name + " - ";
            var appaccount = opener.parent.Xrm.Page.getAttribute("ss_opportunityaccount").getValue()[0].name;
            finaltitle += appaccount + " - ";

            var cdate = new Date();
            cdate = cdate.getFullYear();
            finaltitle = finaltitle + " /Approval  " + cdate;
            document.getElementById("title").value = finaltitle;

        }
        function makeContractTitle(result) {
            debugger;
            var name = result["name"];
            var ParentCompanyName = result["_parentaccountid_value@OData.Community.Display.V1.FormattedValue"];
            var StartDate = result["ss_contractstartdate@OData.Community.Display.V1.FormattedValue"];
            var contractnumber = result["ss_autocsnumber"];
            var cdate = new Date();
            cdate = cdate.getFullYear();
            var finaltitle = "";
            if (ParentCompanyName !== undefined) {
                finaltitle = finaltitle + ParentCompanyName + " - ";
            }
            if (name !== undefined) {
                finaltitle = finaltitle + name;
            }
            if (StartDate !== undefined) {
                StartDate = StartDate.toString().replace(/\//g, '-');
                finaltitle = finaltitle + " / Start Date " + StartDate;
            }
            if (contractnumber !== undefined) {
                finaltitle = finaltitle + " / CS " + contractnumber;
            }
            //var finaltitle = ParentCompanyName+"/"+cdate+"/"+name+"/"+StartDate+"/"+contractnumber;
            document.getElementById("title").value = finaltitle;
        }
        var vals = new Array();
        if (location.search !== "") {
            vals = location.search.substr(1).split("&");
            for (var i in vals) {
                vals[i] = vals[i].replace(/\+/g, " ").split("=");
            }
            //look for the parameter named 'data'
            var found = false;
            for (var i in vals) {
                if (vals[i][0].toLowerCase() === "data") {
                    parseDataValue(vals[i][1]);
                    found = true;
                    break;
                }
            }

        }
        function parseDataValue(datavalue) {
            if (datavalue !== "") {
                var vals = new Array();
                vals = decodeURIComponent(datavalue).split("&");
                for (var i in vals) {
                    vals[i] = vals[i].replace(/\+/g, " ").split("=");
                }
            }
            recordId = vals[0];
            recordId = recordId.toString();
            recordId = recordId.replace('"', '');
            recordId = recordId.replace('"', '');
            var res = recordId.match(/_CR/g);
            if (recordId === "Contract") {
                recordId = "";
            }
            else if (recordId === "Approval") {
                recordId = "";
            }
            else if (recordId === "ContractNDA") {
                recordId = "";
            }
            else if(recordId === "ProductContract") {
                recordId = "";
            }
            else if(recordId === "TerminationProcess") {
                recordId = "";
            }
            else if (res != null && res != "") {
                recordId = "";
            }

            //   function myFunction(){
            //     document.getElementById("lblDescription").style.display="none"  
            //     document.getElementById("text").style.display="none"
            //     document.getElementById("text").innerHTML="{{contract}}";
            //     recordId=null;
            //   }


            //console.log("recordId in + Case"+ recordId);
            if (recordId) {
                var req = new XMLHttpRequest();
                req.open("GET", Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.0/annotations(" + recordId + ")?$select=filename,notetext,subject", true);
                req.setRequestHeader("OData-MaxVersion", "4.0");
                req.setRequestHeader("OData-Version", "4.0");
                req.setRequestHeader("Accept", "application/json");
                req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
                req.setRequestHeader("Prefer", "odata.include-annotations=*");
                req.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        req.onreadystatechange = null;
                        if (this.status === 200) {
                            var result = JSON.parse(this.response);
                            if (result["filename"]) {
                                FileName = result["filename"];
                            }
                            if (result["notetext"]) {
                                if (result["notetext"] === "{{Contract--" || result["notetext"] === "{{Partner--") {
                                    document.getElementById("text").style.display = "none";
                                    document.getElementById("lblDescription").style.display = "none";
                                    document.getElementById("fcontent").style.marginTop = "425px";
                                }
                                else { document.getElementById("text").value = result["notetext"]; }
                            }
                            else
                                document.getElementById("text").value = "";

                            if (result["subject"])
                                document.getElementById("title").value = result["subject"];
                            //else
                            //    document.getElementById("title").value = "";

                            if (FileName != null && FileName !== "") {
                                document.getElementById("fname").style.display = "inline";
                                document.getElementById("filename").innerHTML = FileName;
                                document.getElementById("battach").style.display = "none";

                            }
                        }
                        else {
                            alert(this.statusText);
                        }
                    }
                };
                req.send();
            }

        }


        function _arrayBufferToBase64(buffer) { // Convert Array Buffer to Base 64 string
            var binary = '';
            var bytes = new Uint8Array(buffer);
            var len = bytes.byteLength;
            for (var i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return window.btoa(binary);
        }
        function createNote(title, description, docBody, fName, mType) {
            var entity1 = new Object();
            if (docBody != null & fName != null & mType != null) {
                entity1["documentbody"] = docBody;
                entity1["filename"] = fName;
                entity1["mimetype"] = mType;
            }
            if (nam === "opportunity") {
                entity1["objectid_" + nam + "@odata.bind"] = "/opportunities(" + id.replace("{", "").replace("}", "") + ")";
            }
            else if (nam === "account") {
                entity1["objectid_" + "opportunity" + "@odata.bind"] = "/opportunities(" + universalid + ")";
            }
            else if (nam === "ss_approval") {
                entity1["objectid_" + nam + "@odata.bind"] = "/ss_approvals(" + id.replace("{", "").replace("}", "") + ")";
            }
            else if (nam === "ss_partner") {
                entity1["objectid_" + nam + "@odata.bind"] = "/" + nam + "s(" + id.replace("{", "").replace("}", "") + ")";
            }
            else if (nam === "ss_partneropprotunity") {
                entity1["objectid_" + nam + "@odata.bind"] = "/ss_partneropprotunities(" + id.replace("{", "").replace("}", "") + ")";
            }
            else if (nam === "ss_saleschecklist") {
                entity1["objectid_" + nam + "@odata.bind"] = "/ss_saleschecklists(" + id.replace("{", "").replace("}", "") + ")";
            }
            else {
                entity1["objectid_" + nam + "@odata.bind"] = "/" + nam + "s(" + id.replace("{", "").replace("}", "") + ")";
            }
            entity1["subject"] = title;
            entity1["notetext"] = description; // opportunititys // oppourtunities


            var req = new XMLHttpRequest();
            req.open("POST", globelcontext.getClientUrl() + "/api/data/v8.0/annotations", true);
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    req.onreadystatechange = null;
                    if (this.status === 204) {
                        var uri = this.getResponseHeader("OData-EntityId");
                        var regExp = /\(([^)]+)\)/;
                        var matches = regExp.exec(uri);
                        var newEntityId = matches[1];
                        //opener.parent.Xrm.Page.ui.refreshRibbon();
                        // console.log("create, opener.parent.Xrm.Page.data.refresh()");
                        if(nam === "ss_approval") {
                           opener.parent.Xrm.Page.getAttribute("ss_notescheck").setValue(true);
                        }
                        // if(nam === "ss_approval") {
                        //         var entityFormOptions = {};
                        //         entityFormOptions["entityName"] = "ss_approval";
                        //         entityFormOptions["entityId"] = id.replace("{", "").replace("}", "");

                        //         // Open the form.
                        //         parent.Xrm.Navigation.openForm(entityFormOptions).then(
                        //             function (success) {
                        //                 //  console.log(success);
                        //             },
                        //             function (error) {
                        //                 //console.log(error);
                        //             });
                        //     }
                        
                        if (nam !== "account" && nam !== "ss_partner" && nam !== "ss_partneropprotunity" && nam !== "ss_saleschecklist") {
                            opener.RetrieveAnnotations(null);
                        }
                        //opener.parent.Xrm.Page.data.entity.refresh(); not
                        //window.parent.Xrm.Page.data.entity.refresh(); null
                        //opener.Xrm.Page.data.entity.refresh(); null
                        //parent.Xrm.Page.data.entity.refresh(); null
                        //Xrm.Page.data.refresh(); null
                        //opener.parent.Xrm.Page.data.refresh(); working
                        //opener.parent.Xrm.Page.ui.refreshRibbon();

                        // if(nam === "opportunity"){
                        // 	opener.parent.Xrm.Utility.openEntityForm("opportunity",id);
                        // }

                        ///alert("refreshed");
                        window.close();
                    }
                    else {
                        //    if(this.statusText==""){
                        //    alert("Create Entity record first to save Notes");
                        //    }
                        //    else{
                        alert(this.statusText);
                        //         }

                    }
                }
            };
            req.send(JSON.stringify(entity1));
        }

        function deleteAttachment() {
            if (FileName != null) {


                // V9.00 Confirm Dialog Changed by A.Jawad.

                var confirmStrings = { text: "The notes file will be deleted permanently.Do you want to continue?", title: "Confirm Deletion?", confirmButtonLabel: "Delete", cancelButtonLabel: "Cancel" };
                var confirmOptions = { height: 200, width: 450 };
                Xrm.Navigation.openConfirmDialog(confirmStrings, confirmOptions).then(
                    function (success) {
                        if (success.confirmed) {
                            showLoadingMessage();
                            var entity = {};
                            entity.filename = null;
                            entity.mimetype = null;
                            entity.documentbody = null;
                            var req = new XMLHttpRequest();
                            req.open("PATCH", Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.0/annotations(" + recordId + ")", true);
                            req.setRequestHeader("OData-MaxVersion", "4.0");
                            req.setRequestHeader("OData-Version", "4.0");
                            req.setRequestHeader("Accept", "application/json");
                            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
                            req.onreadystatechange = deleteAttachmentCallback;
                            req.send(JSON.stringify(entity));
                        }
                        else {
                            return;
                        }
                    });
            }
        }

        function deleteAttachmentCallback() {
            if (this.readyState === 4) {
                // req.onreadystatechange = null;
                if (this.status === 204) {
                    location.reload(true);
                    hideLoadingMessage();
                    //opener.parent.Xrm.Page.ui.refreshRibbon();
                    //alert("Delete");
                    opener.RetrieveAnnotations(null);
                    Xrm.Page.data.refresh();
                }
                else {
                    alert(this.statusText);
                }
            }


        }
        function errorMessage(error) {
            // Xrm.Utility.alertDialog(error.message, null);
            var alertStrings = { confirmButtonLabel: "Ok", text: this.statusText };
            var alertOptions = { height: 120, width: 260 };
            Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                function success(result) {
                    // console.log("Alert dialog closed");
                },
                function (error) {
                    //console.log(error.message);
                });
        }

        function save() {
            var file = document.getElementById("file").files[0];
            var subject = document.getElementById("title").value;
            if (param2 != null && formName === "Account") {
                var desc = "{{Letter--";
            }
            else if(param2 === "TerminationProcess" && formName === "Termination Process") {
                var desc = "{{TerminationProcess--";
            }
            else if (param2 === "Contract" && formName === "Information") {
                var desc = "{{NewPartner--";
            }
            else if (param2 === "ContractNDA" && formName === "Information") {
                var desc = "{{PartnerNDA--";
            }
            else if (param2.includes("Approval") && formName === "Compliance Approval Process") {
                var desc = "{{Approval--"
            }
            else if (param2 === "Contract" && formName === "Partner Opportunity") {
                var desc = "{{Partner--";
            }
            else if (param2 === "Contract" && formName === "Opportunity Partner") {
                var desc = "{{PartnerOpp--";
            }
            else if (param2 === "Contract" && formName !== "Partner Opportunity") {
                var desc = "{{Contract--";
            }
            else {
                var desc = document.getElementById("text").value;
            }

            if (recordId !== "") {
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (evt) {
                        var str = _arrayBufferToBase64(reader.result);
                        alert("Update Rec if");
                        updateRecord(subject, desc, str, file.name, file.type);
                    }
                    reader.readAsArrayBuffer(file);
                }
                else {
                    updateRecord(subject, desc, null, null, null);
                }


            }
            else {


                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (evt) {
                        var str = _arrayBufferToBase64(reader.result);
                        createNote(subject, desc, str, file.name, file.type);

                    }
                    reader.readAsArrayBuffer(file);
                }
                else {
                    createNote(subject, desc, null, null, null);
                }
            }
        }
        function updateRecord(title, description, docBody, fName, mType) {

            var entity = {};
            if (docBody != null & fName != null & mType != null) {
                entity.documentbody = docBody;
                entity.filename = fName;
                entity.mimetype = mType;
            }
            entity.subject = title;
            entity.notetext = description;
            var req = new XMLHttpRequest();
            req.open("PATCH", Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.0/annotations(" + recordId + ")", true);
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    req.onreadystatechange = null;
                    if (this.status === 204) {
                        //Success - No Return Data - Do Something
                        //opener.parent.Xrm.Page.ui.refreshRibbon();

                        opener.RetrieveAnnotations(null);
                        Xrm.Page.data.refresh();
                        window.close();
                    }
                    else {
                        alert(this.statusText);
                    }
                }
            };
            req.send(JSON.stringify(entity));




        }
        function showLoadingMessage() {
            msgDiv.style.display = "block";
        }
        function hideLoadingMessage() {
            msgDiv.style.display = "none";
        }

    </script>
    <meta charset="utf-8">

</head>

<body onload="Onload()">




    <div class="loaderStyle" id="msgDiv"><img alt="" src="/_imgs/advfind/progress.gif"><br>Deleting...</div>
    <div id="top">
        <h3>Notes</h3>
        <p>Add or update existing note</p>
    </div>
    <div id="main">
        <label>Title</label>
        <input id="title" type="text" maxlength="100">
        <label id="lblDescription">Description</label>
        <textarea id="text" maxlength="2000" rows="10"></textarea>
    </div>
    <div id="footer">
        <div id="fcontent">
            <img src="ss_attach.gif">
            <div id="fname">
                <a id="filename" onclick="opener.getFile(recordId)" href="#">input.html</a><img width="12" height="12"
                    title="Delete this File" id="cross" onclick="deleteAttachment()" src="ss_cross.png">
            </div>
            <button id="battach" onclick="showFileControl()">Attach</button><input name="files[]" id="file"
                style="display: none;" type="file">
            <input id="done" onclick="save()" type="button" value="Save">
        </div>
    </div>
    <script>
        function showFileControl() {
            document.getElementById("battach").style.display = "none";
            document.getElementById("file").style.display = "inline";
        }
    </script>

    <br><br>
</body>

</html>