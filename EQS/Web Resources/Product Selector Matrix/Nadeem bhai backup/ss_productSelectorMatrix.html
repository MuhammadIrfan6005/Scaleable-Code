<html><head>
    <style type="text/css">
        P {
            margin: 0;
        }
    </style>
    <meta>
    <meta>
</head>
<!-- parent.setEmailRange();  -->

<body onload="getParentDate()">

    <style>
        body {
            padding-top: 5px;
            overflow-y: scroll !important;
            overflow-x: auto;
        }

        .subtableBody {
            background: mistyrose;
        }

        .itegrityText {
            margin-right: 12px;
            float: left;
            font-size: 12px;
            font-weight: bold;
        }

        .integrityClass3 {
            margin-left: 25px;
        }

        .integrityClass {
            width: 130px;
        }

        .integrityClass2 {
            width: 50px;
        }

        .integrityClassEnd {
            float: right;
        }

        .integrityCheckbox,
        .integrityCheckbox2,
        .integrityCheckbox3 .integrityCheckbox4 {
            margin-top: 9px !important;
        }

        .subfield {
            text-align: left;
            font-size: small;
            font-weight: 500;
        }

        .removetable>tbody>tr>td>input[type="text"] {
            text-align: center;
            width: 120px;
            height: 22px;
            font-size: 13px;
            font-weight: 500;
        }

        .removetable>tbody>tr>td>input[type="number"] {
            text-align: center;
            width: 50px;
            height: 22px;
            font-size: 13px;
            font-weight: 500;
        }

        .removetable>tbody>tr>.supportTd {
            text-align: center;
            width: 50px;
            height: 22px;

        }

        .removetable>tbody>tr>.additionaldetails {
            text-align: center;
            width: 50px;
            height: 22px;

        }

        .removetable>tbody>tr>.mainSupportTd {
            text-align: center;
            font-weight: bold;

        }

        /* ================= nH*/
        #Createdon {
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
            background: transparent url(ss_background.png) no-repeat scroll -165px -37px;
        }

        div#scrollable_content {
            height: 100%;
            overflow-y: auto;
            width: 100%;
        }

        #Modifiedon {
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
        }

        #Createdby {
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
        }

        #Filename {
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
        }

        /* Nh */

        #functionalArea {
            position: fixed;
            bottom: 0;
            width: 93%;
        }

        /*==========================*/
        #setupFee,
        #mlicFee,
        #licFee {
            border: none;
            border-bottom: 2px solid #e4e4e4;
            width: 120px;
            text-align: center;

        }

        #sb,
        #mlb,
        #lb {
            text-align: center;
        }

        .col-sm-2>input[type=text] {
            text-align: center;
        }

        .table-custom>thead>tr>th {
            width: 120px;
        }

        .table-custom>tbody>tr>td:nth-child(5),
        .table-custom>tbody>tr>td:nth-child(6),
        .table-custom>tbody>tr>td:nth-child(7),
        .table-custom>tbody>tr>td:nth-child(8),
        .table-custom>tbody>tr>td:nth-child(9),
        .table-custom>tbody>tr>td:nth-child(10) {
            width: 120px;
        }

        .table-custom>tbody>tr>td:nth-child(4) {
            width: 150px;
        }

        .table-custom>tbody>tr>td>input[type=text],
        .table-custom>tbody>tr>td>input[type=textarea],
        .table-custom>tbody>tr>td>input[type=date] {
            width: 120px;
        }

        /*New design*/

        #sumAmount {
            align-self: center;

        }

        #row {
            margin-left: 140px;
            align-items: center;
            width: 90%;
        }


        /*===========================*/
        #title {
            padding-right: 5px;
            width: 13px;
        }

        .table-container {
            width: auto;
            margin-left: 0;
            margin-right: auto;
            font-family: "Segoe UI", Arial, Sans-Serif;
            font-size: 12px;
        }

        .h2 {
            font-family: "Segoe UI", Arial, Sans-Serif;
            font-size: 12px;
            color: #000000;
            /* width: 200px; */
            display: inline;
        }

        .table-custom {
            border-spacing: 0;
            width: 100%;
        }

        .table-custom>thead>tr>th {
            /*border-top: 1px solid rgba(128, 128, 128, 0.21);*/
            cursor: pointer;
            text-align: center;
            padding: 5px 5px;
            border-bottom: 0px solid rgba(128, 128, 128, 0.21);
            font-family: "Segoe UI", Arial, Sans-Serif;
            color: #080808;
            font-size: 12px;
        }


        tbody {
            height: 100px;
            overflow: auto;
        }

        .table-custom>tbody>tr>td {
            height: 25px;
            border: 2px solid white;
            padding: 5px 10px;
            font-family: "Segoe UI", Arial, Sans-Serif;
            color: #080808;
            font-size: 12px;
            font-weight: 500;
            background-color: #f3f3f3;
            text-align: center;
            /*width: 140px;*/
        }

        .table-custom>tbody>tr {
            height: 25px;
            padding-top: 3px;
            padding-left: 5px;
            /*min-width: 140px;*/
        }

        .tr_alignright {
            padding-right: 5px;
            text-align: right;
        }

        .tr_alignmiddle {
            padding: 0px;
            text-align: center;
        }

        tr.selected {
            background-color: #D7EBF9;
        }

        img.unselected {
            display: none;
        }

        #TBL_CampaignActivities th:not(:last-child) {
            border-right: 1px solid rgba(128, 128, 128, 0.21);
        }

        hr {
            display: block;
            height: 0px;
            border: 1px solid lightgray;
            margin: 1em 0;
            padding: 0;
        }

        #TBL_CampaignActivities th #headright {
            border-right: none;
        }

        .blue {
            color: #1160B7 !important;
        }

        .black {
            color: #000000 !important;
            font-weight: 500 !important;
        }

        .light-black {
            color: #000000 !important;
        }

        #rightColumn {
            border-right: none;
        }

        #plusimage {
            margin-right: 10px;
            float: right;
            background-image: url("ss_DownArrow");
            cursor: pointer;
        }

        #delete-input-btn {
            visibility: hidden;
        }

        tr:hover div#fdib #delete-input-btn {
            visibility: visible;
            float: right;
            margin-right: 25px;
        }


        .toptable {
            width: 100%;
            top: -5px;
        }

        .toptable tr {
            height: 8px;
        }

        #nonotes {
            margin-top: 10px;
            font-family: "Segoe UI", Arial, Sans-Serif;
            color: grey;
            font-size: 12px;
        }

        .loaderStyle {
            text-align: center;
            cursor: wait;
            background: transparent;
            font-size: 12px;
            position: absolute;
            display: none;
            left: 45%;
            top: 200px;
            width: 50px;
            height: 50px;
        }

        .loaderStyle img {
            margin-top: 10px;
            border: none;
        }

        #paging {
            height: 10px;
            float: right;
            font-family: "Segoe UI", Arial, Sans-Serif;
            color: grey;
            font-size: 12px;
        }

        #paging1 {
            height: 10px;
            float: right;
            font-family: "Segoe UI", Arial, Sans-Serif;
            color: grey;
            font-size: 12px;
        }

        #preprevious {
            background: transparent url(ss_background.png) no-repeat scroll -157px -135px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #preprevious1 {
            background: transparent url(ss_background.png) no-repeat scroll -157px -135px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #forward {
            float: right;
            background: transparent url(ss_background.png) no-repeat scroll -157px -124px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #forward1 {
            float: right;
            background: transparent url(ss_background.png) no-repeat scroll -95px -159px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #previous {
            float: right;
            background: transparent url(ss_background.png) no-repeat scroll -167px -118px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #previous1 {
            float: right;
            background: transparent url(ss_background.png) no-repeat scroll -167px -118px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        .table-custom>thead>tr>td:hover {
            background-color: #D7EBF9;
            text-decoration: underline;
            cursor: pointer;
        }

        .table-custom>tbody>tr:hover {
            background-color: #D7EBF9;
            text-decoration: underline;
            text-decoration: none;
            cursor: pointer;
        }

        .nohover {
            background-color: white !important;
        }

        #head {
            margin-bottom: 8px;
        }

        #searchtable {
            border-spacing: 0px;
            padding: 0px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        #search {
            border-right: none;
            width: 280px;
            margin-left: 5px;
        }

        #moreRecords {
            color: #005592;
            text-align: right;
            display: none;
        }

        #withoutpadding {
            padding: 0px;
            border-spacing: 0px;
        }

        #mainContainer {
            margin-bottom: 160px;
            width: 95%;
        }

        #shoppingcart {
            width: 33%;
            float: left;
        }

        #cartContainer {
            height: 450px;
            width: 100%;
            clear: both;
        }

        #cartTableContainer {
            max-height: 380px;
            overflow-x: hidden;
            overflow-y: auto;
            width: 100%;
            padding: 0px;
            margin: 0px;
            clear: both;
        }

        #cartTotals {
            width: 100%;
        }

        .input-xs {
            height: 22px;
            padding: 2px 5px;
            font-size: 12px;
            line-height: 1.5;
            width: 80%;
            margin-left: 9%;
            margin-right: 9%;
        }


        .inactive {
            display: none;
        }

        #delete-cart-btn {
            margin-bottom: 2px;
            opacity: 0.7;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        #msgDiv img {
            width: 300px;
        }

        .borderfocus {
            border-color: #D7EBF9;
        }

        .nav-tabs>li.active>a,
        .nav-tabs>li.active>a:hover {
            color: #ffffff;
            background-color: #337ab7;
            border: 0px solid #ddd;
            border-bottom-color: transparent;
            cursor: default;
        }

        .nav>li>a {
            position: relative;
            display: block;
        }

        .nav {
            display: table;
            width: 100%;
            margin: 0;
        }

        .nav-tabs>li.active>a,
        .nav-tabs>li.active>a:hover,
        .nav-tabs>li.active>a:focus {
            background-color: #337ab7;
            color: #ffffff;
            border: 0px solid #ddd;
        }

        a {
            color: #ffffff;
        }

        td.checker {
            width: 3% !important;
            background: white !important;
        }

        p.TabHeading,
        #productselector_heading1 {
            color: #337ab7;
            font-size: 25px;
            font-weight: 400;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        td {
            font-size: 12px;
        }

        .kap_pak {
            text-align: center;
            width: 120px;
            height: 10px;
            font-size: 8px;
            font-weight: 500;
        }
    </style>


    <meta charset="utf-8">
    <link rel="stylesheet" href="ss_bootstrap.min.css">
    <script src="ss_jquery"></script>
    <script src="ss_bootstrap.min.js"></script>
    <script src="ClientGlobalContext.js.aspx"></script>
    <link rel="stylesheet" href="ss_css_loader">


    <style>
        body {

            overflow-x: auto;
            background-color: #eee;
        }

        .on {
            background-color: #a7cdf0;
        }

        #Createdon {
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
            background: transparent url(ss_background.png) no-repeat scroll -165px -37px;
        }

        div#scrollable_content {
            height: 100%;
            overflow-y: auto;
            width: 100%;
        }

        #Modifiedon {
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
        }

        #Createdby {
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
        }

        #Filename {
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
        }

        /*#title {
            display: inline;
            width: 10px;
            height: 14px;
            overflow: hidden;
            vertical-align: bottom;
        }*/

        #title {
            padding-right: 5px;
            width: 13px;
        }

        .table-container {
            width: auto;
            margin-left: 0;
            margin-right: auto;
            font-family: "Segoe UI", Arial, Sans-Serif;
            font-size: 12px;
        }

        .h2 {
            font-family: "Segoe UI", Arial, Sans-Serif;
            font-size: 12px;
            color: #000000;
            display: inline;
        }

        .table-custom {
            border-spacing: 0;
            width: 100%;
        }





        .table-custom>thead>tr>td {
            padding: 2px 5px;
            /*width: 140px;*/
        }

        tbody {
            height: 100px;
            overflow: auto;
        }


        .table-custom>tbody>tr {
            height: 25px;
            padding-top: 3px;
            padding-left: 5px;
            /*min-width: 140px;*/
        }

        .tr_alignright {
            padding-right: 5px;
            text-align: right;
        }

        .tr_alignmiddle {
            padding: 0px;
            text-align: center;
        }

        tr.selected {
            background-color: #D7EBF9;
        }

        img.unselected {
            display: none;
        }

        #TBL_CampaignActivities th:not(:last-child) {
            border-right: 1px solid rgba(128, 128, 128, 0.21);
        }

        hr {
            display: block;
            height: 1px;
            border: 0;
            border-top: 1px solid #d6d6d6;
            margin: 1em 0;
            padding: 0;
        }

        #TBL_CampaignActivities th #headright {
            border-right: none;
        }

        .blue {
            color: #1160B7 !important;
        }

        .black {
            color: #000000 !important;
            font-weight: 500 !important;
        }

        .light-black {
            color: #000000 !important;
        }

        #rightColumn {
            border-right: none;
        }

        #plusimage {
            margin-right: 10px;
            float: right;
            background-image: url("ss_DownArrow");
            cursor: pointer;
        }

        #delete-input-btn {
            visibility: hidden;
        }

        tr:hover div#fdib #delete-input-btn {
            visibility: visible;
            float: right;
            margin-right: 25px;
        }


        .toptable {
            width: 100%;
            top: -5px;
        }

        .toptable tr {
            height: 8px;
        }

        #nonotes {
            margin-top: 10px;
            font-family: "Segoe UI", Arial, Sans-Serif;
            color: grey;
            font-size: 12px;
        }

        .loaderStyle {
            text-align: center;
            cursor: wait;
            background: transparent;
            font-size: 12px;
            position: absolute;
            display: none;
            left: 45%;
            top: 200px;
            width: 50px;
            height: 50px;
        }

        .loaderStyle img {
            margin-top: 10px;
            border: none;
        }

        #paging {
            height: 10px;
            float: right;
            font-family: "Segoe UI", Arial, Sans-Serif;
            color: grey;
            font-size: 12px;
        }

        #paging1 {
            height: 10px;
            float: right;
            font-family: "Segoe UI", Arial, Sans-Serif;
            color: grey;
            font-size: 12px;
        }

        #preprevious {
            background: transparent url(ss_background.png) no-repeat scroll -157px -135px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #preprevious1 {
            background: transparent url(ss_background.png) no-repeat scroll -157px -135px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #forward {
            float: right;
            background: transparent url(ss_background.png) no-repeat scroll -157px -124px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #forward1 {
            float: right;
            background: transparent url(ss_background.png) no-repeat scroll -95px -159px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #previous {
            float: right;
            background: transparent url(ss_background.png) no-repeat scroll -167px -118px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        #previous1 {
            float: right;
            background: transparent url(ss_background.png) no-repeat scroll -167px -118px;
            width: 8px;
            height: 9px;
            overflow: hidden;
        }

        .table-custom>thead>tr>td:hover {
            background-color: #D7EBF9;
            text-decoration: underline;
            cursor: pointer;
        }

        .table-custom>tbody>tr:hover {
            background-color: #D7EBF9;
            text-decoration: underline;
            text-decoration: none;
            cursor: pointer;
        }

        .nohover {
            background-color: white !important;
        }

        #head {
            margin-bottom: 8px;
        }


        #searchtable {
            border-spacing: 0px;
            padding: 0px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        #search {
            border-right: none;
            width: 280px;
            margin-left: 5px;
        }

        #moreRecords {
            color: #005592;
            text-align: right;
            display: none;
        }

        #withoutpadding {
            padding: 0px;
            border-spacing: 0px;
        }



        #shoppingcart {
            /*background-image: url(ss_cart);*/
            width: 33%;
            float: left;
        }

        #cartContainer {
            height: 450px;
            width: 100%;
            clear: both;
        }

        #cartTableContainer {
            max-height: 380px;
            overflow-x: hidden;
            overflow-y: auto;
            width: 100%;
            padding: 0px;
            margin: 0px;
            clear: both;
        }

        #cartTotals {
            width: 100%;
        }

        .input-xs {
            height: 22px;
            padding: 2px 5px;
            font-size: 12px;
            line-height: 1.5;
            width: 80%;
            margin-left: 9%;
            margin-right: 9%;
        }

        select {
            border: none;
            border-bottom: 2px solid #e4e4e4;
            padding-right: 48px;
        }

        .single-button {
            background-color: white;
            height: 50px;
            text-align: center;
        }

        .inactive {
            display: none;
        }

        /*.loader {
            text-align: center;
            cursor: wait;
            background-color: transparent;
            display: none;
            margin-top: 5px;
        }

            .loader img {
                border: none;
            }*/

        #delete-cart-btn {
            margin-bottom: 2px;
            opacity: 0.7;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        #msgDiv img {
            width: 300px;
        }

        .borderfocus {
            border-color: #D7EBF9;
        }

        .nav-tabs>li {

            font-size: 19px;
            width: 25%;
            margin: -3px 7px 0px 7px !important;
            font-weight: 500;
            border: 2px solid transparent;
            float: none;
            display: table-cell;
            text-align: center;
        }

        .nav-tabs>li>a {
            background-color: #716f6f;
            margin-right: 0px;
            line-height: 1.42857143;
            border: 2px solid transparent;
            border-radius: 0px 0px 0 0;
        }

        .nav-tabs>li.active>a,
        .nav-tabs>li.active>a:hover {
            color: #ffffff;
            background-color: #337ab7;
            border: 0px solid #ddd;
            border-bottom-color: transparent;
            cursor: default;
        }



        .nav {
            display: table;
            width: 100%;
            margin: 0;
        }

        .nav-tabs>li.active>a,
        .nav-tabs>li.active>a:hover,
        .nav-tabs>li.active>a:focus {
            background-color: #337ab7;
            color: #ffffff;
            border: 0px solid #ddd;
        }

        a {
            color: #ffffff;
        }

        td.productname {
            text-align: left !important;
            padding-left: 15px !important;
        }

        input[type=textarea] {
            width: -webkit-fill-available;
            /*margin-right: 5px;
            margin-left: 5px;*/
        }

        .packageCheckbox {
            font-weight: bold;
            font-size: 13px;
            vertical-align: sub;
        }

        .sumAmount {
            margin-top: 15px;
            background-color: white;
            padding: 25px 55px;
        }

        .scroll1 {
            padding: 1px 25px;
            margin-top: 20px;
            background-color: white;
            padding-bottom: 30px;
            margin-bottom: 15px;
        }

        input {
            background-position: right;
            border: 2px solid #e1e1e1;
            padding-left: 5px;
        }

        .tablepopulate {
            width: 100%;
        }

        input.DiscountedSetupTextbox:focus {
            border: 1px solid #337ab7;
            outline: 0px;
        }

        .checkbox_hr {
            margin-top: 0px;
            margin-bottom: 0px;
            background: white;
        }

        .checkbox_hr2 {
            margin-top: 9px;
            margin-bottom: -11px;
        }

        .checkboxrow {
            background: white;
            padding-top: 10px;
            padding-bottom: 14px;
        }

        .row1 {
            margin-top: 30px;
        }

        .row.checkboxrow {
            margin-left: 0px;
            margin-right: 0px;
        }

        .second-CheckboxRow {
            display: none;
        }

        input[readonly="readonly"] {
            background: lightgray;
            /* color: white; */
            /* border: 1px solid white; */
        }
    </style>
    <script>
        try {
            //==========

            var setupfield = "";
            var licensefield = "";
            var mlicensefield = "";
            var singlesetupfield = "";
            var singlelicensefield = "";
            var singlemlicensefield = "";
            //=========
            var CurrencySymbol = "";
            var DecimalSymbol = "";
            var NumberSeparator = "";
            var UILanguageId = "";
            var isSaveandClose = false;
            var producttype = "";

            var contractStartDate = new Date("01-Sep-2001");
            var contractEndDate = new Date("01-Sep-2001");

            var globelcontext = opener.parent.Xrm.Utility.getGlobalContext();

            function AddFormattings(x) {
                var number = x;
                var thousand = NumberSeparator;
                var decimal = DecimalSymbol;
                var places = 2;
                var symbol = CurrencySymbol;


                number = number || 0;
                places = !isNaN(places = Math.abs(places)) ? places : 2;
                symbol = symbol !== undefined ? symbol : "$";
                thousand = thousand || ",";
                decimal = decimal || ".";
                var negative = number < 0 ? "-" : "",
                    i = parseInt(number = Math.abs(+number || 0).toFixed(places), 10) + "",
                    j = (j = i.length) > 3 ? j % 3 : 0;
                return negative + (j ? i.substr(0, j) + thousand : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thousand) + (places ? decimal + Math.abs(number - i).toFixed(places).slice(2) : "") + " " + symbol;




            }
            function RemoveFormattings(x) {
                //if (CurrencySymbol === '\u20AC')
                if (DecimalSymbol === ',' && x != null) {

                    // debugger

                    if ((x.indexOf(CurrencySymbol) > -1)) {
                        x = x.replace(CurrencySymbol, "");
                    }

                    if (DecimalSymbol === ',') {

                        //german case
                        x = x.replace(/\,/g, 'a');
                        x = x.replace(/\./g, '');
                        x = x.replace(/\a/g, '.');

                        x = Number(x).toLocaleString("es-US", { minimumFractionDigits: 2 });
                        x = x.replace(/\,/g, '');

                        //x = x.replace(/\,/g, 'a');
                        //x = x.replace(DecimalSymbol, ',');
                        //x = x.replace(/\a/g, '');

                        //x = Number(x).toLocaleString("de-DE", { minimumFractionDigits: 2 });
                        //x = x.replace('.', '');
                    }



                }
                else if (DecimalSymbol === "." && x != null) {

                    //debugger;
                    if ((x.indexOf(CurrencySymbol) > -1)) {
                        x = x.replace(CurrencySymbol, "");
                    }
                    //x = x.replace(/\./g, 'a');
                    //x = x.replace(/\,/g, '');
                    //x = x.replace(/\a/g, '.');
                    //console.log("in fucntion " + x);
                    //x = Number(x).toLocaleString("es-US", { minimumFractionDigits: 2 });
                    //console.log("after number function " + x);
                    x = x.replace(',', '');
                    ///console.log("end of if statement " + x);

                }
                else if (DecimalSymbol === "'" && x != null) {

                    if ((x.indexOf(CurrencySymbol) > -1)) {
                        x = x.replace(CurrencySymbol, "");
                    }
                    x = x.replace(/\'/g, 'a');
                    x = x.replace(DecimalSymbol, '.');
                    x = x.replace(/\a/g, '');
                    x = Number(x).toLocaleString("es-US", { minimumFractionDigits: 2 });
                    x = x.replace(',', '');

                }

                else if (x != null) {

                    if ((x.indexOf(CurrencySymbol) > -1)) {
                        x = x.replace(CurrencySymbol, "");
                    }
                    x = x.replace(/\,/g, 'a');
                    x = x.replace(DecimalSymbol, '.');
                    x = x.replace(/\a/g, '');
                    x = Number(x).toLocaleString("es-US", { minimumFractionDigits: 2 });
                    x = x.replace(',', '');

                }


                return x;
            }

            function MakeFieldsReadOnly() {
                setTimeout(function () {
                    console.log($("#640050_pt td input[type='text']").length + "-inputs");
                    //EQS Policy Manager
                    $("#640050_pt td input[type='text']").attr("readonly", "readonly");
                    $("#640050_pt td input[type='text']").attr("onfocus", "this.blur()");
                    $("#640070_pt td input[type='text']").attr("readonly", "readonly");
                    $("#640070_pt td input[type='text']").attr("onfocus", "this.blur()");
                    //EQS Approval Manager
                    $("#640080_pt td input[type='text']").attr("readonly", "readonly");
                    $("#640080_pt td input[type='text']").attr("onfocus", "this.blur()");
                    $("#640081_pt td input[type='text']").attr("readonly", "readonly");
                    $("#640081_pt td input[type='text']").attr("onfocus", "this.blur()");


                    $('#update_products').removeClass('is-active');
                }, 2000);

            }
            //for checkbox auto check
            //markerb1
            function checkboxChecker(object) {
                var classname = object.id;

                if (classname === "BasicWeb") {
                    if ($("#BasicWeb").is(':checked')) {
                        $(".IRB").each(function () {
                            $(this).prop("checked", true);
                        });

                    } else {
                        $(".IRB").each(function () {
                            if (!($(this).hasClass('IRBP') && $("#BestPracticeWeb").is(':checked')) && !($(this).hasClass('IRBC') && $("#BestInClassWeb").is(':checked')))
                                $(this).prop("checked", false);
                        });
                    }
                }
                else if (classname === "BestPracticeWeb") {
                    if ($("#BestPracticeWeb").is(':checked')) {
                        $(".IRBP").each(function () {
                            $(this).prop("checked", true);
                        });

                    } else {
                        $(".IRBP").each(function () {
                            if (!($(this).hasClass('IRB') && $("#BasicWeb").is(':checked')) && !($(this).hasClass('IRBC') && $("#BestInClassWeb").is(':checked')))
                                $(this).prop("checked", false);
                        });
                    }
                }
                else if (classname === "BestInClassWeb") {
                    if ($("#BestInClassWeb").is(':checked')) {
                        $(".IRBC").each(function () {
                            $(this).prop("checked", true);
                        });

                    } else {
                        $(".IRBC").each(function () {
                            if (!($(this).hasClass('IRBP') && $("#BestPracticeWeb").is(':checked')) && !($(this).hasClass('IRB') && $("#BasicWeb").is(':checked')))
                                $(this).prop("checked", false);
                        });
                    }
                }
                else if (classname === "BasicTool") {
                    if ($("#BasicTool").is(':checked')) {
                        $(".IRTB").each(function () {
                            $(this).prop("checked", true);
                        });

                    } else {
                        $(".IRTB").each(function () {
                            if (!($(this).hasClass('IRTBP') && $("#BestPracticeTool").is(':checked')) && !($(this).hasClass('IRTBC') && $("#BestInClassTool").is(':checked')))
                                $(this).prop("checked", false);
                        });
                    }
                }
                else if (classname === "BestPracticeTool") {
                    if ($("#BestPracticeTool").is(':checked')) {
                        $(".IRTBP").each(function () {
                            $(this).prop("checked", true);
                        });

                    } else {
                        $(".IRTBP").each(function () {
                            if (!($(this).hasClass('IRTB') && $("#BasicTool").is(':checked')) && !($(this).hasClass('IRTBC') && $("#BestInClassTool").is(':checked')))
                                $(this).prop("checked", false);
                        });
                    }
                }
                else if (classname === "BestInClassTool") {
                    if ($("#BestInClassTool").is(':checked')) {
                        $(".IRTBC").each(function () {
                            $(this).prop("checked", true);
                        });

                    } else {

                        $(".IRTBC").each(function () {
                            if (!($(this).hasClass('IRTBP') && $("#BestPracticeTool").is(':checked')) && !($(this).hasClass('IRTB') && $("#BasicTool").is(':checked')))
                                $(this).prop("checked", false);
                        });
                    }
                }
                calculateFee();

            }


            var heading1 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading" >Website & Apps</b></p>';
            var heading2 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">IR Tools</b></p>';
            var heading3 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">Contact Manager & Mailing</b></p>';
            var heading4 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">(Regulatory) News Distribution</b></p>';
            var heading5 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">Compliance</b></p>';
            var heading6 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">Webcast</b></p>';
            var heading7 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">Online Reports</b></p>';
            var heading8 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">LEI</b></p>';
            var heading9 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">XML PR Cockpit</b></p>';
            var heading10 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">XML Konzerngesellschaften (T&oumlchter)</b></p>';
            var heading11 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">XML Konzern</b></p>';
            var heading12 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">XML Fonds</b></p>';
            var heading13 = '<div class="scroll1"><p class="TabHeading"><b id="productselector_heading1" class="TabHeading">EQS IR Cockpit</b></p>';

            var thead = '<table style="width:100%" id="MyTable" class="table-custom">';
            thead += '<thead>' +
                '<tr>' +
                '<th style="display:none"></th>' +
                '<th style="display:none"></th>' +
                '<th></th>' +
                '<th class="productname">Product</th>' +
                '<th>Setup</th>' +
                '<th>Monthly Fee</th>' +
                '<th>Yearly Fee</th>' +
                '<th>Comment</th>' +
                '<th>Contract Start Date</th>' +
                '<th>Contract End Date</th>' +
                '<th>Contract Length</th>' +
                '<th style="display:none"></th>' +
                '<th style="display:none"></th>' +
                '</tr>' +
                '</thead>' +
                '<tbody class="tbody">';

            tbottom = '</tbody>' +
                '</table>' +
                '</div>';
            var pricelevelId = "";
            var priceID = "";
            var app = "";
            var contractMail = "";
            var EQSIRCockpit = "";
            var news = "";
            var webcast = "";
            var reports = "";
            var LEI = "";
            var tool = "";
            var compliance = "";
            var XMLPRCockpit = "";
            var XMLKonzerngesellschaften = "";
            var XMLKonzern = "";
            var XMLFonds = "";

            var checkBoxSet1 = '<div class="row checkboxrow row1">' +
                '<div class="col-sm-4 Set1ck1 packageCheckbox"><input type="checkbox" id="BasicWeb" onchange="checkboxChecker(this)">&nbsp;&nbsp;IR Website Basic</div>' +
                '<div class="col-sm-4 Set1ck2 packageCheckbox"><input type="checkbox" id="BestPracticeWeb" onchange="checkboxChecker(this)" >&nbsp;&nbsp;IR Website Best Practice</div>' +
                '<div class="col-sm-4 Set1ck3 packageCheckbox"><input type="checkbox" id="BestInClassWeb" onchange="checkboxChecker(this)">&nbsp;&nbsp;IR Website Best in Class</div>' + '</div>';
            var checkBoxSet2 = '<div class="row checkboxrow second-CheckboxRow">' +
                '<div class="col-sm-4 Set2ck1 packageCheckbox"><input type="checkbox" id="BasicTool" onchange="checkboxChecker(this)">&nbsp;&nbsp;IR Tool Package Basic</div>' +
                '<div class="col-sm-4 Set2ck2 packageCheckbox"><input type="checkbox" id="BestPracticeTool" onchange="checkboxChecker(this)">&nbsp;&nbsp;IR Tool Package Best Practice</div>' +
                '<div class="col-sm-4 Set2ck3 packageCheckbox"><input type="checkbox"  id="BestInClassTool" onchange="checkboxChecker(this)">&nbsp;&nbsp;IR Tool Package Best in Class</div>' +
                '</div>';


            var oportunityproducts = [];

            var prodID = [];
            var SetupFee = 0;
            var licenseFee = 0;
            var mlicenseFee = 0.00;
            var monthlyLicfee = 0.00;
            var mdiscLicenseFee = 0.00;
            var discSetupFee = 0;
            var discLicenseFee = 0;


            function getParentDate() {
                // change M107


                retrieveUserSettings();
                //importing the user setting to set currencey,decimal,separator formattings
                // app = "";
                // contractMail = "";
                // news = "";
                // webcast = "";
                // reports = "";
                // LEI = "";
                // tool = "";
                // compliance = "";
                // XMLPRCockpit = "";
                // XMLKonzerngesellschaften = "";
                // XMLKonzern = "";
                // XMLFonds = "";
                // if (location.search != "") {
                //     vals = location.search.substr(1).split("&");
                //     for (var i in vals) {
                //         vals[i] = vals[i].replace(/\+/g, " ").split("=");
                //     }
                //     //look for the parameter named 'data'
                //     var found = false;
                //     for (var i in vals) {
                //         if (vals[i][0].toLowerCase() === "data") {
                //             parseDataValue(vals[i][1]);
                //             found = true;
                //             break;
                //         }
                //     }
                // }
            }
            function parseDataValue(datavalue) {
                if (datavalue != "") {
                    var vals = new Array();
                    vals = decodeURIComponent(datavalue).split("&");
                    for (var i in vals) {
                        vals[i] = vals[i].replace(/\+/g, " ").split("=");
                    }
                }
                pricelevelId = vals[0];
                pricelevelId = pricelevelId.toString();
                pricelevelId = pricelevelId.replace('"', '');
                pricelevelId = pricelevelId.replace('"', '');
                priceID = pricelevelId.replace('{', '').replace('}', '');

                //$.LoadingOverlay("show");
                // $('#update_products').addClass('is-active');
                retrieveProduct(priceID);
                //  $('#update_products').attr('data-text', 'Loading Products');



                // $.LoadingOverlay("hide");
            }

            function retrieveProduct(priceID) {

                // var Terminate = opener.parent.Xrm.Page.getAttribute("ss_terminationperiod").getValue();
                // $("#terminate").val(Terminate);
                // var contract = opener.parent.Xrm.Page.getAttribute("ss_contractperiod").getValue();
                // $("#contract").val(contract);
                getOpportunityProducts();

            }

            function loadproducts() {
                var fetch = '<fetch>' +
                    ' <entity name="productpricelevel" >' +
                    ' <attribute name="productnumber" />' +
                    ' <attribute name="uomid" />' +
                    ' <attribute name="pricelevelid" />' +
                    ' <attribute name="productid" />' +
                    ' <attribute name="amount" />' +
                    '  <filter type="or" >' +
                    '  <condition entityname="product" attribute="producttypecode" operator="in" >' +
                    '  <value>100000003</value>' +
                    '   <value>100000001</value>' +
                    ' </condition>' +
                    ' </filter>' +
                    '   <filter type="and" >' +
                    '  <condition attribute="pricelevelid" operator="eq" value="' + priceID + '" />' +
                    ' </filter>' +
                    '   <link-entity name="product" from="productid" to="productid" link-type="inner" >' +
                    '  <attribute name="ss_issalesproduct" />' +
                    ' <attribute name="name" />' +
                    ' <attribute name="ss_productdescription" />' +
                    ' <attribute name="productnumber" />' +
                    ' <attribute name="producttypecode" />' +
                    '<attribute name="ss_relatedlicencefee" />' +
                    '<attribute name="ss_productmaincategory" />' +
                    '<attribute name="ss_crmproductgroups" />' +
                    '<attribute name="ss_irwebsitebasic" />' +
                    '<attribute name="ss_irwebsitebestpractice" />' +
                    '<attribute name="ss_irwebsitebestinclass" />' +
                    '<attribute name="ss_irtoolpackagebasic" />' +
                    '<attribute name="ss_irtoolpackagebestpractice" />' +
                    '<attribute name="ss_irtoolpackagebestinclass" />' +
                    '<attribute name="statecode" />' +
                    '<attribute name="ss_productseletorsortorder" />' +
                    ' <filter>' +
                    '<condition attribute="ss_issalesproduct" operator="eq" value="1" />' +
                    '<condition attribute="statecode" operator="eq" value="0" />' +
                    '</filter>' +
                    '<order attribute="ss_productseletorsortorder" />' +
                    '</link-entity>' +
                    '</entity>' +
                    '</fetch>';
                //console.log(fetch);
                var req = new XMLHttpRequest();
                req.open("GET", Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.2/productpricelevels?fetchXml=" + fetch, true);
                req.setRequestHeader("OData-MaxVersion", "4.0");
                req.setRequestHeader("OData-Version", "4.0");
                req.setRequestHeader("Accept", "application/json");
                req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
                req.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        req.onreadystatechange = null;
                        if (this.status === 200) {
                            var results = JSON.parse(this.response);

                            for (var i = 0; i < results.value.length; i++) {
                                //Nh=============================================
                                var crmLicProdGroup = "";
                                var crmLicProdMainGroup = "";
                                var Prod_Id = ""
                                var ss_productdescription = "";
                                var crmProdGroup = results.value[i]["product1_x002e_ss_crmproductgroups"]; //===nh

                                var crmProdMainGroup = results.value[i]["product1_x002e_ss_productmaincategory"]; //===nh              
                                var crmProdDescription = results.value[i]["product1_x002e_ss_productdescription"]; //===nh  
                                //============================================nH
                                producttype = results.value[i]["product1_x002e_producttypecode"];
                                if (results.value[i]["product1_x002e_producttypecode"] === 100000003) {
                                    //For IR package selection
                                    Prod_Id = results.value[i]["product1_x002e_productnumber"];
                                    ss_productdescription = results.value[i]["product1_x002e_ss_productdescription"];
                                    //console.log("Prod_Id => " + Prod_Id) ;
                                    var IRpackage = "";

                                    if (results.value[i]["product1_x002e_ss_irwebsitebasic"] === true) {
                                        IRpackage += "IRB ";
                                    }
                                    else {
                                        IRpackage += "";
                                    }

                                    if (results.value[i]["product1_x002e_ss_irwebsitebestpractice"] === true) {
                                        IRpackage += "IRBP ";
                                    }
                                    else {
                                        IRpackage += "";
                                    }

                                    if (results.value[i]["product1_x002e_ss_irwebsitebestinclass"] === true) {
                                        IRpackage += "IRBC ";
                                    }
                                    else {
                                        IRpackage += "";
                                    }

                                    if (results.value[i]["product1_x002e_ss_irtoolpackagebasic"] === true) {
                                        IRpackage += "IRTB ";
                                    }
                                    else {
                                        IRpackage += "";
                                    }

                                    if (results.value[i]["product1_x002e_ss_irtoolpackagebestpractice"] === true) {
                                        IRpackage += "IRTBP ";
                                    }
                                    else {
                                        IRpackage += "";
                                    }

                                    if (results.value[i]["product1_x002e_ss_irtoolpackagebestinclass"] === true) {
                                        IRpackage += "IRTBC ";
                                    }
                                    else {
                                        IRpackage += "";
                                    }

                                    if (IRpackage != "")
                                        IRpackage = IRpackage.slice(0, -1);

                                    // For different product groups
                                    //App And IR website

                                    if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "App" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "IR Website" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Corp Web & Micro") {

                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //variable declarations and intializations

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var mlicDiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var licDiscountedAmountFormatted = "";
                                        var setupdiscountedAmountFormatted = "";
                                        var setupFeeFormatted = "";
                                        var licFeeFormatted = "";
                                        var mlicFeeFormatted = "";
                                        var startDate = "";
                                        var endDate = "";
                                        // Getting the License product ID fro related license fee field to be used in the grid and for adding the license product with Setup product
                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }
                                        // if the Product is already added in the opportunity Products
                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"])
                                                    desc = oportunityproducts.value[j]["description"];

                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;

                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];

                                                licDiscountedAmountFormatted = "0";

                                                count += 1;

                                            }
                                            if (count === 2)
                                                break;
                                        }

                                        //Populating row in case of already added products
                                        if (flag === 1) {

                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            app += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox"  class="' + IRpackage + ' checkboxClass" onchange="calculateFee()" onclick="checkbox_click(this)" checked></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            app += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //app += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            app += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            app += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';


                                        }


                                        // Populating row in case of price list items
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            //col 1=productid col2=unitId
                                            app += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            app += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //app += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            app += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            app += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';

                                        }
                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        //  if (licenseOpProdID != "") {
                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        //  }

                                        /*   else
                                           {
                                               app += '<td class="startDate contract_field"><input type="text" class="startDate contract_field"  style="text-align:center;" readonly></td>';
       
                                               app += '<td class="endDate contract_field"><input type="text" class="endDate contract_field" style="text-align:center;" readonly></td>';
       
                                           }*/
                                        if (OpProdId != "") {
                                            app += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            app += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            app += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            app += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            app += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            app += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            app += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            app += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            app += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            app += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            app += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            app += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }

                                        if (Prod_Id === "640050") {
                                            app += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            app += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            app += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                    }
                                    //IR Tools, pt1                                   
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Charts & Invest. Calc." ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Fact Sheet" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Newsfeed" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Portal Network" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Quick Analyzer" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Others") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {

                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //variable declarations and intializations
                                        // change M107

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var licDiscountedAmountFormatted = "";
                                        var setupdiscountedAmountFormatted = "";
                                        var setupFeeFormatted = "";
                                        var licFeeFormatted = "";
                                        var startDate = "";
                                        var endDate = "";
                                        // Getting the License product ID fro related license fee field to be used in the grid and for adding the license product with Setup product
                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }
                                        // if the Product is already added in the opportunity Products
                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];

                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"]) {
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                    if (oportunityproducts.value[j]["ss_startdate"])
                                                        startDate = oportunityproducts.value[j]["ss_startdate"];
                                                    if (oportunityproducts.value[j]["ss_termenddate"])
                                                        endDate = oportunityproducts.value[j]["ss_termenddate"];

                                                }

                                                else
                                                    licDiscountedAmount = 0.00;
                                                licDiscountedAmountFormatted = "0";

                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }

                                        //Populating row in case of already added products
                                        if (flag === 1) {

                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            tool += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox"  class="' + IRpackage + ' checkboxClass" onchange="calculateFee()" onclick="checkbox_click(this)" checked></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            tool += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //tool += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            tool += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            tool += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }

                                        // Populating row in case of price list items
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            //col 1=productid col2=unitId
                                            tool += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            tool += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //tool += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            tool += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            tool += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }
                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            tool += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            tool += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            tool += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            tool += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            tool += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            tool += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            tool += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            tool += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            tool += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            tool += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            tool += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            tool += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }

                                        if (Prod_Id === "640050") {
                                            tool += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            tool += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            tool += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }

                                    }
                                    // EQS IR Cockpit
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "EQS IR Cockpit") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];

                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];

                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            //change M107
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);


                                            EQSIRCockpit += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox"  onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            EQSIRCockpit += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //contractMail += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            EQSIRCockpit += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            EQSIRCockpit += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            //col 1=productid col2=unitId
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            EQSIRCockpit += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            EQSIRCockpit += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //contractMail += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            EQSIRCockpit += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            EQSIRCockpit += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }
                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            EQSIRCockpit += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            EQSIRCockpit += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            EQSIRCockpit += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            EQSIRCockpit += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            EQSIRCockpit += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            EQSIRCockpit += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            EQSIRCockpit += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            EQSIRCockpit += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            EQSIRCockpit += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            EQSIRCockpit += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            EQSIRCockpit += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            EQSIRCockpit += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }

                                        if (Prod_Id === "640050") {
                                            EQSIRCockpit += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            EQSIRCockpit += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            EQSIRCockpit += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }


                                    }
                                    ////
                                    //Contact Manager & Mailing *haider                                   
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Contact Manager") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];

                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];

                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            //change M107
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);


                                            contractMail += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox"  onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            contractMail += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //contractMail += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            contractMail += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            contractMail += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            //col 1=productid col2=unitId
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            contractMail += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            contractMail += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //contractMail += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            contractMail += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            contractMail += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }
                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            contractMail += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            contractMail += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            contractMail += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            contractMail += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            contractMail += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            contractMail += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            contractMail += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            contractMail += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            contractMail += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            contractMail += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            contractMail += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            contractMail += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }

                                        if (Prod_Id === "640050") {
                                            contractMail += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            contractMail += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            contractMail += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }


                                    }
                                    //Regulatory & News

                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Regulatory & News") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];

                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            //change M107
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            news += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            news += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //news += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            news += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            news += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            //change M107
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            //col 1=productid col2=unitId
                                            news += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            news += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //news += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            news += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            news += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            
                                            news += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            news += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            news += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            news += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            news += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            news += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        else {
                                            news += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            news += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            news += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            news += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            news += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            news += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }

                                        if (Prod_Id === "640050") {
                                            news += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            news += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            news += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (productname === "Verbundene Stimmrechte Setup" || productname === "Corporate News & Press Releases via Agency / TUG" || productname === "MAR-Package Best Practice (new client)" || productname === "Vorabbekanntmachung Finanzberichte" || productname === "Zulassungsfolgepflichten ( 30e WpHG)" || productname === "Directors Dealings Setup" || productname === "Gesamtstimmrechtsmitteilungen" || productname === "UK/Ireland Regulatory News Setup" || productname === "Zulassungsfolgepflichten ( 30e WpHG)" || productname === "Related Partner Setup" || productname === "Ad-hoc-Mitteilungen Online" || Prod_Id === "615284" || productname === "UK/Ireland Regulatory News Standard Setup" || productname === "Corporate News  & Press Releases via Agency / TUG") {
                                            news += embedSubTableforRegulatoryandNews(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }

                                    }
                                    //Compliance                                   
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Insider Manager" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Integrity Line" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Policy Manager") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];

                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups
                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];
                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            compliance += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            compliance += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //compliance += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            compliance += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            compliance += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            //col 1=productid col2=unitId
                                            compliance += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            compliance += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //compliance += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            compliance += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            compliance += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }

                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            compliance += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            compliance += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            compliance += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            compliance += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            compliance += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            compliance += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            compliance += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            compliance += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            compliance += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            compliance += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            compliance += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            compliance += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        if (Prod_Id === "640050") {
                                            compliance += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            compliance += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            compliance += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }

                                    }
                                    //Nh============================================================
                                    //XML PR Cockpit                                    
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "XML PR Cockpit") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups
                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];
                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            XMLPRCockpit += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';

                                            XMLPRCockpit += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            XMLPRCockpit += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            XMLPRCockpit += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);

                                            XMLPRCockpit += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            XMLPRCockpit += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            XMLPRCockpit += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            XMLPRCockpit += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }



                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            XMLPRCockpit += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            XMLPRCockpit += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLPRCockpit += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLPRCockpit += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            XMLPRCockpit += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            XMLPRCockpit += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            XMLPRCockpit += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            XMLPRCockpit += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLPRCockpit += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLPRCockpit += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            XMLPRCockpit += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            XMLPRCockpit += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        if (Prod_Id === "640050") {
                                            XMLPRCockpit += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            XMLPRCockpit += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            XMLPRCockpit += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                    }
                                    //XML Konzerngesellschaften ( Tchter)                                   
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups"] === 25) {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups
                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];
                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            XMLKonzerngesellschaften += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            XMLKonzerngesellschaften += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            XMLKonzerngesellschaften += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            XMLKonzerngesellschaften += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            XMLKonzerngesellschaften += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            XMLKonzerngesellschaften += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            XMLKonzerngesellschaften += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            XMLKonzerngesellschaften += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }



                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            XMLKonzerngesellschaften += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            XMLKonzerngesellschaften += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLKonzerngesellschaften += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLKonzerngesellschaften += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            XMLKonzerngesellschaften += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            XMLKonzerngesellschaften += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            XMLKonzerngesellschaften += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            XMLKonzerngesellschaften += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLKonzerngesellschaften += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLKonzerngesellschaften += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            XMLKonzerngesellschaften += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            XMLKonzerngesellschaften += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        if (Prod_Id === "640050") {
                                            XMLKonzerngesellschaften += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            XMLKonzerngesellschaften += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            XMLKonzerngesellschaften += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                    }
                                    //XML Konzern                                   
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "XML Konzern") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups
                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];
                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            XMLKonzern += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            XMLKonzern += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            XMLKonzern += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            XMLKonzern += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            XMLKonzern += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            XMLKonzern += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            XMLKonzern += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            XMLKonzern += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }



                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            XMLKonzern += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            XMLKonzern += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLKonzern += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLKonzern += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            XMLKonzern += 'td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            XMLKonzern += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            XMLKonzern += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            XMLKonzern += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLKonzern += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLKonzern += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            XMLKonzern += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            XMLKonzern += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        if (Prod_Id === "640050") {
                                            XMLKonzern += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            XMLKonzern += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            XMLKonzern += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                    }
                                    //XML Fonds                                   
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "XML Fonds") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups
                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];
                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            XMLFonds += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            XMLFonds += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            XMLFonds += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            XMLFonds += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            XMLFonds += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            XMLFonds += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            XMLFonds += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            XMLFonds += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }



                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            XMLFonds += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            XMLFonds += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLFonds += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLFonds += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            XMLFonds += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            XMLFonds += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            XMLFonds += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            XMLFonds += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLFonds += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            XMLFonds += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            XMLFonds += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            XMLFonds += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        if (Prod_Id === "640050") {
                                            XMLFonds += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            XMLFonds += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            XMLFonds += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                    }

                                    //============================================================nH
                                    //Webcast                                    
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Video Webcast" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Audio Webcast" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Telco") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];

                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;

                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups
                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];

                                                count += 1;

                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            webcast += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            webcast += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //webcast += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            webcast += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            webcast += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            //col 1=productid col2=unitId
                                            webcast += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            webcast += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //webcast += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            webcast += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            webcast += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }


                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            webcast += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            webcast += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            webcast += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            webcast += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            webcast += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            webcast += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            webcast += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            webcast += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            webcast += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            webcast += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            webcast += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            webcast += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        if (Prod_Id === "640050") {
                                            webcast += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            webcast += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            webcast += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                    }

                                    // Online Reports                                    
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Online Report") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;

                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups


                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];

                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            reports += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            reports += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //reports += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            reports += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            reports += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            //col 1=productid col2=unitId
                                            reports += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            reports += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //reports += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            reports += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            reports += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }


                                        // Adding Start Date End Date fields (Changes by Zain Arshad)
                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            reports += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            reports += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            reports += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            reports += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            reports += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            reports += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            reports += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            reports += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            reports += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            reports += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            reports += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            reports += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        if (Prod_Id === "640050") {
                                            reports += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            reports += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            reports += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                    }
                                    //LEI                                     
                                    else if (results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "XML Conversion" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "LEI" ||
                                        results.value[i]["product1_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"] === "Translation") {
                                        if (results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"]) {


                                            var productname = results.value[i]["_productid_value@OData.Community.Display.V1.FormattedValue"];
                                        }

                                        else {
                                            var productname = "";
                                        }

                                        if (results.value[i]["amount"]) {
                                            var setupFee = results.value[i]["amount"];

                                        }
                                        else {
                                            var setupFee = 0.00;
                                        }
                                        //license product

                                        var OPIndex = -1;
                                        var count = 0;
                                        var flag = 0;
                                        var OpProdId = "";
                                        var desc = "";
                                        var licUID = "";
                                        var licenseProductID = "";
                                        var licenseOpProdID = "";
                                        var licDiscountedAmount = 0.00;
                                        var setupdiscountedAmount = 0.00;
                                        var monthlyLicfee = 0.00;
                                        var startDate = "";
                                        var endDate = "";

                                        if (results.value[i]["product1_x002e_ss_relatedlicencefee"]) {
                                            var licFee = 0.00;
                                            for (var j = 0; j < results.value.length; j++) {
                                                if (results.value[i]["product1_x002e_ss_relatedlicencefee"] === results.value[j]["_productid_value"]) {
                                                    //Nh===========================
                                                    if (results.value[j]["product1_x002e_ss_crmproductgroups"] != null && results.value[j]["product1_x002e_ss_crmproductgroups"] != undefined) {
                                                        crmLicProdGroup = results.value[j]["product1_x002e_ss_crmproductgroups"];
                                                    }
                                                    if (results.value[j]["product1_x002e_ss_productmaincategory"] != null && results.value[j]["product1_x002e_ss_productmaincategory"] != undefined) {
                                                        crmLicProdMainGroup = results.value[j]["product1_x002e_ss_productmaincategory"];
                                                    }
                                                    //================================nH
                                                    if (results.value[j]["amount"] != null)
                                                        licFee = results.value[j]["amount"];
                                                    else
                                                        licFee = 0.00;
                                                    licUID = results.value[j]["_uomid_value"];
                                                    licenseProductID = results.value[i]["product1_x002e_ss_relatedlicencefee"];

                                                }

                                            }
                                        }
                                        else {
                                            var licFee = 0.00;
                                        }

                                        for (var j = 0; j < oportunityproducts.value.length; j++) {

                                            if (results.value[i]["_productid_value"] === oportunityproducts.value[j]["_productid_value"]) {
                                                flag = 1;
                                                OPIndex = j;
                                                OpProdId = oportunityproducts.value[j]["opportunityproductid"];
                                                var ss_productcontractlength = oportunityproducts.value[j]["ss_productcontractlength"];
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    setupdiscountedAmount = oportunityproducts.value[j]["extendedamount"];

                                                count += 1;
                                                if (oportunityproducts.value[j]["description"]) {
                                                    desc = oportunityproducts.value[j]["description"];

                                                }
                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    setupFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                            }
                                            if (licenseProductID === oportunityproducts.value[j]["_productid_value"]) {
                                                OPIndex = j;
                                                licenseOpProdID = oportunityproducts.value[j]["opportunityproductid"];
                                                if (oportunityproducts.value[j]["ss_monthlylicensefee"])
                                                    monthlyLicfee = oportunityproducts.value[j]["ss_monthlylicensefee"];
                                                else
                                                    monthlyLicfee = 0.00;
                                                if (oportunityproducts.value[j]["extendedamount"])
                                                    licDiscountedAmount = oportunityproducts.value[j]["extendedamount"];
                                                else
                                                    licDiscountedAmount = 0.00;

                                                if (oportunityproducts.value[j]["priceperunit"])
                                                    licFee = oportunityproducts.value[j]["priceperunit"]; //updating setup for manual setups

                                                if (oportunityproducts.value[j]["ss_startdate"])
                                                    startDate = oportunityproducts.value[j]["ss_startdate"];
                                                if (oportunityproducts.value[j]["ss_termenddate"])
                                                    endDate = oportunityproducts.value[j]["ss_termenddate"];

                                                count += 1;
                                            }
                                            if (count === 2)
                                                break;
                                        }
                                        if (flag === 1) {
                                            setupdiscountedAmount = AddFormattings(setupdiscountedAmount);
                                            mlicDiscountedAmount = (licDiscountedAmount / 12);
                                            mlicDiscountedAmount = AddFormattings(mlicDiscountedAmount);
                                            licDiscountedAmount = AddFormattings(licDiscountedAmount);

                                            LEI += '<tr class="opportunityProduct" id="' + Prod_Id + '"><td style="display:none">' + OpProdId + ' </td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)" checked  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';

                                            //app += '<td class="DiscountedSetup">' + setupdiscountedAmount + '</td><td class="originalSetup" style="display:none">' + //setupFee + '</td>';

                                            LEI += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupdiscountedAmount + '" style="text-align:center;" ></td><td class="originalSetup" id="' + OpProdId + '_P" style="display:none">' + RemoveFormattings(setupdiscountedAmount) + '</td>';

                                            //LEI += '<td class="DiscountedLic">' + licDiscountedAmount + '</td><td class="originalLicense" style="display:none">' + //licFee + '</td>';
                                            LEI += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + mlicDiscountedAmount + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(mlicDiscountedAmount) + '</td>';
                                            LEI += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licDiscountedAmount + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licDiscountedAmount) + '</td>';
                                        }
                                        else {
                                            setupFee = AddFormattings(setupFee);
                                            monthlyLicfee = licFee / 12;
                                            licFee = AddFormattings(licFee);
                                            monthlyLicfee = AddFormattings(monthlyLicfee);
                                            //col 1=productid col2=unitId
                                            LEI += '<tr class="PriceListItem" id="' + Prod_Id + '"><td style="display:none">' + results.value[i]["_productid_value"] + '</td><td style="display:none">' + results.value[i]["_uomid_value"] + '</td><td class="checker"><input type="checkbox" onchange="calculateFee()" onclick="checkbox_click(this)"  class="' + IRpackage + ' checkboxClass"></td><td class="productname">' + productname + '</td>';
                                            //app += '<td class="DiscountedSetup">' + //setupFee + '</td><td class="originalSetup" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            LEI += '<td class="DiscountedSetup"><input type="text" class="DiscountedSetupTextbox" value="' + setupFee + '" style="text-align:center;" ></td><td class="originalSetup" id="' + results.value[i]["_productid_value"] + '_P" style="display:none">' + RemoveFormattings(setupFee); + '</td>';
                                            //LEI += '<td class="DiscountedLic">' + //licFee + '</td><td class="originalLicense" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                            LEI += '<td class="mDiscountedLic"><input type="text" class="mDiscountedLicTextbox" value="' + monthlyLicfee + '" style="text-align:center;" ></td><td class="moriginalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_MLP" style="display:none">' + RemoveFormattings(monthlyLicfee); + '</td>';
                                            LEI += '<td class="DiscountedLic"><input type="text" class="DiscountedLicTextbox" value="' + licFee + '" style="text-align:center;" ></td><td class="originalLicense" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_LP" style="display:none">' + RemoveFormattings(licFee); + '</td>';
                                        }


                                        // Adding Start Date End Date fields (Changes by Zain Arshad)

                                        if (startDate) {
                                            var appStartDate = dateForm(startDate);
                                        }
                                        else {
                                            var appStartDate = "";

                                        }
                                        if (endDate) {
                                            var appEndDate = dateForm(endDate);
                                        }
                                        else {
                                            var appEndDate = "";

                                        }

                                        if (OpProdId != "") {
                                            LEI += '<td><input type="textarea" value="' + desc + '" id="' + OpProdId + '_C" ></td><td style="display:none">' + licenseOpProdID + '</td><td style="display:none">' + licUID + '</td>';
                                            LEI += '<td class="startDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE" class="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + ' start_Date" value="' + appStartDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            LEI += '<td class="endDate contract_field"><input type="date" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" ></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            LEI += '<td class ="contract_field contract_len"><select name="contract_length" id="' + OpProdId + '_CL" class ="contract_val" ><option value="3" '+((ss_productcontractlength === 3) ? "selected" : "") +'>3</option><option value="6" '+((ss_productcontractlength === 6) ? "selected" : "") +'>6</option><option value="9" '+((ss_productcontractlength === 9) ? "selected" : "") +'>9</option><option value="12" '+((ss_productcontractlength === 12) ? "selected" : "") +'>12</option><option value="24" '+((ss_productcontractlength === 24) ? "selected" : "") +'>24</option><option value="36" '+((ss_productcontractlength === 36) ? "selected" : "") +'>36</option><option value="7" '+((ss_productcontractlength === 7) ? "selected" : "") +'>unlimited</option></select></td>';
                                            LEI += '<td style="display:none" class="DiscountSetup" id="' + OpProdId + '_S"></td><td style="display:none" class="DiscountLic" id="' + licenseOpProdID + '"></td>';
                                            LEI += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }//ptr 22
                                        else {
                                            LEI += '<td><input type="textarea" id="' + results.value[i]["_productid_value"] + '_C"></td><td style="display:none">' + licenseProductID + '</td><td style="display:none">' + licUID + '</td>';
                                            LEI += '<td class="startDate contract_field" style="display:none;"><input type="date" class="start_Date" value="' + appStartDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_SDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            LEI += '<td class="endDate contract_field" style="display:none;"><input type="date" class="end_Date"  value="' + appEndDate + '" style="text-align:center;" id="' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '_EDATE"></td><td style="display:none">' + (OpProdId != "" ? licenseOpProdID : licenseProductID) + '</td>';
                                            LEI += '<td class ="contract_field contract_len" style="display:none"><select name="contract_length" id="' + results.value[i]["_productid_value"] + '_CL" class ="contract_val" ><option value="3">3</option><option value="6">6</option><option value="9">9</option><option value="12">12</option><option value="24">24</option><option value="36">36</option><option value="7">unlimited</option></select></td>';
                                            LEI += '<td style="display:none" class="DiscountSetup"  id="' + results.value[i]["_productid_value"] + '_Setup"></td><td style="display:none" class="DiscountLic" id="' + licenseProductID + '_Lic"></td>';
                                            LEI += '<td style="display:none" class="crmProductgroup" id="' + crmProdGroup + '">' + crmLicProdGroup + '</td> <td style="display:none" class="crmProductmaingroup" id="' + crmProdMainGroup + '">' + crmLicProdMainGroup + '</td><td style="display:none" >' + crmProdDescription + '</td> </tr>';
                                        }
                                        if (Prod_Id === "640050") {
                                            LEI += embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                        else if (Prod_Id === "SP-115" || productname === "EQS Integrity Line Add-On") {
                                            LEI += embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);

                                        }
                                        else if (productname === "EQS Policy Manager" || productname === "EQS Approval Manager") {
                                            LEI += embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription);
                                        }
                                    }


                                }

                            }
                            //pt11
                            document.getElementById("tblEQSIRCockpit").innerHTML = checkBoxSet1 + "<hr class='checkbox_hr'>" + checkBoxSet2 + "<hr class='checkbox_hr2'>" + heading13 + thead + EQSIRCockpit + tbottom;
                            document.getElementById("homeTbl1").innerHTML = heading3 + "<hr class=''>" + thead + contractMail + tbottom;
                            document.getElementById("homeTbl2").innerHTML = heading4 + "<hr class=''>" + thead + news + tbottom;
                            document.getElementById("menu1").innerHTML = heading1 + thead + app + tbottom + heading2 + thead + tool + tbottom + heading6 + thead + webcast + tbottom + heading7 + thead + reports + tbottom;
                            document.getElementById("menu2").innerHTML = heading5 + thead + compliance + tbottom;
                            document.getElementById("menu3").innerHTML = heading8 + thead + LEI + tbottom + heading9 + thead + XMLPRCockpit + tbottom + heading10 + thead + XMLKonzerngesellschaften + tbottom + heading11 + thead + XMLKonzern + tbottom + heading12 + thead + XMLFonds + tbottom;


                            calculateFee();


                        } else {

                            // V8.00 method for alert Dialog: Xrm.Utility.alertDialog(this.statusText);

                            // V9.00 Method for Alert Dialog, Changed by SS_A.Jawad:

                            var alertStrings = { confirmButtonLabel: "Ok", text: this.statusText };
                            var alertOptions = { height: 120, width: 260 };
                            Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                                function success(result) {
                                    console.log("Alert dialog closed");
                                },
                                function (error) {
                                    $('#update_products').removeClass('is-active');
                                    console.log(error.message + "#611 Api failed ss_ProductSelector Matrix. Cannot get data from entity product price levels");
                                });

                        }
                    }
                };
                MakeFieldsReadOnly();
                req.send();

            } //end of loadProducts

            $(document).on("focusin", ".DiscountedSetupTextbox", function () {
                // skip for arrow keys
                ///marker111

                var discountedsetuptextboxvalue = $(this).val();
                singlesetupfield = $(this).val();

                var obj = RemoveFormattings(discountedsetuptextboxvalue);
                if (DecimalSymbol === ',') {
                    obj = obj.replace('.', ',');
                }

                $(this).val(obj);

            });
            $(document).on("focusout", ".DiscountedSetupTextbox", function () {
                // skip for arrow keys
                //marker 212

                var textboxvalue = $(this).val();

                // textboxvalue = Number.parseInt(textboxvalue);
                //now
                if (DecimalSymbol === ',') {
                    // for german
                    textboxvalue = textboxvalue.replace(',', '.');
                    // textboxvalue = Number.parseFloat(textboxvalue);
                } else {
                    //textboxvalue = Number.parseFloat(textboxvalue);
                }
                //til-now
                //console.log(textboxvalue);
                if (textboxvalue >= 0) {

                    var obj = AddFormattings(textboxvalue);
                    //now

                    //til-now

                    $(this).val(obj);


                }
            });
            $(document).on("focusin", ".DiscountedLicTextbox", function () {
                // skip for arrow keys
                //    debugger;
                var textboxvalue = $(this).val();
                singlelicensefield = $(this).val();

                var obj = RemoveFormattings(textboxvalue);
                if (DecimalSymbol === ',') {
                    obj = obj.replace('.', ',');
                }
                $(this).val(obj);

            });
            //===========

            $(document).on("focusout", ".DiscountedLicTextbox", function () {
                // skip for arrow keys
                //  debugger;
                var textboxvalue = $(this).val();

                //textboxvalue = Number.parseInt(textboxvalue);
                //now
                if (DecimalSymbol === ',') {
                    // for german
                    textboxvalue = textboxvalue.replace(',', '.');
                    // textboxvalue = Number.parseFloat(textboxvalue);
                } else {
                    // textboxvalue = Number.parseFloat(textboxvalue);
                }
                //til-now
                if (textboxvalue >= 0) {
                    var obj = AddFormattings(textboxvalue);
                    //now

                    //til-now

                    $(this).val(obj);


                }

            });

            //==============
            $(document).on("focusin", ".mDiscountedLicTextbox", function () {
                // skip for arrow keys
                //    debugger;
                var textboxvalue = $(this).val();
                singlemlicensefield = $(this).val();
                var obj = RemoveFormattings(textboxvalue);
                if (DecimalSymbol === ',') {
                    obj = obj.replace('.', ',');
                }
                $(this).val(obj);

            });
            $(document).on("focusout", ".mDiscountedLicTextbox", function () {
                // skip for arrow keys
                //  debugger;
                var textboxvalue = $(this).val();
                //textboxvalue = Number.parseInt(textboxvalue);
                //now
                if (DecimalSymbol === ',') {
                    // for german
                    textboxvalue = textboxvalue.replace(',', '.');
                    // textboxvalue = Number.parseFloat(textboxvalue);
                }
                //til-now
                if (textboxvalue >= 0) {
                    var obj = AddFormattings(textboxvalue);
                    //now

                    //til-now

                    $(this).val(obj);



                }

            });
            //for getting the opportunity product later to be used for already added products
            function getOpportunityProducts() {

                var id = opener.parent.Xrm.Page.data.entity.getId();
                var fetchXml = '<fetch>' +
                    '<entity name="opportunityproduct" >' +
                    '<all-attributes />' +
                    '  <filter>' +
                    '    <condition attribute="opportunityid" operator="eq" value="' + id + '" />' +
                    '  </filter>' +
                    '   <order attribute="productidname" />' +
                    '<link-entity name="product" from="productid" to="productid" link-type="outer"  >' +
                    '  <attribute name="producttypecode" />' +
                    ' <link-entity name="ss_productdescription" from="ss_productsid" to="productid" link-type="outer" alias="pdescrition" >' +
                    '  <attribute name="ss_name" />' +
                    ' </link-entity>' +
                    '  </link-entity>' +
                    '</entity>' +
                    '</fetch>';

                var req = new XMLHttpRequest();
                req.open("GET", parent.Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.0/opportunityproducts?fetchXml=" + encodeURI(fetchXml), true);
                req.setRequestHeader("OData-MaxVersion", "4.0");
                req.setRequestHeader("OData-Version", "4.0");
                req.setRequestHeader("Accept", "application/json");
                req.setRequestHeader("Prefer", "odata.include-annotations=\"OData.Community.Display.V1.FormattedValue\"");
                req.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        req.onreadystatechange = null;
                        if (this.status === 200) {
                            oportunityproducts = JSON.parse(this.response);
                            loadproducts();
                        }
                        else {
                            alert(this.statusText);
                        }
                    }

                };
                req.send();
            }
            //Adding Products in the opportunity
            function addProducts(productId, UnitId, csdate) {
                //debugger;
                var testCount = 0;

                var entitycollection = [];


                var opID = window.top.opener.parent.Xrm.Page.data.entity.getId();
                for (var i = 0; i < productId.length; i++) {
                    var subtable = "";
                    var isLicProduct = false;
                    var entity = {};
                    entity["uomid@odata.bind"] = "/uoms(" + UnitId[i].replace('{', '').replace('}', '') + ")";
                    entity["productid@odata.bind"] = "/products(" + productId[i].replace('{', '').replace('}', '') + ")";
                    entity["opportunityid@odata.bind"] = "/opportunities(" + opID.replace('{', '').replace('}', '') + ")";

                    if ($("#" + productId[i] + "_C").length > 0 && $("#" + productId[i] + "_Setup").length > 0) {

                        //nh================================
                        subtable = $("#" + productId[i] + "_P").closest('tr').next();
                        var crmproductgroups = $("#" + productId[i] + "_P").closest('tr').find('td:eq(20)').attr('id');
                        var productmaincategory = $("#" + productId[i] + "_P").closest('tr').find('td:eq(21)').attr('id');
                        var oppProdDesc = $("#" + productId[i] + "_P").closest('tr').find('td:last-child').text();

                        if (crmproductgroups != undefined && crmproductgroups != "") {
                            entity.ss_crmproductgroups = parseInt(crmproductgroups);
                        }
                        if (productmaincategory != undefined && productmaincategory != "") {
                            entity.ss_productmaincategory = parseInt(productmaincategory);
                        }
                        //  if(oppProdDesc === undefined || oppProdDesc === null || oppProdDesc === "undefined")
                        //  {
                        //     entity.ss_customdescription =  "";
                        //  }
                        //  else
                        //  {
                        //     entity.ss_customdescription = "\n" + oppProdDesc.replace("20", );                            
                        //  }
                        //===============================nh
                        if ($("#" + productId[i] + "_P").html() != null && $("#" + productId[i] + "_P").html() != "" && $("#" + productId[i] + "_P").html() != undefined) {
                            entity.ispriceoverridden = true;    //overridden
                            entity.priceperunit = Number($("#" + productId[i] + "_P").html());
                        }
                        //===

                        entity.ss_monthlylicensefee = 0.00;


                        //===
                        if ($("#" + productId[i] + "_C").val() != null && $("#" + productId[i] + "_C").val() != "" && $("#" + productId[i] + "_C").val() != undefined) {
                            entity.description = $("#" + productId[i] + "_C").val();
                        }
                        if ($("#" + productId[i] + "_Setup").text() != null && $("#" + productId[i] + "_Setup").text() != "" && $("#" + productId[i] + "_Setup").text() != undefined) {
                            entity.manualdiscountamount = Number($("#" + productId[i] + "_Setup").html());
                        }
                        producttype = 717800000;


                    }
                    else if ($("#" + productId[i] + "_Lic").length > 0) {
                        //nh================================
                        isLicProduct = true;
                        subtable = $("#" + productId[i] + "_LP").closest('tr').next();
                        var crmproductgroups = $("#" + productId[i] + "_LP").closest('tr').find('td:eq(20)').html();
                        var productmaincategory = $("#" + productId[i] + "_LP").closest('tr').find('td:eq(21)').html();
                        var oppProdDesc = $("#" + productId[i] + "_LP").closest('tr').find('td:last-child').text();

                        if (crmproductgroups != undefined && crmproductgroups != "") {
                            entity.ss_crmproductgroups = parseInt(crmproductgroups);
                        }
                        if (productmaincategory != undefined && productmaincategory != "") {
                            entity.ss_productmaincategory = parseInt(productmaincategory);
                        }

                        //===============================nh
                        if ($("#" + productId[i] + "_LP").html() != null && $("#" + productId[i] + "_LP").html() != "" && $("#" + productId[i] + "_LP").html() != undefined) {
                            entity.ispriceoverridden = true;    //overridden

                            entity.priceperunit = Number($("#" + productId[i] + "_LP").html());

                        }

                        //=========
                        if ($("#" + productId[i] + "_MLP").html() != null && $("#" + productId[i] + "_MLP").html() != "" && $("#" + productId[i] + "_MLP").html() != undefined) {

                            entity.ss_monthlylicensefee = Number($("#" + productId[i] + "_MLP").html());
                        }
                        //=======
                        if ($("#" + productId[i] + "_Lic").html() != null && $("#" + productId[i] + "_Lic").html() != "" && $("#" + productId[i] + "_Lic").html() != undefined) {
                            entity.manualdiscountamount = Number($("#" + productId[i] + "_Lic").html());


                        }


                        

                        producttype = 717800001;
                    }
                    //============
                    if ($("#" + productId[i] + "_SDATE").val() != null && $("#" + productId[i] + "_SDATE").val() != "" && $("#" + productId[i] + "_SDATE").val() != undefined) {
                            
                        var ContractSDate = new Date($("#" + productId[i] + "_SDATE").val());
                            if (ContractSDate > contractStartDate) {
                                contractStartDate = ContractSDate;

                            }



                            entity.ss_startdate = $("#" + productId[i] + "_SDATE").val();
                        }
                        else
                        {
                            entity.ss_startdate = null;
                        }
                        if ($("#" + productId[i] + "_EDATE").html() != null && $("#" + productId[i] + "_EDATE").val() != "" && $("#" + productId[i] + "_EDATE").val() != undefined) {

                            entity.ss_termenddate = $("#" + productId[i] + "_EDATE").val();
                             var tempEndDate = new Date($("#" + productId[i] + "_EDATE").val());
                             if(tempEndDate > contractEndDate) {
                                contractEndDate = tempEndDate;
                             }

                        }
                        else
                        {
                            entity.ss_termenddate = null;
                        }
                    if($("#" + productId[i] + "_CL").length > 0)
                        {
                            
                            var contractlength = $("#" + productId[i] + "_CL").closest('tr').find('.contract_val').val();
                         
                                entity.ss_productcontractlength = parseInt(contractlength);
                            
                        }
                    //Nh======================17-July-2020============
                    var subtableClass = $(subtable).attr('class');


                    if (subtableClass === "OppProducts") {
                        AddSubTableDataForIntegrityLine(entity, subtable, isLicProduct, oppProdDesc);
                    }
                    else if (subtableClass === "OppProducts2") {
                        AddSubTableDataForIntegrityAdd_On(entity, subtable, isLicProduct)
                    }
                    else if (subtableClass === "OppProducts3" || subtableClass === "OppProducts4") {
                        AddSubTableDataForPolicyManager(entity, subtable, isLicProduct);
                    }
                    //new
                    else if (subtableClass === "OppProducts5") {
                        AddSubTableDataForRegulatoryNews(entity, subtable, isLicProduct);
                    }
                    //======================17-July-2020===============nH

                    var x = $("#_SDATE").val();
                    entity.ss_producttype = producttype;
                    entity.quantity = Number(parseFloat(1).toFixed(5));
                    entitycollection.push(JSON.stringify(entity));
                }
                //=======
                // if (testCount == 0) {
                //     opener.parent.Xrm.Page.getAttribute("ss_contractstartdate").setValue(null);
                // }
                // if (testCount > 0) {
                //     opener.parent.Xrm.Page.getAttribute("ss_contractstartdate").setValue(csdate);
                // }
                //=======

                var data = [];
                data.push('--batch_123789');
                data.push('Content-Type: multipart/mixed;boundary=changeset_BBB457');
                data.push('');
                //Add requests to the collection
                for (var i = 0; i < entitycollection.length; i++) {
                    data.push('--changeset_BBB457');
                    data.push('Content-Type:application/http');
                    data.push('Content-Transfer-Encoding:binary');
                    var id = i + 1;
                    data.push('Content-ID:' + id);
                    data.push('');
                    data.push('POST ' + parent.Xrm.Utility.getGlobalContext().getClientUrl() + '/api/data/v8.2/opportunityproducts HTTP/1.1');
                    data.push('Content-Type:application/json;type=entry');
                    data.push('');
                    data.push(entitycollection[i]);
                }
                data.push('--changeset_BBB457--');
                data.push('--batch_123789--');
                //alert();
                //prompt("copy",JSON.stringify(data));
                var payload = data.join('\r\n');
                $.ajax(
                    {
                        method: 'POST',
                        url: parent.Xrm.Utility.getGlobalContext().getClientUrl() + '/api/data/v8.2/$batch',
                        headers: {
                            'Content-Type': 'multipart/mixed;boundary=batch_123789',
                            'Accept': 'application/json',
                            'Odata-MaxVersion': '4.0',
                            'Odata-Version': '4.0'

                        },
                        data: payload,
                        async: false,

                        success: function (data) {
                            //console.dir(data);
                            //  $('#update_products').removeClass('is-active');

                        },
                        error: function (xhr, textStatus, errorThrown) {
                            $('#update_products').removeClass('is-active');
                            alert(textStatus + " " + errorThrown + " " + "#612 Api failed ss_productSelectorMatrix.Cannot push data into entity opportunit products");
                        }
                    });


                //updating Term Start Date and Term End Date (Changes By Zain Arshad)

                return csdate;
            }
            //Update Products in the opportunity Products
            //pointer upd1
            function updateProducts() {


                var productID = [];
                var unitID = [];
                var delProdID = [];
                var updateProductID = [];


                //getting rows which are unchecked
                $(".tbody").each(function () {
                    $(this).find("tr.opportunityProduct").each(function () {


                        var td = $(this).find('td');
                        var input = $(td[2]).find("input");
                        if (input[0].checked === false) {


                            delProdID.push($(td[0], this).html());

                            if ($(td[11], this).html() != null && $(td[11], this).html() != "") {
                                delProdID.push($(td[11], this).html());

                            }

                        }

                    });
                });

                if (delProdID.length > 0) {
                    deleteProducts(delProdID);
                    //====
                    //opener.parent.Xrm.Page.getAttribute("ss_contractstartdate").setValue(null);
                    //===
                }

                //to update already added products
                $(".tbody").each(function () {
                    //$(this).find("input:checkbox:checked").each(function (index, item) {
                    $(this).find("tr.opportunityProduct").each(function () {
                        //======
                        var td = $(this).find('td');
                        var input = $(td[2]).find("input");
                        if (input[0].checked === true) {
                            //=====    
                            var setupProdid = $(this).find('td.DiscountSetup').attr('id');

                            if (setupProdid != null && setupProdid != "") {
                                var id = setupProdid.split('_');
                               //alert(id[0] +" <=> "+ id[1]);
                                if (updateProductID.indexOf(id[0]) === -1) {

                                    updateProductID.push(id[0]);
                                }
                            }

                            var LicProdid = $(this).find('td.DiscountLic').attr('id');
                            if (LicProdid != null && LicProdid != "") {

                                updateProductID.push(LicProdid);
                            }
                        }
                    });
                });

                if (updateProductID.length > 0) {
                    //======
                    var ContractStartDate = new Date("01-Sep-2001");
                    //=======
                    var ContractDate = updateComments(updateProductID, ContractStartDate);

                }



                //to add products in the Opportunity
                $(".tbody").each(function () {
                    $(this).find("tr.PriceListItem").each(function () {

                        var td = $(this).find('td');


                        var input = $(td[2]).find("input");

                        if (input[0].checked === true) {


                            productID.push($(td[0], this).html());
                            unitID.push($(td[1], this).html());

                            if ($(td[11], this).html() != null && $(td[11], this).html() != "") {
                                productID.push($(td[11], this).html());

                            }
                            if ($(td[12], this).html() != null && $(td[12], this).html() != "") {
                                unitID.push($(td[12], this).html());
                            }
                        }
                    });
                });


                if (productID.length > 0) {
                    //=======
                    var ContractStartDate = new Date("01-Sep-2001");
                    //=======
                    var ContractDate = addProducts(productID, unitID, ContractStartDate);

                }





                opener.parent.Xrm.Page.getAttribute("ss_productselectortimestamp").setValue(new Date());
                //Nh======================================== 14-Oct-2020
                // if(!isSaveandClose)
                // {
                //     getParentDate();
                // }

                //==================================================nH
                //=======nd
                getTotalSetupAndLicfee(isSaveandClose);


                // var gettotals = getTotalSetupAndLicfee();
                // if(gettotals)
                // {
                //     opener.window.location.reload(true);
                // opener.parent.Xrm.Page.data.save().then(function () {
                //     opener.parent.Xrm.Page.data.refresh();

                //     //change M107 loader
                //     $('#update_products').removeClass('is-active');
                //     if (isSaveandClose === true) {
                //         window.close();
                //     }

                // });
                // }

            }

            function updateComments(oppoid, csdate) {

                entitycollection = [];
                var testCount = 0;
                for (var i = 0; i < oppoid.length; i++) {
                    var entity = {};
                    var subtable = "";
                    var isLicProduct = false;
                    if ($("#" + oppoid[i] + "_C").length > 0 && $("#" + oppoid[i] + "_S").length > 0 && $("#" + oppoid[i] + "_P").length > 0) {
                        //nh================================
                        subtable = $("#" + oppoid[i] + "_P").closest('tr').next();
                        var crmproductgroups = $("#" + oppoid[i] + "_P").closest('tr').find('td:eq(20)').attr('id');
                        var productmaincategory = $("#" + oppoid[i] + "_P").closest('tr').find('td:eq(21)').attr('id');
                        var oppProdDesc = $("#" + oppoid[i] + "_P").closest('tr').find('td:last-child').text();

                        if (crmproductgroups != undefined && crmproductgroups != "") {
                            entity.ss_crmproductgroups = parseInt(crmproductgroups);
                        }
                        if (productmaincategory != undefined && productmaincategory != "") {
                            entity.ss_productmaincategory = parseInt(productmaincategory);
                        }
                        //  if(oppProdDesc === undefined || oppProdDesc === null || oppProdDesc === "undefined")
                        //  {
                        //     entity.ss_customdescription =  "";
                        //  }
                        //  else
                        //  {
                        //     entity.ss_customdescription = "\n" + oppProdDesc;                            
                        //  }
                        //===============================nh
                        if ($("#" + oppoid[i] + "_P").html() != null && $("#" + oppoid[i] + "_P").html() != "" && $("#" + oppoid[i] + "_P").html() != undefined) {
                            entity.ispriceoverridden = true;    //if overridden
                            entity.priceperunit = Number($("#" + oppoid[i] + "_P").html());
                        }
                        //===

                        entity.ss_monthlylicensefee = 0.00;
                        //===
                        if ($("#" + oppoid[i] + "_S").html() != null && $("#" + oppoid[i] + "_S").html() != "" && $("#" + oppoid[i] + "_S").html() != undefined) {
                            entity.manualdiscountamount = Number($("#" + oppoid[i] + "_S").html());
                        }
                        if ($("#" + oppoid[i] + "_C").val() != null && $("#" + oppoid[i] + "_C").val() != "" && $("#" + oppoid[i] + "_C").val() != undefined) {
                            entity.description = $("#" + oppoid[i] + "_C").val();
                        }


                    }
                    else if ($("#" + oppoid[i]).length > 0 && $("#" + oppoid[i] + "_LP").length > 0) {
                        //nh================================
                        isLicProduct = true;
                        subtable = $("#" + oppoid[i] + "_LP").closest('tr').next();
                        var crmproductgroups = $("#" + oppoid[i] + "_LP").closest('tr').find('td:eq(20)').html();
                        var productmaincategory = $("#" + oppoid[i] + "_LP").closest('tr').find('td:eq(21)').html();
                        var oppProdDesc = $("#" + oppoid[i] + "_LP").closest('tr').find('td:last-child').text();

                        if (crmproductgroups != undefined && crmproductgroups != "") {
                            entity.ss_crmproductgroups = parseInt(crmproductgroups);
                        }
                        if (productmaincategory != undefined && productmaincategory != "") {
                            entity.ss_productmaincategory = parseInt(productmaincategory);
                        }

                        //===============================nh

                        testCount++;



                        if ($("#" + oppoid[i] + "_LP").html() != null && $("#" + oppoid[i] + "_LP").html() != "" && $("#" + oppoid[i] + "_LP").html() != undefined) {
                            entity.ispriceoverridden = true;    //overridden
                            entity.priceperunit = Number($("#" + oppoid[i] + "_LP").html());


                        }

                        //=======
                        if ($("#" + oppoid[i] + "_MLP").html() != null && $("#" + oppoid[i] + "_MLP").html() != "" && $("#" + oppoid[i] + "_MLP").html() != undefined) {

                            entity.ss_monthlylicensefee = Number($("#" + oppoid[i] + "_MLP").html());
                        }
                        //=============

                        if ($("#" + oppoid[i]).html() != null && $("#" + oppoid[i]).html() != "" && $("#" + oppoid[i]).html() != undefined) {
                            entity.manualdiscountamount = Number($("#" + oppoid[i]).html());


                        }
                        
                    }

                    if($("#" + oppoid[i] + "_SDATE").val() != null && $("#" + oppoid[i] + "_SDATE").val() != "" && $("#" + oppoid[i] + "_SDATE").val() != undefined)
                    {
                        entity.ss_startdate = $("#" + oppoid[i] + "_SDATE").val();
                        var tempSDate = new Date($("#" + oppoid[i] + "_SDATE").val());
                            if(tempSDate > contractEndDate) {
                                contractStartDate = tempSDate;
                             }
                        
                    }
                    else
                    {
                        entity.ss_startdate = null;
                    }
                    if($("#" + oppoid[i] + "_EDATE").val() != null && $("#" + oppoid[i] + "_EDATE").val() != "" && $("#" + oppoid[i] + "_EDATE").val() != undefined)
                    {
                        entity.ss_termenddate = $("#" + oppoid[i] + "_EDATE").val();
                             var tempEndDate = new Date($("#" + oppoid[i] + "_EDATE").val());
                            if(tempEndDate > contractEndDate) {
                                 contractEndDate = tempEndDate;
                             }
                    }
                    else
                    {
                        entity.ss_termenddate = null;
                    }
                    var oppstartdate = $("#" + oppoid[i] + "_SDATE").val();
                    var ContractSDate = oppstartdate ? new Date(oppstartdate) : new Date("01-Sep-2001");

                        // var preContractDate = opener.parent.Xrm.Page.getAttribute("ss_contractstartdate").getValue();
                        if(ContractSDate > csdate) {
                             csdate = ContractSDate;
                         }
                    if($("#" + oppoid[i] + "_CL").length > 0)
                        {
                            var contractlength = $("#" + oppoid[i] + "_CL").closest('tr').find('.contract_val').val();
                           
                                entity.ss_productcontractlength = parseInt(contractlength);
                            
                        }
                    //Nh======================17-July-2020===============
                    var subtableClass = $(subtable).attr('class');

                    if (subtableClass === "OppProducts") {
                        AddSubTableDataForIntegrityLine(entity, subtable, isLicProduct, oppProdDesc);
                    }
                    else if (subtableClass === "OppProducts2") {
                        AddSubTableDataForIntegrityAdd_On(entity, subtable, isLicProduct);
                    }
                    else if (subtableClass === "OppProducts3" || subtableClass === "OppProducts4") {
                        AddSubTableDataForPolicyManager(entity, subtable, isLicProduct);
                    }
                    //new
                    else if (subtableClass === "OppProducts5") {
                        AddSubTableDataForRegulatoryNews(entity, subtable, isLicProduct);
                    }
                    //======================17-July-2020=============nH
                    entitycollection.push(JSON.stringify(entity));

                }
                //====
                // if (testCount == 0) {
                //     opener.parent.Xrm.Page.getAttribute("ss_contractstartdate").setValue(null);
                // }
                // if (testCount > 0) {
                //     opener.parent.Xrm.Page.getAttribute("ss_contractstartdate").setValue(csdate);
                // }
                //====

                var data = [];
                data.push('--batch_9999');
                data.push('Content-Type: multipart/mixed;boundary=changeset_BBB786');
                data.push('');
                //Add requests to the collection
                for (var i = 0; i < entitycollection.length; i++) {
                    data.push('--changeset_BBB786');
                    data.push('Content-Type:application/http');
                    data.push('Content-Transfer-Encoding:binary');
                    var id = i + 1;
                    data.push('Content-ID:' + id);
                    data.push('');
                    data.push('PATCH ' + parent.Xrm.Utility.getGlobalContext().getClientUrl() + '/api/data/v8.2/opportunityproducts(' + oppoid[i].replace("{", "").replace("}", "") + ')  HTTP/1.1');
                    data.push('Content-Type:application/json;type=entry');
                    data.push('');
                    data.push(entitycollection[i]);
                }
                data.push('--changeset_BBB786--');
                data.push('--batch_9999--');
                var payload = data.join('\r\n');
                $.ajax(
                    {
                        method: 'PATCH',
                        url: parent.Xrm.Utility.getGlobalContext().getClientUrl() + '/api/data/v8.2/$batch',
                        headers: {
                            'Content-Type': 'multipart/mixed;boundary=batch_9999',
                            'Accept': 'application/json',
                            'Odata-MaxVersion': '4.0',
                            'Odata-Version': '4.0'

                        },
                        data: payload,
                        async: false,

                        success: function (data) {
                            //  $('#update_products').removeClass('is-active');



                        },
                        error: function (xhr, textStatus, errorThrown) {
                            $('#update_products').removeClass('is-active');
                            alert(textStatus + " " + errorThrown + " #613 Api falid ss_productSelectorMatrix.Cannot push data to entity opportunity product");
                        }
                    });


                return csdate;
            }  //end update comments method


            function deleteProducts(delProdID) {

                var data = [];
                data.push('--batch_123456');
                data.push('Content-Type: multipart/mixed;boundary=changeset_BBB456');
                data.push('');
                //Add requests to the collection
                for (var i = 0; i < delProdID.length; i++) {
                    data.push('--changeset_BBB456');
                    data.push('Content-Type:application/http');
                    data.push('Content-Transfer-Encoding:binary');
                    var id = i + 1;
                    data.push('Content-ID:' + id);
                    data.push('');
                    data.push('DELETE ' + opener.Xrm.Utility.getGlobalContext().getClientUrl() + '/api/data/v8.1/opportunityproducts(' + delProdID[i] + ') HTTP/1.1');
                    data.push('Content-Type:application/json;type=entry');
                    data.push('');
                    data.push('{}');
                }
                data.push('--changeset_BBB456--');
                data.push('--batch_123456--');
                var payload = data.join('\r\n');
                $.ajax(
                    {
                        method: 'POST',

                        url: opener.Xrm.Utility.getGlobalContext().getClientUrl() + '/api/data/v8.1/$batch',
                        headers: {
                            'Content-Type': 'multipart/mixed;boundary=batch_123456',
                            'Accept': 'application/json',
                            'Odata-MaxVersion': '4.0',
                            'Odata-Version': '4.0'

                        },
                        data: payload,
                        async: false,
                        success: function (data, textStatus, xhr) {


                        },
                        error: function (xhr, textStatus, errorThrown) {
                            //  alert(textStatus + " " + errorThrown);
                            alert("Error Occurred \n" + "TextStatus: " + textStatus + "\n ErrorThrown :" + errorThrown);

                            LogExceptioninCRM(errorThrown, 0, " #614 Api failed ss_ProductSelectorMatrix. Error in deleting opportunityproducts");
                            window.close();
                        }
                    });
            }

            function calculateFee() {
                SetupFee = 0;
                licenseFee = 0;
                mlicenseFee = 0;
                discSetupFee = 0;
                discLicenseFee = 0;
                mdiscLicenseFee = 0;
                $(".tbody").each(function () {
                    $(this).find("input:checkbox:checked").each(function (index, item) {
                        var checkBoxClass = $(this).attr("class");
                        if (checkBoxClass.includes("supportb") || checkBoxClass.includes("supportp") || checkBoxClass.includes("supportb2") || checkBoxClass.includes("supportp2") || checkBoxClass.includes("supportb3") || checkBoxClass.includes("supportp3") || checkBoxClass.includes("integ_essential") || checkBoxClass.includes("fieldcheck") || checkBoxClass.includes("additionaldetails") || checkBoxClass.includes("fieldcheck_kap") || checkBoxClass.includes("fieldcheck_pak")) {
                            return;
                        }
                        //For original Setup Fee
                        var amount = ($(this).closest("tr").find(".originalSetup").html());
                        var nextRow = $(this).closest("tr").next();
                        var nextRowClass = $(nextRow).attr("class");
                        if (nextRowClass === "OppProducts") {
                            $("#ss_imphours_ps").val(CalculateImplementationHours(Number(amount)));
                        }
                        SetupFee += Number(amount);

                        //For Original License Fee
                        var licamount = ($(this).closest("tr").find(".originalLicense").html());


                        licenseFee += Number(licamount);

                        var mlicamount = ($(this).closest("tr").find(".moriginalLicense").html());


                        mlicenseFee += Number(mlicamount);



                        //For discounted Setup fee
                        //var discAmount = ($(this).closest("tr").find(".DiscountedSetup").html());
                        var discAmount = ($(this).closest("tr").find(".DiscountedSetupTextbox").val());
                        discAmount = RemoveFormattings(discAmount);

                        discSetupFee += Number(discAmount);

                        //for discounted License Fee
                        //var discLicAmount = ($(this).closest("tr").find(".DiscountedLic").html());
                        var discLicAmount = ($(this).closest("tr").find(".DiscountedLicTextbox").val());
                        discLicAmount = RemoveFormattings(discLicAmount);

                        discLicenseFee += Number(discLicAmount);

                        var mdiscLicAmount = ($(this).closest("tr").find(".mDiscountedLicTextbox").val());
                        mdiscLicAmount = RemoveFormattings(mdiscLicAmount);

                        mdiscLicenseFee += Number(mdiscLicAmount);
                    });

                });

                document.getElementById("setupFee").value = AddFormattings(discSetupFee.toFixed(2));
                document.getElementById("licFee").value = AddFormattings(discLicenseFee.toFixed(2));
                document.getElementById("mlicFee").value = AddFormattings(mdiscLicenseFee.toFixed(2));


            }
            var SetupDiscount = 0;
            var licDiscount = 0;
            var mlicDiscount = 0;

            function calculateSetupDiscount() {

                SetupDiscount = 0;
                SetupDiscount = document.getElementById("setupFee").value;

                if (DecimalSymbol === ',') {
                    // for german
                    SetupDiscount = SetupDiscount.replace(',', '.');
                }
                // var formattedNumber = AddFormattings(SetupDiscount);
                // $("#setupFee").val(formattedNumber);
                SetupDiscount = parseFloat(SetupDiscount);
                SetupFee = parseFloat(SetupFee);
                if (Number(SetupDiscount) != Number(SetupFee) && Number(SetupDiscount) < Number(SetupFee)) {
                    SetupDiscount = (SetupFee) - Number(SetupDiscount);
                }
                else {
                    SetupDiscount = 0;
                }



                changeSetupDiscount();
            }
            function calculateLicDiscount() {
                licDiscount = 0;
                licDiscount = document.getElementById("licFee").value;
                if (DecimalSymbol === ',') {
                    // for german
                    licDiscount = licDiscount.replace(',', '.');
                }
                //   document.getElementById("licFee").value = AddFormattings(licDiscount);

                if (Number(licDiscount) != Number(licenseFee) && Number(licDiscount) < Number(licenseFee)) {
                    licDiscount = (licenseFee) - Number(licDiscount);
                }


                changeLicDiscount();
                calculateFee();
            }
            //////////////
            function calculatemLicDiscount() {
                mlicDiscount = 0;
                mlicDiscount = document.getElementById("mlicFee").value;
                if (DecimalSymbol === ',') {
                    // for german
                    mlicDiscount = mlicDiscount.replace(',', '.');
                }


                if (Number(mlicDiscount) != Number(mlicenseFee) && Number(mlicDiscount) < Number(mlicenseFee)) {
                    mlicDiscount = (mlicenseFee) - Number(mlicDiscount);
                }

                changemLicDiscount();
                calculateFee();
            }
            function changeSetupDiscount() {

                var manualDiscountSum = 0.00;
                var adjustmentDiscountRow;
                $(".tbody > tr").find("input[type='checkbox']:checked").each(function () {

                    var discount = 0;
                    var originalPrice = $(this).closest("tr").find(".originalSetup").html();
                    var nextRow = $(this).closest("tr").next();
                    var nextRowClass = $(nextRow).attr("class");

                    var orignaltextboxVal = parseFloat(RemoveFormattings($(this).closest("tr").find(".DiscountedSetupTextbox").val()));
                    if (Number(originalPrice) != 0) {
                        adjustmentDiscountRow = $(this);

                    }
                    if (SetupFee != 0) {
                        discount = ((Number(originalPrice) / Number(SetupFee)) * Number(SetupDiscount)).toFixed(2);
                    }


                    $(this).closest("tr").find(".DiscountSetup").html(Number(discount).toFixed(2));
                    manualDiscountSum = Number(discount);
                    discount = (Number(originalPrice) - Number(discount)).toFixed(2);
                    var newVal = orignaltextboxVal - discount;
                    var DiscValue = discount;
                    discount = AddFormattings(discount);
                    //$(this).closest("tr").find(".DiscountedSetup").html(discount);
                    $(this).closest("tr").find(".DiscountedSetup").html('<input type="text" class="DiscountedSetupTextbox" value="' + discount + '" style="text-align:center;">');
                    if (nextRowClass === "OppProducts" || nextRowClass === "OppProducts2" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4") {
                        if (nextRowClass === "OppProducts") {
                            $("#ss_imphours_ps").val(CalculateImplementationHours(DiscValue));
                        }
                        calculateSubTableSetupDiscount(nextRow);
                    }
                });


            }
            ///////////////
            function changemLicDiscount() {
                var adjustmentDiscountRow;
                var manualDiscountSum = 0;
                $(".tbody > tr").find("input[type='checkbox']:checked").each(function () {

                    var originalPrice = $(this).closest("tr").find(".moriginalLicense").html();
                    var originalPriceyearly = $(this).closest("tr").find(".originalLicense").html();
                    var discount = 0;
                    var nextRow = $(this).closest("tr").next();
                    var nextRowClass = $(nextRow).attr("class");
                    var yearlydiscount = 0;
                    var orignaltextboxVal = parseFloat(RemoveFormattings($(this).closest("tr").find(".mDiscountedLicTextbox").val()));
                    if (Number(originalPrice) != 0) {
                        adjustmentDiscountRow = $(this);

                    }
                    if (mlicenseFee != 0) {
                        discount = ((Number(originalPrice) / Number(mlicenseFee)) * Number(mlicDiscount)).toFixed(2);
                    }


                    discount = (Number(originalPrice) - Number(discount)).toFixed(2);
                    //$(this).closest("tr").find(".moriginalLicense").html(Number(discount).toFixed(2))
                    var yobj = discount;
                    yobj = (yobj * 12);

                    yearlydiscount = (originalPriceyearly - yobj);
                    $(this).closest("tr").find(".DiscountLic").html(Number(yearlydiscount).toFixed(2));
                    //======
                    $(this).closest("tr").find(".moriginalLicense").html(Number(discount).toFixed(2));
                    //======
                    yobj = AddFormattings(yobj);
                    var newVal = orignaltextboxVal - discount;
                    discount = AddFormattings(discount);

                    $(this).closest("tr").find(".DiscountedLicTextbox").val(yobj);
                    // $(this).closest("tr").find(".mDiscountedLicTextbox").val(discount);
                    $(this).closest("tr").find(".mDiscountedLic").html('<input type="text" class="mDiscountedLicTextbox" value="' + discount + '" style="text-align:center;">');
                    if (nextRowClass === "OppProducts" || nextRowClass === "OppProducts2" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4") {
                        calculateSubTableMFeeDiscount(nextRow);
                    }
                });



            }
            function changeLicDiscount() {
                var adjustmentDiscountRow;
                var manualDiscountSum = 0;
                $(".tbody > tr").find("input[type='checkbox']:checked").each(function () {

                    var originalPrice = $(this).closest("tr").find(".originalLicense").html();
                    var discount = 0;
                    var nextRow = $(this).closest("tr").next();
                    var nextRowClass = $(nextRow).attr("class");
                    var orignaltextboxVal = parseFloat(RemoveFormattings($(this).closest("tr").find(".DiscountedLicTextbox").val()));
                    if (Number(originalPrice) != 0) {
                        adjustmentDiscountRow = $(this);

                    }
                    if (licenseFee != 0) {
                        discount = ((Number(originalPrice) / Number(licenseFee)) * Number(licDiscount)).toFixed(2);
                    }

                    ////
                    var test = Number(discount).toFixed(2);
                    $(this).closest("tr").find(".DiscountLic").html(Number(discount).toFixed(2));
                    manualDiscountSum += Number(discount);
                    discount = (Number(originalPrice) - Number(discount)).toFixed(2);
                    var newVal = orignaltextboxVal - discount;
                    var mobj = discount;
                    mobj = (mobj / 12);
                    //======
                    $(this).closest("tr").find(".moriginalLicense").html(Number(mobj).toFixed(2));
                    //=========
                    mobj = AddFormattings(mobj);
                    discount = AddFormattings(discount);

                    // $(this).closest("tr").find(".DiscountedLicTextbox").val(discount);
                    $(this).closest("tr").find(".mDiscountedLicTextbox").val(mobj);
                    $(this).closest("tr").find(".DiscountedLic").html('<input type="text" class="DiscountedLicTextbox" value="' + discount + '" style="text-align:center;">');
                    if (nextRowClass === "OppProducts" || nextRowClass === "OppProducts2" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4") {
                        calculateSubTableYFeeDiscount(nextRow);
                    }
                });
                //====================


            }


            ////prac
            $(document).on("change keyup paste", "#setupFee", function (event) {
                // skip for arrow keys
                if (event.which >= 37 && event.which <= 40) { event.preventDefault(); }

                // format number
                $(this).val(function (index, value) {

                    value = value.replace(/,/g, '');// u dont need this
                    if (value > SetupFee) {
                        value = SetupFee;
                    }
                    return value;
                });
            });
            //======

            $(document).on("change paste", ".DiscountedSetupTextbox", function (event) {

                var discount = 0.00;

                var textboxval = parseFloat($(this).val());

                if ((textboxval) >= 0) {
                    $(this).closest("tr").find(".originalSetup").html(textboxval);
                    $(this).closest("tr").find(".DiscountSetup").html(Number(discount).toFixed(2));
                    RemoveAllSetupDiscounts();
                    calculateFee();
                } else {

                    alert("Please enter a positive amount");
                    $(this).val(singlesetupfield);
                }
                var nextRow = $(this).closest("tr").next();
                var nextRowClass = $(nextRow).attr("class");
                if (nextRowClass === "OppProducts" || nextRowClass === "OppProducts2" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4") {

                    calculateSubTableSetupDiscount(nextRow);
                }

            });
            $(document).on("change paste", ".mDiscountedLicTextbox", function (event) {

                var discount = 0.00;
                var textboxvalue = parseFloat($(this).val());

                if (textboxvalue >= 0) {
                    var yfee = (textboxvalue * 12);
                    var yobj = AddFormattings(yfee);

                    $(this).closest("tr").find(".moriginalLicense").html(textboxvalue);
                    $(this).val(AddFormattings(textboxvalue));
                    $(this).closest("tr").find(".DiscountedLicTextbox").val(yobj);
                    $(this).closest("tr").find(".originalLicense").html(yfee);
                    $(this).closest("tr").find(".DiscountLic").html(Number(discount).toFixed(2));
                    //  RemoveAllmLicenceDiscounts();
                    RemoveAllLicenceDiscounts();
                    calculateFee();
                } else {
                    alert("Please enter a positive amount");
                    $(this).val(singlemlicensefield);
                    $(this).closest("tr").find(".moriginalLicense").html(singlemlicensefield);
                }
                var nextRow = $(this).closest("tr").next();
                var nextRowClass = $(nextRow).attr("class");
                if (nextRowClass === "OppProducts" || nextRowClass === "OppProducts2" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4") {
                    calculateSubTableMFeeDiscount(nextRow);
                }


            });
            $(document).on("change paste", ".DiscountedLicTextbox", function (event) {

                var discount = 0.00;
                var textboxvalue = parseFloat($(this).val());

                if (textboxvalue >= 0) {
                    var mfee = (textboxvalue / 12);
                    var mobj = AddFormattings(mfee);

                    $(this).closest("tr").find(".moriginalLicense").html(mfee);
                    $(this).closest("tr").find(".mDiscountedLicTextbox").val(mobj);
                    $(this).val(AddFormattings(textboxvalue));
                    $(this).closest("tr").find(".originalLicense").html(textboxvalue);
                    $(this).closest("tr").find(".DiscountLic").html(Number(discount).toFixed(2));
                    RemoveAllLicenceDiscounts();
                    // RemoveAllmLicenceDiscounts();
                    calculateFee();
                } else {
                    alert("Please enter a positive amount");
                    $(this).val(singlelicensefield);
                    $(this).closest("tr").find(".originalLicense").html(singlelicensefield);
                }
                var nextRow = $(this).closest("tr").next();
                var nextRowClass = $(nextRow).attr("class");
                if (nextRowClass === "OppProducts" || nextRowClass === "OppProducts2" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4") {
                    calculateSubTableYFeeDiscount(nextRow);
                }


            });
            //======
            $(document).on("change paste", "#setupFee", function (event) {
                if (($(this).val()) >= 0) {



                    calculateSetupDiscount();

                } else {

                    //resetting to original

                    $(this).val(setupfield);
                    alert("Please enter a positive amount");
                }

            });
            //=========
            $(document).on("change paste", "#licFee", function () {
                if (($(this).val()) >= 0) {
                    calculateLicDiscount();
                } else {

                    //resetting to original

                    $(this).val(licensefield);
                    alert("Please enter a positive amount");
                }
            });

            $(document).on("change paste", "#mlicFee", function () {
                if (($(this).val()) >= 0) {
                    calculatemLicDiscount();
                } else {

                    //resetting to original

                    $(this).val(mlicensefield);
                    alert("Please enter a positive amount");
                }
            });
            //=========
            $(document).on("change keyup paste", "#licFee", function () {
                // skip for arrow keys
                if (event.which >= 37 && event.which <= 40) { event.preventDefault(); }

                // format number
                $(this).val(function (index, value) {

                    value = value.replace(/,/g, '');// u dont need this
                    if (value > licenseFee) {
                        value = licenseFee;
                    }
                    return value;
                });
            });
            $(document).on("change keyup paste", "#mlicFee", function () {
                // skip for arrow keys
                if (event.which >= 37 && event.which <= 40) { event.preventDefault(); }

                // format number
                $(this).val(function (index, value) {

                    value = value.replace(/,/g, '');// u dont need this
                    if (value > mlicenseFee) {
                        value = mlicenseFee;
                    }
                    return value;
                });
            });
            ////end prac
            // function setTermination() {
            //     var option = document.getElementById("terminate").value;
            //     opener.parent.Xrm.Page.getAttribute("ss_terminationperiod").setValue(Number(option));
            // }
            // function setContract() {
            //     var option = document.getElementById("contract").value;
            //     opener.parent.Xrm.Page.getAttribute("ss_contractperiod").setValue(Number(option));

            // }
            function retrieveUserSettings() {

                // V8.00 Method for get userID :   var userId = opener.parent.Xrm.Page.context.getUserId();

                //Bellow line is V9.00 Method for get userID, cahnged by SS_A.Jawad:

                var userId = globelcontext.userSettings.userId;
                userId = userId.replace(/[{}]/g, "");

                var req = new XMLHttpRequest();
                req.open("GET", parent.Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.0/usersettingscollection(" + userId + ")?$select=decimalsymbol,numberseparator,uilanguageid", true);
                req.setRequestHeader("OData-MaxVersion", "4.0");
                req.setRequestHeader("OData-Version", "4.0");
                req.setRequestHeader("Accept", "application/json");
                req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
                req.setRequestHeader("Prefer", "odata.include-annotations=\"OData.Community.Display.V1.FormattedValue\"");
                req.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        req.onreadystatechange = null;
                        if (this.status === 200) {
                            var result = JSON.parse(this.response);
                            retrieveUserSettingsCallBack(result);

                        }
                        else {
                            alert(this.statusText);
                        }
                    }
                };
                req.send();


            }
            function retrieveUserSettingsCallBack(result) {

                DecimalSymbol = result["decimalsymbol"];
                NumberSeparator = result["numberseparator"];
                UILanguageId = result["uilanguageid"];
                // if (UILanguageId === 1031) {
                //     //need to replace invalid character in preceding code line row checkboxrow
                //     document.getElementById("plusimage").title = "Fgen Sie den Datensatz Verkaufschance (Produkt) hinzu.";
                //     document.getElementById("headerRow").innerHTML = "<tr id='headerRow'><th id='headercolumn'></th><th width='33%'>Produktname</th><th width='7%'>Einheit</th><th width='12%'>Einzelpreis</th><th width='10%'>Menge</th><th width='10%'>Rabatt</th><th width='13%'>Erweiterter Betrag</th><th width='10%'></th></tr>";
                // }
                var TransactionCurrwncyId = opener.parent.Xrm.Page.getAttribute("transactioncurrencyid").getValue();

                var Tid = TransactionCurrwncyId[0].id;
                Tid = Tid.replace("{", "").replace("}", "");
                retrieveCurrencySymbol(Tid);
            }
            function retrieveCurrencySymbol(Tid) {

                opener.parent.Xrm.WebApi.online.retrieveRecord("transactioncurrency", Tid, "?$select=currencysymbol").then(
                    function success(result) {
                        CurrencySymbol = result["currencysymbol"];
                        //Nh=======================================
                        app = "";
                        contractMail = "";
                        EQSIRCockpit = "";
                        news = "";
                        webcast = "";
                        reports = "";
                        LEI = "";
                        tool = "";
                        compliance = "";
                        XMLPRCockpit = "";
                        XMLKonzerngesellschaften = "";
                        XMLKonzern = "";
                        XMLFonds = "";
                        if (location.search != "") {
                            vals = location.search.substr(1).split("&");
                            for (var i in vals) {
                                vals[i] = vals[i].replace(/\+/g, " ").split("=");
                            }
                            //look for the parameter named 'data'
                            var found = false;
                            for (var i in vals) {
                                if (vals[i][0].toLowerCase() === "data") {
                                    parseDataValue(vals[i][1]);
                                    found = true;
                                    break;
                                }
                            }
                        }
                        //=======================================nH

                    },
                    function (error) {
                        parent.Xrm.Utility.alertDialog(error.message);
                    }
                );

            }
            // function retrieveCurrencySymbolCallBack(result) {

            //     CurrencySymbol = result["currencysymbol"];

            // }
            function showLoaderandCallUpdate(x) {
                //change M107 loader
                if (x === 0) {
                    isSaveandClose = true;
                }
                else {
                    isSaveandClose = false;
                }

                //===============================================================15-Sep-2020
                var isBasicOrPremiumChecked = false;
                var isSubTableIntegrityIncluded = false;
                var isBasic2OrPremium2Checked = false;
                var isSubTablePolicyIncluded = false;
                $(".tbody").each(function () {
                    $(this).find(".checkboxClass").each(function (index, item) {
                        var isChecked = $(this).prop("checked");

                        if (isChecked) {

                            var nextRow = $(this).closest("tr").next();
                            var nextRowClass = $(nextRow).attr("class");
                            if (nextRowClass === "OppProducts" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4") {
                                if (nextRowClass === "OppProducts") {
                                    isSubTableIntegrityIncluded = true;
                                    var subTBody = $(nextRow).find('td:eq(1)').find('.subtableBody');
                                    var tr7 = $(subTBody).find('tr:eq(7)');
                                    var tr8 = $(subTBody).find('tr:eq(8)');
                                    var sBasic = $(tr7).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
                                    var sprofessional = $(tr8).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
                                    if (sBasic || sprofessional) {
                                        isBasicOrPremiumChecked = true;
                                    }
                                }
                                else {
                                    isSubTablePolicyIncluded = true;
                                    var subTBody = $(nextRow).find('td:eq(1)').find('.subtableBody');
                                    var tr5 = $(subTBody).find('tr:eq(5)');
                                    var tr6 = $(subTBody).find('tr:eq(6)');
                                    var sBasic = $(tr5).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
                                    var sprofessional = $(tr6).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
                                    if (sBasic || sprofessional) {
                                        isBasic2OrPremium2Checked = true;
                                    }
                                }


                            }

                        }

                    });


                });

                //=====================================================================Nh
                if ((!isBasicOrPremiumChecked && isSubTableIntegrityIncluded) || (!isBasic2OrPremium2Checked && isSubTablePolicyIncluded)) {
                    var alertStrings = { confirmButtonLabel: "Ok", text: "Please select atleast one Basic Support or Professional Support" };
                    var alertOptions = { height: 150, width: 330 };
                    Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {

                        },
                        function (error) {
                            console.log(error.message);
                        });
                }
                else {
                    $('#update_products').attr('data-text', 'Updating Products');
                    $('#update_products').addClass('is-active');
                    setTimeout(function () { updateProducts(); }, 100);
                }


            }
            function getTotalSetupAndLicfee(isSaveandClose) {
                var Oppid = opener.parent.Xrm.Page.data.entity.getId();
                // var TotalLicensefee = discLicenseFee.toFixed(2);
                // var TotalSetupfee = discSetupFee.toFixed(2);
                var TotalLicensefee = discLicenseFee;
                var TotalSetupfee = discSetupFee;
                var tempdate = new Date("01-Sep-2001");
                var tempcontractenddate = null;
                var tempcontractstartdate = null;
                if (contractEndDate > tempdate) {

                    tempcontractenddate = contractEndDate;
                }
                if (tempcontractstartdate > tempdate) {

                    tempcontractstartdate = contractStartDate;
                }
                //nh===========
                var entity = {};
                entity.ss_totallicencefee = TotalLicensefee;
                entity.ss_totalsetupfee = TotalSetupfee;
                entity.ss_contractenddate = tempcontractenddate;
                entity.ss_contractstartdate = tempcontractstartdate;


                opener.parent.Xrm.WebApi.online.updateRecord("opportunity", Oppid, entity).then(
                    function success(result) {
                        var updatedEntityId = result.id;
                        opener.window.location.reload(true);
                        opener.parent.Xrm.Page.data.save().then(function () {
                            opener.parent.Xrm.Page.data.refresh();

                            //change M107 loader
                            $('#update_products').removeClass('is-active');
                            if (isSaveandClose === true) {
                                window.close();
                            }
                            else {
                                getParentDate();
                            }

                        });
                    },
                    function (error) {
                        opener.parent.Xrm.Utility.alertDialog("Error " + error.message);
                    }
                );
                //===========nh            
            }
        }
        catch (err) {
            alert(err.message);
        }
    </script>

    <div class="loader loader-default is-active" id="update_products" data-text="Loading"></div>
    <ul class="nav nav-tabs">
        <li class="active">
            <a data-toggle="tab" href="#home"> IR Cockpit </a>
        </li>
        <li>
            <a data-toggle="tab" href="#menu1"> IR Products </a>
        </li>
        <li>
            <a data-toggle="tab" href="#menu2"> Compliance Cockpit </a>
        </li>
        <li>
            <a data-toggle="tab" href="#menu3"> Compliance Product </a>
        </li>
    </ul>

    <div class="container" id="mainContainer">
        <div class="tab-content" id="product-list">
            <div id="home" class="tab-pane fade in active">
                <div class="tablepopulate" id="tblEQSIRCockpit"></div>
                <div class="tablepopulate" id="homeTbl1"></div>
                <div class="tablepopulate" id="homeTbl2"></div>
            </div>
            <div id="menu1" class="tab-pane fade"></div>
            <div id="menu2" class="tab-pane fade"></div>
            <div id="menu3" class="tab-pane fade"></div>
        </div>
        <div id="functionalArea">

            <div class="sumAmount" id="sumAmount">

                <div class="row" id="row">
                    <div class="col-sm-2" id="sb">
                        <label class="textbox_main">Setup</label>
                        <input type="text" pattern="[0-9]" class="SetupTextBox textbox_main" id="setupFee">
                    </div>
                    <div class="col-sm-2" id="mlb">
                        <label class="textbox_main">Monthly License</label>
                        <input type="text" class="SetupTextBox textbox_main" id="mlicFee">
                    </div>
                    <div class="col-sm-2" id="lb">
                        <label class="textbox_main">Yearly License</label>
                        <input type="text" class="SetupTextBox textbox_main" id="licFee">
                    </div>
                    <!-- <div class="col-sm-2">
                        <label class="textbox_main">Contract</label>
                        <select id="contract" class="textbox_main" onchange="setContract()">
                            <option value="0">None</option>
                            <option value="1">12</option>
                            <option value="2">18</option>
                            <option value="3">24</option>
                            <option value="4">36</option>
                        </select>
                    </div>
                    <div class="col-sm-2">
                        <label class="textbox_main">Termination</label>
                        <select id="terminate" class="textbox_main" onchange="setTermination()">
                            <option value="0">None</option>
                            <option value="1">1 Month</option>
                            <option value="2">3 Months</option>
                        </select>
                    </div> -->
                </div>
            </div>

            <div class="single-button" id="savebutton">
                <button class="btn btn-primary text-center btn_main" id="CancelOp_button" onclick="showLoaderandCallUpdate(0);">Save
                    And Close</button>
                <button class="btn btn-primary text-center btn_main" id="SaveOp_button" onclick="showLoaderandCallUpdate(1);">Save
                    Changes</button>
                <button class="btn btn-primary text-center btn_main" id="CancelOp_button" onclick="window.close()">Discard
                    Changes</button>

                <!-- <div id="msgDiv" style="display:none;margin-top: -520px; opacity:0.5; animation: 3s rotate linear infinite;"><img alt="" src="ss_bigloaderstill"></div>-->
                <!-- <div id="msgDiv" style="margin-top: -35px; padding-left: 210px;" class="loader"><img alt='' src='/_imgs/AdvFind/progress.gif' /></div> -->
                <!--<div id="msgDivText" style="margin-top: -190px;  text-align: center;  font-size: large; font-weight: bolder;">Loading Products...</div>-->
            </div>
        </div>
    </div>

    <script>
        $(document).on("focusin", "#setupFee", function () {

            // skip for arrow keys
            // marker111
            var textboxvalue = $(this).val();
            setupfield = textboxvalue;

            //debugger;
            var obj = RemoveFormattings(textboxvalue);

            if (DecimalSymbol === ',') {
                obj = obj.replace('.', ',');
            }


            $(this).val(obj);

        });
        $(document).on("focusin", "#licFee", function () {
            // skip for arrow keys

            var textboxvalue = $(this).val();
            licensefield = textboxvalue;

            var obj = RemoveFormattings(textboxvalue);
            if (DecimalSymbol === ',') {
                obj = obj.replace('.', ',');
            }


            $(this).val(obj);

        });

        $(document).on("focusin", "#mlicFee", function () {
            // skip for arrow keys

            var textboxvalue = $(this).val();
            mlicensefield = textboxvalue;
            var obj = RemoveFormattings(textboxvalue);
            if (DecimalSymbol === ',') {
                obj = obj.replace('.', ',');
            }


            $(this).val(obj);

        });
        $(function () {
            $("#setupFee").on("blur", function () {

                var textboxvalue = $(this).val();


                //marker 212

                if (DecimalSymbol === ',') {
                    textboxvalue = textboxvalue.replace(',', '.');
                }
                textboxvalue = Number.parseInt(textboxvalue);


                // textboxvalue = RemoveFormattings(textboxvalue);


                if (textboxvalue >= 0) {

                    textboxvalue = AddFormattings(textboxvalue);
                    $("#setupFee").val(textboxvalue);
                }
                else {
                    alert("Please enter a positive amount")
                    $(this).val(AddFormattings(textboxvalue));
                }

            });

        })
        $(function () {
            $("#mlicFee").on("blur", function () {

                var textboxvalue = $(this).val();
                if (DecimalSymbol === ',') {
                    textboxvalue = textboxvalue.replace(',', '.');
                }
                //marker 212
                textboxvalue = Number.parseInt(textboxvalue);
                //  textboxvalue = RemoveFormattings(textboxvalue);
                if (textboxvalue >= 0) {

                    textboxvalue = AddFormattings(textboxvalue);
                    $("#mlicFee").val(textboxvalue);

                }
                else {
                    alert("Please enter a positive amount");
                    $(this).val(AddFormattings(textboxvalue));
                }
            });
        })
        $(function () {
            $("#licFee").on("blur", function () {

                var textboxvalue = $(this).val();
                if (DecimalSymbol === ',') {
                    textboxvalue = textboxvalue.replace(',', '.');
                }
                //marker 212
                textboxvalue = Number.parseInt(textboxvalue);
                //  textboxvalue = RemoveFormattings(textboxvalue);
                if (textboxvalue >= 0) {

                    textboxvalue = AddFormattings(textboxvalue);
                    $("#licFee").val(textboxvalue);
                }
                else {
                    alert("Please enter a positive amount")
                    $(this).val(AddFormattings(textboxvalue));
                }
            });
        })
        function RemoveAllSetupDiscounts() {
            $(".tbody").each(function () {
                $(this).find("tr.opportunityProduct").each(function () {
                    //var discount=0;
                    //removing discount
                    // $(this).find('.DiscountSetup').html("");
                    //  $(this).find(".DiscountSetup").html(Number(discount).toFixed(2));

                    //resetting all to original
                    var original = $(this).find('.originalSetup').html();
                    var obj = AddFormattings(original);
                    $(this).find('.DiscountedSetupTextbox').val(obj); //removing

                });
            });
        }
        //////
        function RemoveAllmLicenceDiscounts() {
            $(".tbody").each(function () {
                $(this).find("tr.opportunityProduct").each(function () {

                    //removing discount
                    // $(this).find('.DiscountLic').html(""); //removing

                    //resetting all to original
                    var original = $(this).find('.moriginalLicense').html();
                    var obj = AddFormattings(original);
                    $(this).find('.mDiscountedLicTextbox').val(obj); //removing
                });
            });
        }
        function RemoveAllLicenceDiscounts() {
            $(".tbody").each(function () {
                $(this).find("tr.opportunityProduct").each(function () {

                    //removing discount
                    // $(this).find('.DiscountLic').html(""); //removing

                    //resetting all to original
                    var original = $(this).find('.originalLicense').html();
                    //======
                    var moriginal = original / 12;
                    moriginal = AddFormattings(moriginal);
                    $(this).find('.mDiscountedLicTextbox').val(moriginal);
                    //======
                    var obj = AddFormattings(original);
                    $(this).find('.DiscountedLicTextbox').val(obj); //removing
                });
            });
        }
        // Functions for Setting Term Start Date and End Date (Changes made by Zain Arshad)
        function dateForm(value) {
            var index = 10;
            var x = value.substring(0, index);
            var year = x.substring(0, 4);
            var month = x.substring(5, 7);
            var day = x.substring(8, 10);
            var date = year + "-" + month + "-" + day;
            return date;


        }


        function gettingCurrentDate() {
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = today.getFullYear();

            today = yyyy + '-' + mm + '-' + dd;

            return today;
        }

        $(document).on("click", ".integ_essential", function () {
            var isChecked = $(this).prop('checked');
            var sys_checked = $('.integrityCheckbox4').prop('checked');
            var best_checked = $('.integrityCheckbox2').prop('checked');
            var cls_checked = $('.integrityCheckbox1').prop('checked');
            if (isChecked) {
                $('.trshowhideclass').show();
            }
            else if (!sys_checked && !best_checked && !cls_checked) {
                $('.trshowhideclass').hide();
            }
        });


        $(document).on("click", ".checkboxClass", function () {


            var isChecked = $(this).prop('checked');
            var nextRowClass = $(this).closest('tr').next().attr('class');
            if (isChecked === false && (nextRowClass === "OppProducts" || nextRowClass === "OppProducts2" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4" || nextRowClass === "OppProducts5")) {
                $(this).closest('tr').next().hide();
            }
            else if (isChecked === true && (nextRowClass === "OppProducts" || nextRowClass === "OppProducts2" || nextRowClass === "OppProducts3" || nextRowClass === "OppProducts4" || nextRowClass === "OppProducts5")) {
                $(this).closest('tr').next().show();
            }


        });
        //new
        $(document).on("click", ".fieldcheck_pak", function () {
            var isChecked = $(this).prop('checked');
            var td = $(this).closest('td').next('td').attr('id');
            if (isChecked) {
                $('#' + td).show();
            }
            else {
                $('#' + td).hide();
            }
        });
        $(document).on("click", ".fieldcheck_kap", function () {
            var isChecked = $(this).prop('checked');
            var td = $(this).closest('td').next('td').attr('id');
            var td1 = $(this).closest('tr').find('td:last').attr('id');
            console.log("td1 is => " + td1);
            if (isChecked) {
                $('#' + td).show();
                $('#' + td1).show();
            }
            else {
                $('#' + td).hide();
                $('#' + td1).hide();
            }
        });
        $(document).on("click", "#additionaldetails", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.additionaldetailsRow').show();
            }
            else {
                $('.additionaldetailsRow').hide();
            }
        });
        $(document).on("click", ".supportp", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.supportb').prop('checked', false);
            }
        });
        $(document).on("click", ".supportb", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.supportp').prop('checked', false);
            }
        });

        $(document).on("click", ".supportp2", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.supportb2').prop('checked', false);
            }
        });
        $(document).on("click", ".supportb2", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.supportp2').prop('checked', false);
            }
        });
        $(document).on("click", ".supportp3", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.supportb3').prop('checked', false);
            }
        });
        $(document).on("click", ".supportb3", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.supportp3').prop('checked', false);
            }
        });

        //==========================================15-Oct-2020
        $(document).on("click", ".integrityCheckbox", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.integrityCheckbox2').prop('checked', false);
                $('.integrityCheckbox3').prop('checked', false);
                $('.integrityCheckbox4').prop('checked', false);
                $('#classic_sys').hide();
            }
        });
        $(document).on("click", ".integrityCheckbox2", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.integrityCheckbox').prop('checked', false);
                $('.integrityCheckbox3').prop('checked', false);
                // $('.integrityCheckbox4').prop('checked', false);
                //$('#classic_sys').hide();
                $('#classic_sys').show();
            }
        });
        $(document).on("click", ".integrityCheckbox3", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.integrityCheckbox').prop('checked', false);
                $('.integrityCheckbox2').prop('checked', false);
                //$('.integrityCheckbox4').prop('checked', false);
                //$('#classic_sys').hide();
                $('#classic_sys').show();
            }
        });
        $(document).on("click", ".integrityCheckbox4", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.integrityCheckbox').prop('checked', false);
                //$('.integrityCheckbox2').prop('checked', false);
                //$('.integrityCheckbox3').prop('checked', false);
                //$('#classic_sys').show();
            }

        });

        $(document).on("click", ".integrityCheckbox4", function () {
            var isChecked = $(this).prop('checked');
            if (isChecked) {
                $('.integrityCheckbox').prop('checked', false);
                //$('.integrityCheckbox2').prop('checked', false);
                //$('.integrityCheckbox3').prop('checked', false);
                //$('#classic_sys').show();
            }

        });

        $(document).on("focusin", ".subTableFee, .subTableMFee, .subTableYFee, .subTableSupportFee", function () {


            var updatedsetuptextboxvalue = $(this).val();

            var obj = RemoveFormattings(updatedsetuptextboxvalue);
            if (DecimalSymbol === ',') {
                obj = obj.replace('.', ',');
            }

            $(this).val(obj);

        });
        $(document).on("focusout", ".subTableFee, .subTableMFee, .subTableYFee, .subTableSupportFee", function () {


            var textboxvalue = $(this).val();
            if (DecimalSymbol === ',') {
                textboxvalue = textboxvalue.replace(',', '.');
            }
            //marker 212
            // textboxvalue = Number.parseInt(textboxvalue);

            if (textboxvalue >= 0) {

                var obj = AddFormattings(textboxvalue);

                $(this).val(obj);

            }
        });

        $(document).on("change", ".subTableSupportMFee", function () {

            var textboxvalue = $(this).val();
            if (DecimalSymbol === ',') {
                textboxvalue = textboxvalue.replace(',', '.');
            }
            //marker 212
            // textboxvalue = Number.parseInt(textboxvalue);               
            if (textboxvalue >= 0) {
                var newYFee = AddFormattings(textboxvalue * 12);
                $(this).closest('tr').find('td:eq(4)').find('input[type=text]').val(newYFee);
                var obj = AddFormattings(textboxvalue);
                $(this).val(obj);
            }
        });
        $(document).on("change", ".subTableSupportYFee", function () {

            var textboxvalue = $(this).val();
            if (DecimalSymbol === ',') {
                textboxvalue = textboxvalue.replace(',', '.');
            }
            //marker 212
            // textboxvalue = Number.parseInt(textboxvalue);             
            if (textboxvalue >= 0) {
                var newMFeee = AddFormattings(textboxvalue / 12);
                $(this).closest('tr').find('td:eq(3)').find('input[type=text]').val(newMFeee);
                var obj = AddFormattings(textboxvalue);

                $(this).val(obj);
            }
        });
        //=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-==-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-
        //=============================================================29-July-2020
        $(document).on("click", ".fieldcheck", function () {
            if ($(this).is(':checked')) {
                $(this).val(1);
            } else {
                $(this).val(0);
            }
        });
        //@18-1
        //  $(document).on("change", ".subTableMFee, .fieldcheck, .ILaddon .numberfield", function () {

        //     var textboxvalue = $(this).val();
        //     var thisclass = $(this).attr("class");
        //     if (DecimalSymbol === ',') 
        //     {
        //         textboxvalue = textboxvalue.replace(',', '.');
        //     }
        //         //marker 212
        //     if(thisclass == "fieldcheck"){
        //         textboxvalue = Number.parseInt(textboxvalue);
        //     }
        //     //textboxvalue = Number.parseInt(textboxvalue);

        //     if (textboxvalue >= 0 && thisclass != "numberfield") {                  
        //         var newYFee = AddFormattings(textboxvalue * 12);
        //         // $(this).closest('tr').find('td:eq(4)').find('input[type=text]').val(newYFee);
        //         $(this).closest('td').next().find('input[type=text]').val(newYFee);
        //         var obj = AddFormattings(textboxvalue);
        //         $(this).val(obj);
        //         calculateSubTableMFee(this);
        //     }
        //     else if(thisclass == "numberfield"){
        //         calculateSubTableMFee(this);
        //     }
        // });
        //  $(document).on("change", ".subTableYFee, .fieldcheck, .ILaddon .numberfield", function () {

        //     var textboxvalue = $(this).val();
        //     var thisclass = $(this).attr("class");
        //     if (DecimalSymbol === ',') 
        //     {
        //         textboxvalue = textboxvalue.replace(',', '.');
        //     }
        //         //marker 212
        //     if(thisclass == "fieldcheck"){
        //         textboxvalue = Number.parseInt(textboxvalue);
        //     }
        //     //textboxvalue = Number.parseInt(textboxvalue);

        //     if (textboxvalue >= 0 && thisclass != "numberfield") {
        //         var newMFeee = AddFormattings(textboxvalue / 12);
        //         // $(this).closest('tr').find('td:eq(3)').find('input[type=text]').val(newMFeee);
        //         $(this).closest('td').prev().find('input[type=text]').val(newMFeee);
        //         var obj = AddFormattings(textboxvalue);

        //         $(this).val(obj);
        //         calculateSubTableYFee(this);

        //     }
        //     else if(thisclass == "numberfield"){
        //         calculateSubTableYFee(this);
        //     }
        // });
        $(document).on("change", ".subTableFee, .subTableMFee, .subTableYFee, .fieldcheck, .ILaddon .numberfield", function () {
            //console.log("Setup");                       
            var textboxvalue = $(this).val();
            var thisclass = $(this).attr("class");
            if (DecimalSymbol === ',') {
                textboxvalue = textboxvalue.replace(',', '.');
            }
            //marker 212
            if (thisclass == "fieldcheck") {
                textboxvalue = Number.parseInt(textboxvalue);
            }
            // textboxvalue = Number.parseInt(textboxvalue); 
            if (textboxvalue >= 0 && thisclass === "subTableFee") {
                var obj = AddFormattings(textboxvalue);
                $(this).val(obj);
                calculateSubTableSetupFee(this);
            }
            else if (textboxvalue >= 0 && thisclass === "subTableMFee") {
                var newYFee = AddFormattings(textboxvalue * 12);
                // $(this).closest('tr').find('td:eq(4)').find('input[type=text]').val(newYFee);
                $(this).closest('td').next().find('input[type=text]').val(newYFee);
                var obj = AddFormattings(textboxvalue);
                $(this).val(obj);
                calculateSubTableMFee(this);
            }
            else if (textboxvalue >= 0 && thisclass === "subTableYFee") {
                var newMFeee = AddFormattings(textboxvalue / 12);
                // $(this).closest('tr').find('td:eq(3)').find('input[type=text]').val(newMFeee);
                $(this).closest('td').prev().find('input[type=text]').val(newMFeee);
                var obj = AddFormattings(textboxvalue);
                $(this).val(obj);
                calculateSubTableYFee(this);
            }
            else if (thisclass === "numberfield" || thisclass === "fieldcheck") {
                calculateSubTableSetupFee(this);
                calculateSubTableMFee(this);
                calculateSubTableYFee(this);
            }
        });
        function calculateSubTableMFee(MfeeClass) {

            var subtablBody = $(MfeeClass).closest("tbody");
            var totalMFee = 0.00;
            //$(subtablBody).find(".subTableMFee").each(function()
            $(subtablBody).find("td").each(function () {

                //totalMFee += Number.parseFloat(RemoveFormattings($(this).val()));
                var thistd = $(this);

                if ($(thistd).find("input").attr("class") == "numberfield" && $(thistd).find(".numberfield").val() > 0) {
                    console.log("monthly");
                    console.log($(this).nextAll().eq(1).find(".subTableMFee").val());
                    totalMFee += Number.parseFloat(RemoveFormattings($(this).nextAll().eq(1).find(".subTableMFee").val()));
                }
                else if ($(thistd).find(".fieldcheck").prop('checked') == true) {
                    totalMFee += Number.parseFloat(RemoveFormattings($(this).nextAll().eq(1).find(".subTableMFee").val()));
                }



            });
            var parentClass = $(subtablBody).closest("table").closest("tr").attr("class");
            var MainRow = "";
            if (parentClass === "OppProducts") {
                MainRow = $(subtablBody).closest(".OppProducts").prev();
            }
            else if (parentClass === "OppProducts2") {
                MainRow = $(subtablBody).closest(".OppProducts2").prev();
            }
            else if (parentClass === "OppProducts3") {
                MainRow = $(subtablBody).closest(".OppProducts3").prev();
            }
            else if (parentClass === "OppProducts4") {
                MainRow = $(subtablBody).closest(".OppProducts4").prev();
            }

            var MfeeTextBox = $(MainRow).find(".mDiscountedLicTextbox");
            var YfeeTextBox = $(MainRow).find(".DiscountedLicTextbox");
            var Mfeeorignal = $(MainRow).find(".moriginalLicense");
            var Yfeeorignal = $(MainRow).find(".originalLicense");
            //$(MfeeTextBox).val(totalMFee);            
            //$(MfeeTextBox).trigger("change");          
            $(MfeeTextBox).val(AddFormattings(totalMFee));
            $(YfeeTextBox).val(AddFormattings(totalMFee * 12));
            $(Mfeeorignal).html(totalMFee);
            $(Yfeeorignal).html(totalMFee * 12);
            calculateFee();
        }
        function calculateSubTableYFee(YfeeClass) {
            var subtablBody = $(YfeeClass).closest("tbody");
            var totalYFee = 0.00;

            //$(subtablBody).find(".subTableYFee").each(function()
            $(subtablBody).find("td").each(function () {
                //var currentTRClass = $(this).closest("tr").attr("class"); 
                // var supportIsChecked = false;
                // if(currentTRClass === "support")
                // {
                //     supportIsChecked = $(this).closest("tr").find('td:eq(1)').find('input[type=checkbox]').prop("checked");                   
                //     totalYFee += supportIsChecked ? Number.parseFloat(RemoveFormattings($(this).val())) : 0.00;
                // }

                //totalYFee += Number.parseFloat(RemoveFormattings($(this).val()));
                var thistd = $(this);
                if ($(thistd).find("input").attr("class") == "numberfield" && $(thistd).find(".numberfield").val() > 0) {
                    console.log("yearly");
                    console.log($(this).nextAll().eq(2).find(".subTableYFee").val());
                    totalYFee += Number.parseFloat(RemoveFormattings($(this).nextAll().eq(2).find(".subTableYFee").val()));
                }
                else if ($(thistd).find(".fieldcheck").prop('checked') == true) {
                    totalYFee += Number.parseFloat(RemoveFormattings($(this).nextAll().eq(2).find(".subTableYFee").val()));
                }



            });
            var parentClass = $(subtablBody).closest("table").closest("tr").attr("class");
            var MainRow = "";
            if (parentClass === "OppProducts") {
                MainRow = $(subtablBody).closest(".OppProducts").prev();
            }
            else if (parentClass === "OppProducts2") {
                MainRow = $(subtablBody).closest(".OppProducts2").prev();
            }
            else if (parentClass === "OppProducts3") {
                MainRow = $(subtablBody).closest(".OppProducts3").prev();
            }
            else if (parentClass === "OppProducts4") {
                MainRow = $(subtablBody).closest(".OppProducts4").prev();
            }

            var YfeeTextBox = $(MainRow).find(".DiscountedLicTextbox");
            var MfeeTextBox = $(MainRow).find(".mDiscountedLicTextbox");
            var Mfeeorignal = $(MainRow).find(".moriginalLicense");
            var Yfeeorignal = $(MainRow).find(".originalLicense");


            $(MfeeTextBox).val(AddFormattings(totalYFee / 12));
            $(YfeeTextBox).val(AddFormattings(totalYFee));
            $(Mfeeorignal).html(totalYFee / 12);
            $(Yfeeorignal).html(totalYFee);
            calculateFee();
        }
        function calculateSubTableSetupFee(SetupfeeClass) {
            var subtablBody = $(SetupfeeClass).closest("tbody");
            var totalSetupFee = 0.00;
            $(subtablBody).find("td").each(function () {
                var thistd = $(this);
                if ($(thistd).find("input").attr("class") == "numberfield" && $(thistd).find(".numberfield").val() > 0) {

                    totalSetupFee += Number.parseFloat(RemoveFormattings($(this).next().find(".subTableFee").val()));
                }
                else if ($(thistd).find(".fieldcheck").prop('checked') == true) {
                    totalSetupFee += Number.parseFloat(RemoveFormattings($(this).next().find(".subTableFee").val()));
                }


            });
            var parentClass = $(subtablBody).closest("table").closest("tr").attr("class");
            var MainRow = "";
            if (parentClass === "OppProducts") {

                MainRow = $(subtablBody).closest(".OppProducts").prev();
            }
            else if (parentClass === "OppProducts2") {
                MainRow = $(subtablBody).closest(".OppProducts2").prev();
            }
            else if (parentClass === "OppProducts3") {
                MainRow = $(subtablBody).closest(".OppProducts3").prev();
            }
            else if (parentClass === "OppProducts4") {
                MainRow = $(subtablBody).closest(".OppProducts4").prev();
            }

            var SfeeTextBox = $(MainRow).find(".DiscountedSetupTextbox");
            var Sfeeoriginal = $(MainRow).find(".originalSetup");

            $(SfeeTextBox).val(AddFormattings(totalSetupFee));
            $(Sfeeoriginal).html(totalSetupFee);

            calculateFee();





        }
        function calculateSubTableSetupDiscount(row) {
            var subtablBody = $(row).closest("tbody");
            var totalSFee = 0.00;
            //  var discount = orignalVal - parseFloat(newVal); 
            $(subtablBody).find(".subTableFee").each(function () {
                // var currentTRClass = $(this).closest("tr").attr("class"); 
                // var supportIsChecked = false;              
                // var tBoxVal = parseFloat(RemoveFormattings($(this).val()));
                // var discountedVal = (tBoxVal/orignalVal) * discount;

                // if(currentTRClass === "support")
                // {
                //     supportIsChecked = $(this).closest("tr").find('td:eq(1)').find('input[type=checkbox]').prop("checked");                   
                //     if(supportIsChecked === true)
                //     {
                //         $(this).val(AddFormattings(discountedVal));
                //     }

                // }

                $(this).val(AddFormattings(totalSFee));

            });
        }
        function calculateSubTableMFeeDiscount(row) {
            var subtablBody = $(row).closest("tbody");
            var totalSFee = 0.00;

            $(subtablBody).find(".subTableMFee").each(function () {

                $(this).val(AddFormattings(totalSFee));
                $(this).closest('tr').find('td:eq(4)').find('input[type=text]').val(AddFormattings(totalSFee));
            });
        }
        function calculateSubTableYFeeDiscount(row) {
            var subtablBody = $(row).closest("tbody");
            var totalSFee = 0.00;

            $(subtablBody).find(".subTableYFee").each(function () {
                $(this).val(AddFormattings(totalSFee));
                $(this).closest('tr').find('td:eq(3)').find('input[type=text]').val(AddFormattings(totalSFee));
            });
        }
        //=========================================nH 
        //=======================================================16-Sep-2020
        // function returning sub table for specific products
        function embedSubTableForIntegrityLine(productname, OPIndex, oportunityproducts, opp_prodid, ss_productdescription) {
            var sBassicDefault = (oportunityproducts.value[OPIndex] === undefined || oportunityproducts.value[OPIndex] === "undefined" || oportunityproducts.value[OPIndex] === null) ? true : false;
            var display_prop = display_support = "";
            var display_row = "style='display:none'";
            var ss_admin = ss_languages = ss_casemanager = ss_employees = ss_includedimphours_ps = 0;
            var ss_supportbasic = ss_supportprofessional = false;
            var ss_integrityessential = ss_integritybestpractice = ss_eqsclassicsystem_ps = ss_integrityenterprise = "";
            var ss_adminsetup = ss_languagessetup = ss_supportbasicsetup = ss_supportprofessionalsfee = ss_casemanagersetup = ss_employeessetup = AddFormattings(0.00);
            var ss_adminmfee = ss_languagesmfee = ss_supportbasicmfee = ss_supportprofessionalmfee = ss_casemanagermfee = ss_employeesmfee = AddFormattings(0.00);
            var ss_adminyfee = ss_languagesyfee = ss_supportbasicyfee = ss_supportprofessionalyfee = ss_casemanageryfee = ss_employeesyfee = AddFormattings(0.00);

            if (OPIndex >= 0) {
                ss_includedimphours_ps = oportunityproducts.value[OPIndex]["ss_includedimphours_ps"] ? oportunityproducts.value[OPIndex]["ss_includedimphours_ps"] : 0;
                ss_employees = oportunityproducts.value[OPIndex]["ss_employees"] ? oportunityproducts.value[OPIndex]["ss_employees"] : 0;
                ss_employeessetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_employeessetup"] ? oportunityproducts.value[OPIndex]["ss_employeessetup"] : 0.00);
                ss_employeesmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_employeesmfee"] ? oportunityproducts.value[OPIndex]["ss_employeesmfee"] : 0.00);
                ss_employeesyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_employeesyfee"] ? oportunityproducts.value[OPIndex]["ss_employeesyfee"] : 0.00);
                ss_languages = oportunityproducts.value[OPIndex]["ss_languages"] ? oportunityproducts.value[OPIndex]["ss_languages"] : 0;
                ss_languagessetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagessetup"] ? oportunityproducts.value[OPIndex]["ss_languagessetup"] : 0.00);
                ss_languagesmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagesmfee"] ? oportunityproducts.value[OPIndex]["ss_languagesmfee"] : 0.00);
                ss_languagesyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagesyfee"] ? oportunityproducts.value[OPIndex]["ss_languagesyfee"] : 0.00);
                ss_eqsclassicsystem_ps = oportunityproducts.value[OPIndex]["ss_eqsclassicsystem_ps"] ? "checked" : "";
                ss_integrityessential = oportunityproducts.value[OPIndex]["ss_integrityessential"] ? "checked" : "";
                ss_integritybestpractice = oportunityproducts.value[OPIndex]["ss_integritybestpractice"] ? "checked" : "";
                ss_integrityenterprise = oportunityproducts.value[OPIndex]["ss_integrityenterprise"] ? "checked" : "";
                ss_supportbasic = oportunityproducts.value[OPIndex]["ss_supportbasic"] ? oportunityproducts.value[OPIndex]["ss_supportbasic"] : false;
                ss_supportbasicsetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportbasicsetup"] ? oportunityproducts.value[OPIndex]["ss_supportbasicsetup"] : 0.00);
                ss_supportbasicmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportbasicmfee"] ? oportunityproducts.value[OPIndex]["ss_supportbasicmfee"] : 0.00);
                ss_supportbasicyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportbasicyfee"] ? oportunityproducts.value[OPIndex]["ss_supportbasicyfee"] : 0.00);
                ss_supportprofessional = oportunityproducts.value[OPIndex]["ss_supportprofessional"] ? oportunityproducts.value[OPIndex]["ss_supportprofessional"] : false;
                ss_supportprofessionalsfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportprofessionalsfee"] ? oportunityproducts.value[OPIndex]["ss_supportprofessionalsfee"] : 0.00);
                ss_supportprofessionalmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportprofessionalmfee"] ? oportunityproducts.value[OPIndex]["ss_supportprofessionalmfee"] : 0.00);
                ss_supportprofessionalyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportprofessionalyfee"] ? oportunityproducts.value[OPIndex]["ss_supportprofessionalyfee"] : 0.00);
                ss_casemanager = oportunityproducts.value[OPIndex]["ss_casemanager"] ? oportunityproducts.value[OPIndex]["ss_casemanager"] : 0;
                ss_casemanagersetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_casemanagersetup"] ? oportunityproducts.value[OPIndex]["ss_casemanagersetup"] : 0.00);
                ss_casemanagermfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_casemanagermfee"] ? oportunityproducts.value[OPIndex]["ss_casemanagermfee"] : 0.00);
                ss_casemanageryfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_casemanageryfee"] ? oportunityproducts.value[OPIndex]["ss_casemanageryfee"] : 0.00);
                ss_admin = oportunityproducts.value[OPIndex]["ss_admin"] ? oportunityproducts.value[OPIndex]["ss_admin"] : 0;
                ss_adminsetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminsetup"] ? oportunityproducts.value[OPIndex]["ss_adminsetup"] : 0.00);
                ss_adminmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminmfee"] ? oportunityproducts.value[OPIndex]["ss_adminmfee"] : 0.00);
                ss_adminyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminyfee"] ? oportunityproducts.value[OPIndex]["ss_adminyfee"] : 0.00);


            }
            else {
                display_prop = "style='display:none'";
            }


            if (ss_eqsclassicsystem_ps === "checked" || ss_integrityessential === "checked" || ss_integritybestpractice === "checked" || ss_integrityenterprise === "checked") {
                display_row = "";
            }
            var disp_sys = "style='display:none'";
            if (ss_eqsclassicsystem_ps === "checked" || ss_integritybestpractice === "checked" || ss_integrityenterprise === "checked") {
                disp_sys = "";
            }

            var sbassic = (ss_supportbasic || sBassicDefault) ? "checked" : "";
            var sprofessional = (ss_supportprofessional) ? "checked" : "";


            //console.log("integrity Line Sub Table");
            var markup = "<tr class='OppProducts' " + display_prop + "><td style='background: transparent;'></td><td class='class='text-center' colspan='4'>"
                + "<table class='table table-responsive table-sm text-center border-0 removetable ' id='" + opp_prodid + "_pt'  >"
                + "<tbody class='subtableBody' id='" + opp_prodid + "_p'>"
                + "<tr><td colspan='2' class='subfield integrityClass'><div " + disp_sys + " id='classic_sys'><div class='itegrityText'>EQS Classic System </div><input type='checkbox' class='integrityCheckbox4 integ_essential' " + ss_eqsclassicsystem_ps + "><br><input type='text' value='Product No. 640050' disabled></div></td><td><div class='itegrityText'>Essential</div><input type='checkbox' class='integrityCheckbox integ_essential' " + ss_integrityessential + "></td><td><div class='itegrityText integrityClass3'>Best<br>Practice</div><input type='checkbox' class='integrityCheckbox2 integ_essential' " + ss_integritybestpractice + "></td><td><div class = 'integrityClassEnd'><div class='itegrityText'>Enterprise</div><input type='checkbox' class='integrityCheckbox3 integ_essential' " + ss_integrityenterprise + "></div></td></tr>"
                + "<tr class = 'trshowhideclass' " + display_row + "><td class='subfield'>Included Implementation hours</td><td><input type='number' id='ss_imphours_ps' min='0' value='" + ss_includedimphours_ps + "' ></td><td></td><td></td><td></td></tr>"
                + "<tr class = 'trshowhideclass' " + display_row + "><td class='subfield'>Employees </td><td><input type='number' min='0' value='" + ss_employees + "' ></td><td><input type='text' at='10' class='subTableFee' value='" + ss_employeessetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_employeesmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_employeesyfee + "'></td></tr>"
                + "<tr class = 'trshowhideclass' " + display_row + "><td class='subfield'>Languages </td><td><input type='number'  min='0' value='" + ss_languages + "'></td><td><input type='text' class='subTableFee' value='" + ss_languagessetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_languagesmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_languagesyfee + "'></td></tr>"
                + "<tr class = 'trshowhideclass' " + display_row + "><td class='subfield'>Case Manager - Named User </td><td><input type='number' min='0' value='" + ss_casemanager + "'></td><td><input type='text' class='subTableFee' value='" + ss_casemanagersetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_casemanagermfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_casemanageryfee + "'></td></tr>"
                + "<tr class = 'trshowhideclass' " + display_row + "><td class='subfield'> Countries </td><td><input type='number' min='0' value='" + ss_admin + "'></td><td><input type='text' class='subTableFee' value='" + ss_adminsetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_adminmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_adminyfee + "'></td></tr>"
                + "<tr class = 'trshowhideclass' " + display_row + "><td class='mainSupportTd' colspan='5'> Support </td></tr>"
                + "<tr class='support trshowhideclass' " + display_row + "><td class='subfield'> Basic </td><td class='supportTd'><input type='checkbox' " + sbassic + " class='supportb subSupportCheckBox' name='" + sBassicDefault + "'></td><td><input type='text' class='subTableSupportFee subTableSupportSFee' value='" + ss_supportbasicsetup + "'></td><td><input type='text' class='subTableSupportFee subTableSupportMFee' value='" + ss_supportbasicmfee + "'></td><td><input type='text' class='subTableSupportFee subTableSupportYFee' value='" + ss_supportbasicyfee + "'></td></tr>"
                + "<tr class='support trshowhideclass' " + display_row + "><td class='subfield'> Professional </td><td class='supportTd'><input type='checkbox' " + sprofessional + " class='supportp subSupportCheckBox'></td><td><input type='text'  class='subTableSupportFee subTableSupportSFee' value='" + ss_supportprofessionalsfee + "'></td><td><input type='text' class='subTableSupportFee subTableSupportMFee' value='" + ss_supportprofessionalmfee + "'></td><td><input type='text' class='subTableSupportFee subTableSupportYFee' value='" + ss_supportprofessionalyfee + "'></td></tr>"
                + "<tr class='ss_productdescriptionROW' style = 'display:none;'><td class = 'ss_productdescriptionTD' colspan='5'>" + ss_productdescription + "</td></tr>"
                + "</tbody></table></td></tr>";

            return markup;


        }

        function AddSubTableDataForIntegrityLine(entity, subtable, isLicProduct, oppProdDesc) {
            var subTBody = $(subtable).find('td:eq(1)').find('.subtableBody');
            var tr0 = $(subTBody).find('tr:eq(0)');
            var tr1 = $(subTBody).find('tr:eq(1)');
            var tr2 = $(subTBody).find('tr:eq(2)');
            var tr3 = $(subTBody).find('tr:eq(3)');
            var tr4 = $(subTBody).find('tr:eq(4)');
            var tr5 = $(subTBody).find('tr:eq(5)');
            var tr6 = $(subTBody).find('tr:eq(6)');
            var tr7 = $(subTBody).find('tr:eq(7)');
            var tr8 = $(subTBody).find('tr:eq(8)');
            var tr9 = $(subTBody).find('tr:eq(9)');
            //ss_includedimphours_ps
            //Integrity Line

            entity.ss_eqsclassicsystem_ps = $(tr0).find('td:eq(0)').find('input[type=checkbox]').prop("checked");
            entity.ss_integrityessential = $(tr0).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
            entity.ss_integritybestpractice = $(tr0).find('td:eq(2)').find('input[type=checkbox]').prop("checked");
            entity.ss_integrityenterprise = $(tr0).find('td:eq(3)').find('input[type=checkbox]').prop("checked");

            //Employees
            if (entity.ss_eqsclassicsystem_ps || entity.ss_integrityessential || entity.ss_integritybestpractice || entity.ss_integrityenterprise) {
                if (entity.ss_integritybestpractice && isLicProduct && ss_eqsclassicsystem_ps) {
                    entity.ss_eqsintegrityldata_ps = "Best Practice\nProduct No. 640050";
                }
                else if (entity.ss_integrityenterprise && isLicProduct && ss_eqsclassicsystem_ps) {
                    entity.ss_eqsintegrityldata_ps = "Enterprise\nProduct No. 640050";
                }
                else {
                    entity.ss_eqsintegrityldata_ps = (entity.ss_integrityessential && isLicProduct) ? "Essential" : ((entity.ss_integritybestpractice && isLicProduct) ? "Best Practice" : ((entity.ss_integrityenterprise && isLicProduct) ? "Enterprise" : ((entity.ss_eqsclassicsystem_ps && isLicProduct) ? "Product No. 640050" : "")));
                }
                entity.ss_eqsintegrityldata_ps += !isLicProduct ? "" : "\nEmployees: ";
                entity.ss_includedimphours_ps = parseInt($(tr1).find('td:eq(1)').find('input[type=number]').val());
                entity.ss_employees = parseInt($(tr2).find('td:eq(1)').find('input[type=number]').val());
                entity.ss_eqsintegrityldata_ps += !isLicProduct ? "" : entity.ss_employees;
                entity.ss_employeessetup = parseFloat(RemoveFormattings($(tr2).find('td:eq(2)').find('input[type=text]').val()));
                entity.ss_employeesmfee = isLicProduct ? parseFloat(RemoveFormattings($(tr2).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
                entity.ss_employeesyfee = isLicProduct ? parseFloat(RemoveFormattings($(tr2).find('td:eq(4)').find('input[type=text]').val())) : 0.00;


                //Languages 
                entity.ss_eqsintegrityldata_ps += !isLicProduct ? "" : "\nLanguages: ";
                entity.ss_languages = parseInt($(tr3).find('td:eq(1)').find('input[type=number]').val());
                entity.ss_eqsintegrityldata_ps += !isLicProduct ? "" : entity.ss_languages;
                entity.ss_languagessetup = parseFloat(RemoveFormattings($(tr3).find('td:eq(2)').find('input[type=text]').val()));
                entity.ss_languagesmfee = isLicProduct ? parseFloat(RemoveFormattings($(tr3).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
                entity.ss_languagesyfee = isLicProduct ? parseFloat(RemoveFormattings($(tr3).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
                //Case Manager - Named User
                entity.ss_eqsintegrityldata_ps += !isLicProduct ? "" : "\nCase Manager - Named User: ";
                entity.ss_casemanager = parseInt($(tr4).find('td:eq(1)').find('input[type=number]').val());
                entity.ss_eqsintegrityldata_ps += !isLicProduct ? "" : entity.ss_casemanager;
                entity.ss_casemanagersetup = parseFloat(RemoveFormattings($(tr4).find('td:eq(2)').find('input[type=text]').val()));
                entity.ss_casemanagermfee = isLicProduct ? parseFloat(RemoveFormattings($(tr4).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
                entity.ss_casemanageryfee = isLicProduct ? parseFloat(RemoveFormattings($(tr4).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
                //Countries
                entity.ss_eqsintegrityldata_ps += !isLicProduct ? "" : "\nCountries: ";
                entity.ss_admin = parseInt($(tr5).find('td:eq(1)').find('input[type=number]').val());
                entity.ss_eqsintegrityldata_ps += !isLicProduct ? "" : entity.ss_admin;
                entity.ss_adminsetup = parseFloat(RemoveFormattings($(tr5).find('td:eq(2)').find('input[type=text]').val()));
                entity.ss_adminmfee = isLicProduct ? parseFloat(RemoveFormattings($(tr5).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
                entity.ss_adminyfee = isLicProduct ? parseFloat(RemoveFormattings($(tr5).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
                //Support-Basic
                var sBasic = $(tr7).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
                var sprofessional = $(tr8).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
                entity.ss_eqsintegrityldata_ps += (sBasic && isLicProduct) ? "\nSupport: Basic\n" : ((sprofessional && isLicProduct) ? "\nSupport: Professional\n" : "");
                entity.ss_supportbasic = sBasic;
                entity.ss_supportbasicsetup = sBasic ? parseFloat(RemoveFormattings($(tr7).find('td:eq(2)').find('input[type=text]').val())) : 0.00;
                entity.ss_supportbasicmfee = (sBasic && isLicProduct) ? parseFloat(RemoveFormattings($(tr7).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
                entity.ss_supportbasicyfee = (sBasic && isLicProduct) ? parseFloat(RemoveFormattings($(tr7).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
                //Support-professional
                entity.ss_supportprofessional = sprofessional;
                entity.ss_supportprofessionalsfee = sprofessional ? parseFloat(RemoveFormattings($(tr8).find('td:eq(2)').find('input[type=text]').val())) : 0.00;
                entity.ss_supportprofessionalmfee = (sprofessional && isLicProduct) ? parseFloat(RemoveFormattings($(tr8).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
                entity.ss_supportprofessionalyfee = (sprofessional && isLicProduct) ? parseFloat(RemoveFormattings($(tr8).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
                //Discription ss_productdescription
                //var  prodDiscription = $(tr9).find('td:eq(0)').text();
                //entity.ss_eqsintegrityldata_ps += (prodDiscription === null || prodDiscription === "" || prodDiscription === undefined || prodDiscription === "undefined" || !isLicProduct) ? "" : "\n" + prodDiscription;
            }
            else {
                entity.ss_includedimphours_ps = 0;
                entity.ss_employees = 0;

                entity.ss_employeessetup = parseFloat(0);
                entity.ss_employeesmfee = parseFloat(0);
                entity.ss_employeesyfee = parseFloat(0);


                //Languages 

                entity.ss_languages = 0;

                entity.ss_languagessetup = parseFloat(0);
                entity.ss_languagesmfee = parseFloat(0);
                entity.ss_languagesyfee = parseFloat(0);
                //Case Manager - Named User

                entity.ss_casemanager = 0;

                entity.ss_casemanagersetup = parseFloat(0);
                entity.ss_casemanagermfee = parseFloat(0);
                entity.ss_casemanageryfee = parseFloat(0);
                //Countries

                entity.ss_admin = 0;

                entity.ss_adminsetup = parseFloat(0);
                entity.ss_adminmfee = parseFloat(0);
                entity.ss_adminyfee = parseFloat(0);
                //Support-Basic

                entity.ss_supportbasic = true;
                entity.ss_supportbasicsetup = parseFloat(0);
                entity.ss_supportbasicmfee = parseFloat(0);
                entity.ss_supportbasicyfee = parseFloat(0);
                //Support-professional
                entity.ss_supportprofessional = false;
                entity.ss_supportprofessionalsfee = parseFloat(0);
                entity.ss_supportprofessionalmfee = parseFloat(0);
                entity.ss_supportprofessionalyfee = parseFloat(0);
                //Discription ss_productdescription
                entity.ss_eqsintegrityldata_ps = "";

            }
            if (isLicProduct || oppProdDesc === undefined || oppProdDesc === null || oppProdDesc === "undefined") {
                entity.ss_customdescription = "";
            }
            else {
                entity.ss_customdescription = "\n" + oppProdDesc.replace("20", entity.ss_includedimphours_ps.toString());
            }
            //Setup Text Value
            entity.ss_stval_ps = isLicProduct ? "" : "Setup";
            return entity;
        }

        function embedSubTableForIntegrityAdd_On(productname, OPIndex, oportunityproducts, opp_prodid, ss_productdescription) {
            // Variables initialization 
            var display_prop = "";
            var display_AdditionalDetails = "";
            var checkAdditionalDetails = "";
            var ss_additionalfeaturesaddon_ps = "";
            var ss_admintab_ps = ss_journaltab_ps = ss_reportingstat_ps = ss_reminderalert_ps = ss_casechat_ps = false;
            var ss_deepsearch_ps = ss_anonymizationpdf_ps = ss_translationto_ps = ss_translationmt_ps = false;
            var ss_2factorauth_ps = ss_ipwhitelisting_ps = ss_caseimporterfun_ps = ss_customdomainurl_ps = ss_ssointegration_ps = false;
            var ss_apiintegration_ps = ss_phoneintakecc_ps = ss_phoneintakeams_ps = ss_emailintake_ps = ss_securecommunicationcftp_ps = ss_additionalfeatures_ps = false
            var ss_admintabsfee_ps = ss_journaltabsfee_ps = ss_reportingstatsfee_ps = ss_reminderalertsfee_ps = ss_casechatsfee_ps = ss_deepsearchsfee_ps = ss_anonymizationpdfsfee_ps = AddFormattings(0);
            var ss_translationtosfee_ps = ss_translationmtsfee_ps = ss_2factorauthsfee_ps = ss_ipwhitelistingsfee_ps = ss_emailintakesfee_ps = ss_securecommunicationcftpsfee_ps = ss_additionalfeaturessfee_ps = AddFormattings(0);
            var ss_caseimporterfunsfee_ps = ss_customdomainurlsfee_ps = AddFormattings(500);
            var ss_ssointegrationsfee_ps = AddFormattings(6000);
            var ss_apiintegrationsfee_ps = AddFormattings(9500);
            var ss_phoneintakeccsfee_ps = AddFormattings(1000);
            var ss_phoneintakeamssfee_ps = AddFormattings(2500);
            var ss_admintabmfee_ps = ss_journaltabmfee_ps = ss_reportingstatmfee_ps = ss_reminderalertmfee_ps = ss_casechatmfee_ps = ss_deepsearchmfee_ps = ss_anonymizationpdfmfee_ps = ss_securecommunicationcftpmfee_ps = AddFormattings(100);
            var ss_translationtomfee_ps = ss_translationmtmfee_ps = ss_2factorauthmfee_ps = ss_ipwhitelistingmfee_ps = ss_caseimporterfunmfee_ps = ss_phoneintakeamsmfee_ps = ss_emailintakemfee_ps = AddFormattings(100);
            var ss_customdomainurlmfee_ps = ss_additionalfeaturesmfee_ps = AddFormattings(0);
            var ss_apiintegrationmfee_ps = AddFormattings(300);
            var ss_ssointegrationmfee_ps = ss_phoneintakeccmfee_ps = AddFormattings(200);
            var ss_admintabyfee_ps = ss_journaltabyfee_ps = ss_reportingstatyfee_ps = ss_reminderalertyfee_ps = ss_casechatyfee_ps = ss_deepsearchyfee_ps = ss_anonymizationpdfyfee_ps = ss_securecommunicationcftpyfee_ps = AddFormattings(1200);
            var ss_translationtoyfee_ps = ss_translationmtyfee_ps = ss_2factorauthyfee_ps = ss_ipwhitelistingyfee_ps = ss_caseimporterfunyfee_ps = ss_phoneintakeamsyfee_ps = ss_emailintakeyfee_ps = AddFormattings(1200);
            var ss_customdomainurlyfee_ps = ss_additionalfeaturesyfee_ps = AddFormattings(0);
            var ss_apiintegrationyfee_ps = AddFormattings(3600);
            var ss_ssointegrationyfee_ps = ss_phoneintakeccyfee_ps = AddFormattings(2400);
            //========
            var ss_admin = ss_languages = ss_casemanager = ss_phonelang = 0;
            var ss_adminsetup = ss_languagessetup = ss_casemanagersetup = ss_phonelangsfee = AddFormattings(100.00);
            var ss_adminmfee = ss_languagesmfee = ss_casemanagermfee = ss_phonelangmfee = AddFormattings(50.00);
            var ss_adminyfee = ss_languagesyfee = ss_casemanageryfee = ss_phonelangyfee = AddFormattings(600.00);

            if (OPIndex >= 0) {
                // Flags fields
                ss_admintab_ps = oportunityproducts.value[OPIndex]["ss_admintab_ps"] ? oportunityproducts.value[OPIndex]["ss_admintab_ps"] : false;
                ss_journaltab_ps = oportunityproducts.value[OPIndex]["ss_journaltab_ps"] ? oportunityproducts.value[OPIndex]["ss_journaltab_ps"] : false;
                ss_reportingstat_ps = oportunityproducts.value[OPIndex]["ss_reportingstat_ps"] ? oportunityproducts.value[OPIndex]["ss_reportingstat_ps"] : false;
                ss_reminderalert_ps = oportunityproducts.value[OPIndex]["ss_reminderalert_ps"] ? oportunityproducts.value[OPIndex]["ss_reminderalert_ps"] : false;
                ss_casechat_ps = oportunityproducts.value[OPIndex]["ss_casechat_ps"] ? oportunityproducts.value[OPIndex]["ss_casechat_ps"] : false;
                ss_deepsearch_ps = oportunityproducts.value[OPIndex]["ss_deepsearch_ps"] ? oportunityproducts.value[OPIndex]["ss_deepsearch_ps"] : false;
                ss_anonymizationpdf_ps = oportunityproducts.value[OPIndex]["ss_anonymizationpdf_ps"] ? oportunityproducts.value[OPIndex]["ss_anonymizationpdf_ps"] : false;
                ss_translationto_ps = oportunityproducts.value[OPIndex]["ss_translationto_ps"] ? oportunityproducts.value[OPIndex]["ss_translationto_ps"] : false;
                ss_translationmt_ps = oportunityproducts.value[OPIndex]["ss_translationmt_ps"] ? oportunityproducts.value[OPIndex]["ss_translationmt_ps"] : false;
                ss_2factorauth_ps = oportunityproducts.value[OPIndex]["ss_2factorauth_ps"] ? oportunityproducts.value[OPIndex]["ss_2factorauth_ps"] : false;
                ss_ipwhitelisting_ps = oportunityproducts.value[OPIndex]["ss_ipwhitelisting_ps"] ? oportunityproducts.value[OPIndex]["ss_ipwhitelisting_ps"] : false;
                ss_caseimporterfun_ps = oportunityproducts.value[OPIndex]["ss_caseimporterfun_ps"] ? oportunityproducts.value[OPIndex]["ss_caseimporterfun_ps"] : false;
                ss_customdomainurl_ps = oportunityproducts.value[OPIndex]["ss_customdomainurl_ps"] ? oportunityproducts.value[OPIndex]["ss_customdomainurl_ps"] : false;
                ss_ssointegration_ps = oportunityproducts.value[OPIndex]["ss_ssointegration_ps"] ? oportunityproducts.value[OPIndex]["ss_ssointegration_ps"] : false;
                ss_apiintegration_ps = oportunityproducts.value[OPIndex]["ss_apiintegration_ps"] ? oportunityproducts.value[OPIndex]["ss_apiintegration_ps"] : false;
                ss_phoneintakecc_ps = oportunityproducts.value[OPIndex]["ss_phoneintakecc_ps"] ? oportunityproducts.value[OPIndex]["ss_phoneintakecc_ps"] : false;
                ss_phoneintakeams_ps = oportunityproducts.value[OPIndex]["ss_phoneintakeams_ps"] ? oportunityproducts.value[OPIndex]["ss_phoneintakeams_ps"] : false;
                ss_emailintake_ps = oportunityproducts.value[OPIndex]["ss_emailintake_ps"] ? oportunityproducts.value[OPIndex]["ss_emailintake_ps"] : false;
                ss_securecommunicationcftp_ps = oportunityproducts.value[OPIndex]["ss_securecommunicationcftp_ps"] ? oportunityproducts.value[OPIndex]["ss_securecommunicationcftp_ps"] : false;
                ss_additionalfeatures_ps = oportunityproducts.value[OPIndex]["ss_additionalfeatures_ps"] ? oportunityproducts.value[OPIndex]["ss_additionalfeatures_ps"] : false;
                //=============
                // ss_languages = oportunityproducts.value[OPIndex]["ss_languagescheck_ps"] ? oportunityproducts.value[OPIndex]["ss_languagescheck_ps"] : 0;
                // ss_casemanager = oportunityproducts.value[OPIndex]["ss_casemanagercheck_ps"] ? oportunityproducts.value[OPIndex]["ss_casemanagercheck_ps"] : 0;
                // ss_admin = oportunityproducts.value[OPIndex]["ss_admincheck_ps"] ? oportunityproducts.value[OPIndex]["ss_admincheck_ps"] : 0;
                ss_languages = oportunityproducts.value[OPIndex]["ss_languages"] ? oportunityproducts.value[OPIndex]["ss_languages"] : 0;
                ss_casemanager = oportunityproducts.value[OPIndex]["ss_casemanager"] ? oportunityproducts.value[OPIndex]["ss_casemanager"] : 0;
                ss_admin = oportunityproducts.value[OPIndex]["ss_admin"] ? oportunityproducts.value[OPIndex]["ss_admin"] : 0;
                ss_phonelang = oportunityproducts.value[OPIndex]["ss_phonelang"] ? oportunityproducts.value[OPIndex]["ss_phonelang"] : 0;
                //==============

                //Setup Fee attributes
                ss_admintabsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_admintabsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_admintabsfee_ps"] : 0);
                ss_journaltabsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_journaltabsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_journaltabsfee_ps"] : 0);
                ss_reportingstatsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_reportingstatsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_reportingstatsfee_ps"] : 0);
                ss_reminderalertsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_reminderalertsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_reminderalertsfee_ps"] : 0);
                ss_casechatsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_casechatsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_casechatsfee_ps"] : 0);
                ss_deepsearchsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_deepsearchsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_deepsearchsfee_ps"] : 0);
                ss_anonymizationpdfsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_anonymizationpdfsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_anonymizationpdfsfee_ps"] : 0);
                ss_translationtosfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_translationtosfee_ps"] ? oportunityproducts.value[OPIndex]["ss_translationtosfee_ps"] : 0);
                ss_translationmtsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_translationmtsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_translationmtsfee_ps"] : 0);
                ss_2factorauthsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_2factorauthsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_2factorauthsfee_ps"] : 0);
                ss_ipwhitelistingsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_ipwhitelistingsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_ipwhitelistingsfee_ps"] : 0);
                ss_caseimporterfunsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_caseimporterfunsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_caseimporterfunsfee_ps"] : 0);
                ss_customdomainurlsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_customdomainurlsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_customdomainurlsfee_ps"] : 0);
                ss_ssointegrationsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_ssointegrationsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_ssointegrationsfee_ps"] : 0);
                ss_apiintegrationsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_apiintegrationsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_apiintegrationsfee_ps"] : 0);
                ss_phoneintakeccsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_phoneintakeccsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_phoneintakeccsfee_ps"] : 0);
                ss_phoneintakeamssfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_phoneintakeamssfee_ps"] ? oportunityproducts.value[OPIndex]["ss_phoneintakeamssfee_ps"] : 0);
                ss_emailintakesfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_emailintakesfee_ps"] ? oportunityproducts.value[OPIndex]["ss_emailintakesfee_ps"] : 0);
                ss_securecommunicationcftpsfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_securecommunicationcftpsfee_ps"] ? oportunityproducts.value[OPIndex]["ss_securecommunicationcftpsfee_ps"] : 0);
                ss_additionalfeaturessfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_additionalfeaturessfee_ps"] ? oportunityproducts.value[OPIndex]["ss_additionalfeaturessfee_ps"] : 0);

                //==============
                ss_languagessetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagessetup"] ? oportunityproducts.value[OPIndex]["ss_languagessetup"] : 100.00);
                ss_casemanagersetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_casemanagersetup"] ? oportunityproducts.value[OPIndex]["ss_casemanagersetup"] : 100.00);
                ss_adminsetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminsetup"] ? oportunityproducts.value[OPIndex]["ss_adminsetup"] : 100.00);
                ss_phonelangsfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_phonelangsfee"] ? oportunityproducts.value[OPIndex]["ss_phonelangsfee"] : 100.00);
                //Monthly Fee attributes
                ss_admintabmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_admintabmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_admintabmfee_ps"] : 0);
                ss_journaltabmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_journaltabmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_journaltabmfee_ps"] : 0);
                ss_reportingstatmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_reportingstatmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_reportingstatmfee_ps"] : 0);
                ss_reminderalertmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_reminderalertmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_reminderalertmfee_ps"] : 0);
                ss_casechatmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_casechatmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_casechatmfee_ps"] : 0);
                ss_deepsearchmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_deepsearchmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_deepsearchmfee_ps"] : 0);
                ss_anonymizationpdfmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_anonymizationpdfmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_anonymizationpdfmfee_ps"] : 0);
                ss_translationtomfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_translationtomfee_ps"] ? oportunityproducts.value[OPIndex]["ss_translationtomfee_ps"] : 0);
                ss_translationmtmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_translationmtmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_translationmtmfee_ps"] : 0);
                ss_2factorauthmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_2factorauthmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_2factorauthmfee_ps"] : 0);
                ss_ipwhitelistingmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_ipwhitelistingmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_ipwhitelistingmfee_ps"] : 0);
                ss_caseimporterfunmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_caseimporterfunmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_caseimporterfunmfee_ps"] : 0);
                ss_customdomainurlmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_customdomainurlmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_customdomainurlmfee_ps"] : 0);
                ss_ssointegrationmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_ssointegrationmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_ssointegrationmfee_ps"] : 0);
                ss_apiintegrationmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_apiintegrationmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_apiintegrationmfee_ps"] : 0);
                ss_phoneintakeccmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_phoneintakeccmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_phoneintakeccmfee_ps"] : 0);
                ss_phoneintakeamsmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_phoneintakeamsmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_phoneintakeamsmfee_ps"] : 0);
                ss_emailintakemfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_emailintakemfee_ps"] ? oportunityproducts.value[OPIndex]["ss_emailintakemfee_ps"] : 0);
                ss_securecommunicationcftpmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_securecommunicationcftpmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_securecommunicationcftpmfee_ps"] : 0);
                ss_additionalfeaturesmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_additionalfeaturesmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_additionalfeaturesmfee_ps"] : 0);

                //================
                ss_languagesmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagesmfee"] ? oportunityproducts.value[OPIndex]["ss_languagesmfee"] : 50.00);
                ss_casemanagermfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_casemanagermfee"] ? oportunityproducts.value[OPIndex]["ss_casemanagermfee"] : 50.00);
                ss_adminmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminmfee"] ? oportunityproducts.value[OPIndex]["ss_adminmfee"] : 50.00);
                ss_phonelangmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_phonelangmfee"] ? oportunityproducts.value[OPIndex]["ss_phonelangmfee"] : 50.00);
                //Yearly Fee attributes
                ss_admintabyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_admintabyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_admintabyfee_ps"] : 0);
                ss_journaltabyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_journaltabyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_journaltabyfee_ps"] : 0);
                ss_reportingstatyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_reportingstatyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_reportingstatyfee_ps"] : 0);
                ss_reminderalertyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_reminderalertyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_reminderalertyfee_ps"] : 0);
                ss_casechatyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_casechatyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_casechatyfee_ps"] : 0);
                ss_deepsearchyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_deepsearchyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_deepsearchyfee_ps"] : 0);
                ss_anonymizationpdfyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_anonymizationpdfyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_anonymizationpdfyfee_ps"] : 0);
                ss_translationtoyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_translationtoyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_translationtoyfee_ps"] : 0);
                ss_translationmtyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_translationmtyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_translationmtyfee_ps"] : 0);
                ss_2factorauthyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_2factorauthyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_2factorauthyfee_ps"] : 0);
                ss_ipwhitelistingyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_ipwhitelistingyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_ipwhitelistingyfee_ps"] : 0);
                ss_caseimporterfunyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_caseimporterfunyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_caseimporterfunyfee_ps"] : 0);
                ss_customdomainurlyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_customdomainurlyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_customdomainurlyfee_ps"] : 0);
                ss_ssointegrationyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_ssointegrationyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_ssointegrationyfee_ps"] : 0);
                ss_apiintegrationyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_apiintegrationmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_apiintegrationmfee_ps"] : 0);
                ss_phoneintakeccyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_phoneintakeccyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_phoneintakeccyfee_ps"] : 0);
                ss_phoneintakeamsyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_phoneintakeamsyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_phoneintakeamsyfee_ps"] : 0);
                ss_emailintakeyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_emailintakeyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_emailintakeyfee_ps"] : 0);
                ss_securecommunicationcftpyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_securecommunicationcftpyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_securecommunicationcftpyfee_ps"] : 0);
                ss_additionalfeaturesyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_additionalfeaturesyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_additionalfeaturesyfee_ps"] : 0);

                //====================
                ss_languagesyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagesyfee"] ? oportunityproducts.value[OPIndex]["ss_languagesyfee"] : 600.00);
                ss_casemanageryfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_casemanageryfee"] ? oportunityproducts.value[OPIndex]["ss_casemanageryfee"] : 600.00);
                ss_adminyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminyfee"] ? oportunityproducts.value[OPIndex]["ss_adminyfee"] : 600.00);
                ss_phonelangyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_phonelangyfee"] ? oportunityproducts.value[OPIndex]["ss_phonelangyfee"] : 600.00);
                // Additional Details 
                ss_additionalfeaturesaddon_ps = oportunityproducts.value[OPIndex]["ss_additionalfeaturesaddon_ps"] ? oportunityproducts.value[OPIndex]["ss_additionalfeaturesaddon_ps"] : "";
            }
            else {
                display_prop = "style='display:none'";
            }
            if (!ss_additionalfeatures_ps) {
                display_AdditionalDetails = "style='display:none'";
            }


            var ss_admintab = ss_admintab_ps ? "checked" : "";
            var ss_journaltab = ss_journaltab_ps ? "checked" : "";
            var ss_reportingstat = ss_reportingstat_ps ? "checked" : "";
            var ss_reminderalert = ss_reminderalert_ps ? "checked" : "";
            var ss_casechat = ss_casechat_ps ? "checked" : "";
            var ss_deepsearch = ss_deepsearch_ps ? "checked" : "";
            var ss_anonymizationpdf = ss_anonymizationpdf_ps ? "checked" : "";
            var ss_translationfunoffice = ss_translationto_ps ? "checked" : "";
            var ss_translationfundeepl = ss_translationmt_ps ? "checked" : "";
            var ss_2factorauth = ss_2factorauth_ps ? "checked" : "";
            var ss_ipwhitelisting = ss_ipwhitelisting_ps ? "checked" : "";
            var ss_caseimporterfun = ss_caseimporterfun_ps ? "checked" : "";
            var ss_customdomainurl = ss_customdomainurl_ps ? "checked" : "";
            var ss_ssointegration = ss_ssointegration_ps ? "checked" : "";
            var ss_apiintegration = ss_apiintegration_ps ? "checked" : "";
            var ss_callcenterpi = ss_phoneintakecc_ps ? "checked" : "";
            var ss_automatedmessagesi = ss_phoneintakeams_ps ? "checked" : "";
            var ss_emailintake = ss_emailintake_ps ? "checked" : "";
            var ss_securecommunicationcftp = ss_securecommunicationcftp_ps ? "checked" : "";
            var ss_additionalfeatures = ss_additionalfeatures_ps ? "checked" : "";
            //==========
            //   var ss_languagescheck = ss_languages ? "checked" : "";
            //   var ss_casemanagercheck = ss_casemanager ? "checked" : "";
            //   var ss_admincheck = ss_admin ? "checked" : "";



            //New Subtable for EQS IntergrityLine Add-On, @18-12 
            var markup = "<tr class='OppProducts2' " + display_prop + "><td style='background: transparent;'></td><td class='class='text-center' colspan='4'>"
                + "<table class='table table-responsive ILaddon table-sm text-center border-0 removetable ' id='" + opp_prodid + "_pt'  >"
                + "<tbody class='subtableBody' id='" + opp_prodid + "_p'>"
                + "<tr><td class='subfield' >Admin Tab</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_admintab + "></td><td><input type='text' class='subTableFee' value='" + ss_admintabsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_admintabmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_admintabyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Journal Tab</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_journaltab + "></td><td><input type='text' class='subTableFee' value='" + ss_journaltabsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_journaltabmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_journaltabyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Reporting & Statistics (Charts)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_reportingstat + "></td><td><input type='text' class='subTableFee' value='" + ss_reportingstatsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_reportingstatmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_reportingstatyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Reminders & Alerts</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_reminderalert + "></td><td><input type='text' class='subTableFee' value='" + ss_reminderalertsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_reminderalertmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_reminderalertyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Case Chat</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_casechat + "></td><td><input type='text' class='subTableFee' value='" + ss_casechatsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_casechatmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_casechatyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Deep Search (in all cases and case details)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_deepsearch + "></td><td><input type='text' class='subTableFee' value='" + ss_deepsearchsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_deepsearchmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_deepsearchyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Anonymization in PDFs (add on to anoymization function)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_anonymizationpdf + "></td><td><input type='text' class='subTableFee' value='" + ss_anonymizationpdfsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_anonymizationpdfmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_anonymizationpdfyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Translation (translation office)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_translationfunoffice + "></td><td><input type='text' class='subTableFee' value='" + ss_translationtosfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_translationtomfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_translationtoyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Translation (machine translation)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_translationfundeepl + "></td><td><input type='text' class='subTableFee' value='" + ss_translationmtsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_translationmtmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_translationmtyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >2 factor Authentication (Backend)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_2factorauth + "></td><td><input type='text' class='subTableFee' value='" + ss_2factorauthsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_2factorauthmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_2factorauthyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >IP Whitelisting (Backend)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_ipwhitelisting + "></td><td><input type='text' class='subTableFee' value='" + ss_ipwhitelistingsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_ipwhitelistingmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_ipwhitelistingyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Case Importer function (via xls upload)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_caseimporterfun + "></td><td><input type='text' class='subTableFee' value='" + ss_caseimporterfunsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_caseimporterfunmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_caseimporterfunyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Custom Domain/URL</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_customdomainurl + "></td><td><input type='text' class='subTableFee' value='" + ss_customdomainurlsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_customdomainurlmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_customdomainurlyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >SSO integration (single sign on via SAML2)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_ssointegration + "></td><td><input type='text' class='subTableFee' value='" + ss_ssointegrationsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_ssointegrationmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_ssointegrationyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >API integration (via RESTful)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_apiintegration + "></td><td><input type='text' class='subTableFee' value='" + ss_apiintegrationsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_apiintegrationmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_apiintegrationyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Phone Intake (call center)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_callcenterpi + "></td><td><input type='text' class='subTableFee' value='" + ss_phoneintakeccsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_phoneintakeccmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_phoneintakeccyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Phone Intake (automated message service)</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_automatedmessagesi + "></td><td><input type='text' class='subTableFee' value='" + ss_phoneintakeamssfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_phoneintakeamsmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_phoneintakeamsyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Email Intake</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_emailintake + "></td><td><input type='text' class='subTableFee' value='" + ss_emailintakesfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_emailintakemfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_emailintakeyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield' >Secure communication channel for third parties</td><td><input type='checkbox' value='' class='fieldcheck' " + ss_securecommunicationcftp + "></td><td><input type='text' class='subTableFee' value='" + ss_securecommunicationcftpsfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_securecommunicationcftpmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_securecommunicationcftpyfee_ps + "'></td></tr>"

                // + "<tr><td class='subfield' >Add. Languages </td><td><input type='checkbox' class='fieldcheck' "+ss_languagescheck+"></td><td><input type='text' class='subTableFee' value='"+ss_languagessetup+"'></td><td><input type='text' class='subTableMFee' value='"+ss_languagesmfee+"'></td><td><input type='text' class='subTableYFee' value='"+ss_languagesyfee+"'></td></tr>"
                // + "<tr><td class='subfield' >Add. Case Manager - Named User </td><td><input type='checkbox' class='fieldcheck' "+ss_casemanagercheck+"></td><td><input type='text' class='subTableFee' value='"+ss_casemanagersetup+"'></td><td><input type='text' class='subTableMFee' value='"+ss_casemanagermfee+"'></td><td><input type='text' class='subTableYFee' value='"+ss_casemanageryfee+"'></td></tr>"
                // + "<tr><td class='subfield' >Add. Admin - Named User </td><td><input type='checkbox' class='fieldcheck' "+ss_admincheck+"></td><td><input type='text' class='subTableFee' value='"+ss_adminsetup+"'></td><td><input type='text' class='subTableMFee' value='"+ss_adminmfee+"'></td><td><input type='text' class='subTableYFee' value='"+ss_adminyfee+"'></td></tr>"

                + "<tr class = 'subfield'><td class='subfield'>Languages </td><td><input type='number' class='numberfield' min='0' value='" + ss_languages + "'></td><td><input type='text' class='subTableFee' value='" + ss_languagessetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_languagesmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_languagesyfee + "'></td></tr>"
                + "<tr class = 'subfield'><td class='subfield'>Case Manager - Named User </td><td><input type='number' class='numberfield' min='0' value='" + ss_casemanager + "'></td><td><input type='text' class='subTableFee' value='" + ss_casemanagersetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_casemanagermfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_casemanageryfee + "'></td></tr>"
                + "<tr class = 'subfield'><td class='subfield'>Admin - Named User </td><td><input type='number' class='numberfield' min='0' value='" + ss_admin + "'></td><td><input type='text' class='subTableFee' value='" + ss_adminsetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_adminmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_adminyfee + "'></td></tr>"
                + "<tr class = 'subfield'><td class='subfield'>Phone Number/Language</td><td><input type='number' class='numberfield' min='0' value='" + ss_phonelang + "'></td><td><input type='text' class='subTableFee' value='" + ss_phonelangsfee + "'></td><td><input type='text' class='subTableMFee' value='" + ss_phonelangmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_phonelangyfee + "'></td></tr>"

                + "<tr><td class='subfield' >Additional Features </td><td><input type='checkbox' value='' id='additionaldetails' class='fieldcheck' " + ss_additionalfeatures + "></td><td><input type='text' class='subTableFee' value='" + ss_additionalfeaturessfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_additionalfeaturesmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_additionalfeaturesyfee_ps + "'></td></tr>"
                + "<tr class='additionaldetailsRow' " + display_AdditionalDetails + "><td class='subfield' colspan='2'>Enter Details</td><td colspan='3'><textarea class='additionaldetailsField' rows='3' style='width:400px;'>" + ss_additionalfeaturesaddon_ps + "</textarea></td></tr>"
                + "</tbody></table></td></tr>";

            return markup;


        }

        function AddSubTableDataForIntegrityAdd_On(entity, subtable, isLicProduct) {
            var subTBody = $(subtable).find('td:eq(1)').find('.subtableBody');
            var allRows = [];
            var isAdditionalDetailsChecked = false;
            for (var i = 0; i < 25; i++) {
                allRows[i] = $(subTBody).find('tr:eq(' + i + ')');
            }
            // Flag fields
            entity.ss_admintab_ps = $(allRows[0]).find('.fieldcheck').prop("checked");
            entity.ss_journaltab_ps = $(allRows[1]).find('.fieldcheck').prop("checked");
            entity.ss_reportingstat_ps = $(allRows[2]).find('.fieldcheck').prop("checked");
            entity.ss_reminderalert_ps = $(allRows[3]).find('.fieldcheck').prop("checked");
            entity.ss_casechat_ps = $(allRows[4]).find('.fieldcheck').prop("checked");
            entity.ss_deepsearch_ps = $(allRows[5]).find('.fieldcheck').prop("checked");
            entity.ss_anonymizationpdf_ps = $(allRows[6]).find('.fieldcheck').prop("checked");
            entity.ss_translationto_ps = $(allRows[7]).find('.fieldcheck').prop("checked");
            entity.ss_translationmt_ps = $(allRows[8]).find('.fieldcheck').prop("checked");
            entity.ss_2factorauth_ps = $(allRows[9]).find('.fieldcheck').prop("checked");
            entity.ss_ipwhitelisting_ps = $(allRows[10]).find('.fieldcheck').prop("checked");
            entity.ss_caseimporterfun_ps = $(allRows[11]).find('.fieldcheck').prop("checked");
            entity.ss_customdomainurl_ps = $(allRows[12]).find('.fieldcheck').prop("checked");
            entity.ss_ssointegration_ps = $(allRows[13]).find('.fieldcheck').prop("checked");
            entity.ss_apiintegration_ps = $(allRows[14]).find('.fieldcheck').prop("checked");
            entity.ss_phoneintakecc_ps = $(allRows[15]).find('.fieldcheck').prop("checked");
            entity.ss_phoneintakeams_ps = $(allRows[16]).find('.fieldcheck').prop("checked");
            entity.ss_emailintake_ps = $(allRows[17]).find('.fieldcheck').prop("checked");
            entity.ss_securecommunicationcftp_ps = $(allRows[18]).find('.fieldcheck').prop("checked");
            entity.ss_additionalfeatures_ps = $(allRows[23]).find('.fieldcheck').prop("checked");

            // entity.ss_languagescheck_ps = $(allRows[19]).find('.fieldcheck').prop("checked");
            // entity.ss_casemanagercheck_ps = $(allRows[20]).find('.fieldcheck').prop("checked");
            // entity.ss_admincheck_ps = $(allRows[21]).find('.fieldcheck').prop("checked");
            entity.ss_languages = $(allRows[19]).find('.numberfield').val();
            entity.ss_casemanager = $(allRows[20]).find('.numberfield').val();
            entity.ss_admin = $(allRows[21]).find('.numberfield').val();
            entity.ss_phonelang = $(allRows[22]).find('.numberfield').val();

            isAdditionalDetailsChecked = $(allRows[23]).find('.fieldcheck').prop('checked');
            //Adding Setup Fee      
            entity.ss_admintabsfee_ps = parseFloat(RemoveFormattings($(allRows[0]).find('.subTableFee').val()));
            entity.ss_journaltabsfee_ps = parseFloat(RemoveFormattings($(allRows[1]).find('.subTableFee').val()));
            entity.ss_reportingstatsfee_ps = parseFloat(RemoveFormattings($(allRows[2]).find('.subTableFee').val()));
            entity.ss_reminderalertsfee_ps = parseFloat(RemoveFormattings($(allRows[3]).find('.subTableFee').val()));
            entity.ss_casechatsfee_ps = parseFloat(RemoveFormattings($(allRows[4]).find('.subTableFee').val()));
            entity.ss_deepsearchsfee_ps = parseFloat(RemoveFormattings($(allRows[5]).find('.subTableFee').val()));
            entity.ss_anonymizationpdfsfee_ps = parseFloat(RemoveFormattings($(allRows[6]).find('.subTableFee').val()));
            entity.ss_translationtosfee_ps = parseFloat(RemoveFormattings($(allRows[7]).find('.subTableFee').val()));
            entity.ss_translationmtsfee_ps = parseFloat(RemoveFormattings($(allRows[8]).find('.subTableFee').val()));
            entity.ss_2factorauthsfee_ps = parseFloat(RemoveFormattings($(allRows[9]).find('.subTableFee').val()));
            entity.ss_ipwhitelistingsfee_ps = parseFloat(RemoveFormattings($(allRows[10]).find('.subTableFee').val()));
            entity.ss_caseimporterfunsfee_ps = parseFloat(RemoveFormattings($(allRows[11]).find('.subTableFee').val()));
            entity.ss_customdomainurlsfee_ps = parseFloat(RemoveFormattings($(allRows[12]).find('.subTableFee').val()));
            entity.ss_ssointegrationsfee_ps = parseFloat(RemoveFormattings($(allRows[13]).find('.subTableFee').val()));
            entity.ss_apiintegrationsfee_ps = parseFloat(RemoveFormattings($(allRows[14]).find('.subTableFee').val()));
            entity.ss_phoneintakeccsfee_ps = parseFloat(RemoveFormattings($(allRows[15]).find('.subTableFee').val()));
            entity.ss_phoneintakeamssfee_ps = parseFloat(RemoveFormattings($(allRows[16]).find('.subTableFee').val()));
            entity.ss_emailintakesfee_ps = parseFloat(RemoveFormattings($(allRows[17]).find('.subTableFee').val()));
            entity.ss_securecommunicationcftpsfee_ps = parseFloat(RemoveFormattings($(allRows[18]).find('.subTableFee').val()));

            entity.ss_languagessetup = parseFloat(RemoveFormattings($(allRows[19]).find('.subTableFee').val()));
            entity.ss_casemanagersetup = parseFloat(RemoveFormattings($(allRows[20]).find('.subTableFee').val()));
            entity.ss_adminsetup = parseFloat(RemoveFormattings($(allRows[21]).find('.subTableFee').val()));
            entity.ss_phonelangsfee = parseFloat(RemoveFormattings($(allRows[22]).find('.subTableFee').val()));
            entity.ss_additionalfeaturessfee_ps = isAdditionalDetailsChecked ? parseFloat(RemoveFormattings($(allRows[23]).find('.subTableFee').val())) : 0.00;

            //Adding Monthly Fee                    
            entity.ss_admintabmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[0]).find('.subTableMFee').val())) : 0.00;
            entity.ss_journaltabmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[1]).find('.subTableMFee').val())) : 0.00;
            entity.ss_reportingstatmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[2]).find('.subTableMFee').val())) : 0.00;
            entity.ss_reminderalertmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[3]).find('.subTableMFee').val())) : 0.00;
            entity.ss_casechatmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[4]).find('.subTableMFee').val())) : 0.00;
            entity.ss_deepsearchmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[5]).find('.subTableMFee').val())) : 0.00;
            entity.ss_anonymizationpdfmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[6]).find('.subTableMFee').val())) : 0.00;
            entity.ss_translationtomfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[7]).find('.subTableMFee').val())) : 0.00;
            entity.ss_translationmtmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[8]).find('.subTableMFee').val())) : 0.00;
            entity.ss_2factorauthmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[9]).find('.subTableMFee').val())) : 0.00;
            entity.ss_ipwhitelistingmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[10]).find('.subTableMFee').val())) : 0.00;
            entity.ss_caseimporterfunmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[11]).find('.subTableMFee').val())) : 0.00;
            entity.ss_customdomainurlmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[12]).find('.subTableMFee').val())) : 0.00;
            entity.ss_ssointegrationmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[13]).find('.subTableMFee').val())) : 0.00;
            entity.ss_apiintegrationmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[14]).find('.subTableMFee').val())) : 0.00;
            entity.ss_phoneintakeccmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[15]).find('.subTableMFee').val())) : 0.00;
            entity.ss_phoneintakeamsmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[16]).find('.subTableMFee').val())) : 0.00;
            entity.ss_emailintakemfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[17]).find('.subTableMFee').val())) : 0.00;
            entity.ss_securecommunicationcftpmfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[18]).find('.subTableMFee').val())) : 0.00;

            entity.ss_languagesmfee = isLicProduct ? parseFloat(RemoveFormattings($(allRows[19]).find('.subTableMFee').val())) : 0.00;
            entity.ss_casemanagermfee = isLicProduct ? parseFloat(RemoveFormattings($(allRows[20]).find('.subTableMFee').val())) : 0.00;
            entity.ss_adminmfee = isLicProduct ? parseFloat(RemoveFormattings($(allRows[21]).find('.subTableMFee').val())) : 0.00;
            entity.ss_phonelangmfee = isLicProduct ? parseFloat(RemoveFormattings($(allRows[22]).find('.subTableMFee').val())) : 0.00;
            entity.ss_additionalfeaturesmfee_ps = (isLicProduct && isAdditionalDetailsChecked) ? parseFloat(RemoveFormattings($(allRows[23]).find('.subTableMFee').val())) : 0.00;

            //Adding Yealy Fee
            entity.ss_admintabyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[0]).find('.subTableYFee').val())) : 0.00;
            entity.ss_journaltabyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[1]).find('.subTableYFee').val())) : 0.00;
            entity.ss_reportingstatyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[2]).find('.subTableYFee').val())) : 0.00;
            entity.ss_reminderalertyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[3]).find('.subTableYFee').val())) : 0.00;
            entity.ss_casechatyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[4]).find('.subTableYFee').val())) : 0.00;
            entity.ss_deepsearchyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[5]).find('.subTableYFee').val())) : 0.00;
            entity.ss_anonymizationpdfyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[6]).find('.subTableYFee').val())) : 0.00;
            entity.ss_translationtoyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[7]).find('.subTableYFee').val())) : 0.00;
            entity.ss_translationmtyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[8]).find('.subTableYFee').val())) : 0.00;
            entity.ss_2factorauthyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[9]).find('.subTableYFee').val())) : 0.00;
            entity.ss_ipwhitelistingyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[10]).find('.subTableYFee').val())) : 0.00;
            entity.ss_caseimporterfunyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[11]).find('.subTableYFee').val())) : 0.00;
            entity.ss_customdomainurlyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[12]).find('.subTableYFee').val())) : 0.00;
            entity.ss_ssointegrationyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[13]).find('.subTableYFee').val())) : 0.00;
            entity.ss_apiintegrationyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[14]).find('.subTableYFee').val())) : 0.00;
            entity.ss_phoneintakeccyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[15]).find('.subTableYFee').val())) : 0.00;
            entity.ss_phoneintakeamsyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[16]).find('.subTableYFee').val())) : 0.00;
            entity.ss_emailintakeyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[17]).find('.subTableYFee').val())) : 0.00;
            entity.ss_securecommunicationcftpyfee_ps = isLicProduct ? parseFloat(RemoveFormattings($(allRows[18]).find('.subTableYFee').val())) : 0.00;

            entity.ss_languagesyfee = isLicProduct ? parseFloat(RemoveFormattings($(allRows[19]).find('.subTableYFee').val())) : 0.00;
            entity.ss_casemanageryfee = isLicProduct ? parseFloat(RemoveFormattings($(allRows[20]).find('.subTableYFee').val())) : 0.00;
            entity.ss_adminyfee = isLicProduct ? parseFloat(RemoveFormattings($(allRows[21]).find('.subTableYFee').val())) : 0.00;
            entity.ss_phonelangyfee = isLicProduct ? parseFloat(RemoveFormattings($(allRows[22]).find('.subTableYFee').val())) : 0.00;
            
            entity.ss_additionalfeaturesyfee_ps = (isLicProduct && isAdditionalDetailsChecked) ? parseFloat(RemoveFormattings($(allRows[22]).find('.subTableYFee').val())) : 0.00;
            entity.ss_additionalfeaturesaddon_ps = isAdditionalDetailsChecked ? $(allRows[24]).find('.additionaldetailsField').val() : "";

            //console.log(entity);
            return entity;
        }



        function embedSubTableForPolicyManager(productname, OPIndex, oportunityproducts, opp_prodid, ss_productdescription) {
            var sBassicDefault = (oportunityproducts.value[OPIndex] === undefined || oportunityproducts.value[OPIndex] === "undefined" || oportunityproducts.value[OPIndex] === null) ? true : false;
            var display_prop = display_support = "";

            var ss_admin = ss_employees = ss_languages = ss_activepolicies_ps = 0;
            var ss_supportbasic = ss_supportprofessional = false;

            var ss_adminsetup = ss_languagessetup = ss_activepoliciessfee_ps = ss_supportbasicsetup = ss_supportprofessionalsfee = ss_employeessetup = AddFormattings(0.00);
            var ss_adminmfee = ss_languagesmfee = ss_activepoliciesmfee_ps = ss_supportbasicmfee = ss_supportprofessionalmfee = ss_employeesmfee = AddFormattings(0.00);
            var ss_adminyfee = ss_languagesyfee = ss_activepoliciesyfee_ps = ss_supportbasicyfee = ss_supportprofessionalyfee = ss_employeesyfee = AddFormattings(0.00);

            if (OPIndex >= 0) {

                ss_employees = oportunityproducts.value[OPIndex]["ss_employees"] ? oportunityproducts.value[OPIndex]["ss_employees"] : 0;
                ss_employeessetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_employeessetup"] ? oportunityproducts.value[OPIndex]["ss_employeessetup"] : 0.00);
                ss_employeesmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_employeesmfee"] ? oportunityproducts.value[OPIndex]["ss_employeesmfee"] : 0.00);
                ss_employeesyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_employeesyfee"] ? oportunityproducts.value[OPIndex]["ss_employeesyfee"] : 0.00);

                ss_activepolicies_ps = oportunityproducts.value[OPIndex]["ss_activepolicies_ps"] ? oportunityproducts.value[OPIndex]["ss_activepolicies_ps"] : 0;
                ss_activepoliciessfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_activepoliciessfee_ps"] ? oportunityproducts.value[OPIndex]["ss_activepoliciessfee_ps"] : 0.00);
                ss_activepoliciesmfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_activepoliciesmfee_ps"] ? oportunityproducts.value[OPIndex]["ss_activepoliciesmfee_ps"] : 0.00);
                ss_activepoliciesyfee_ps = AddFormattings(oportunityproducts.value[OPIndex]["ss_activepoliciesyfee_ps"] ? oportunityproducts.value[OPIndex]["ss_activepoliciesyfee_ps"] : 0.00);

                ss_languages = oportunityproducts.value[OPIndex]["ss_languages"] ? oportunityproducts.value[OPIndex]["ss_languages"] : 0;
                ss_languagessetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagessetup"] ? oportunityproducts.value[OPIndex]["ss_languagessetup"] : 0.00);
                ss_languagesmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagesmfee"] ? oportunityproducts.value[OPIndex]["ss_languagesmfee"] : 0.00);
                ss_languagesyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_languagesyfee"] ? oportunityproducts.value[OPIndex]["ss_languagesyfee"] : 0.00);

                ss_supportbasic = oportunityproducts.value[OPIndex]["ss_supportbasic"] ? oportunityproducts.value[OPIndex]["ss_supportbasic"] : false;
                ss_supportbasicsetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportbasicsetup"] ? oportunityproducts.value[OPIndex]["ss_supportbasicsetup"] : 0.00);
                ss_supportbasicmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportbasicmfee"] ? oportunityproducts.value[OPIndex]["ss_supportbasicmfee"] : 0.00);
                ss_supportbasicyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportbasicyfee"] ? oportunityproducts.value[OPIndex]["ss_supportbasicyfee"] : 0.00);
                ss_supportprofessional = oportunityproducts.value[OPIndex]["ss_supportprofessional"] ? oportunityproducts.value[OPIndex]["ss_supportprofessional"] : false;
                ss_supportprofessionalsfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportprofessionalsfee"] ? oportunityproducts.value[OPIndex]["ss_supportprofessionalsfee"] : 0.00);
                ss_supportprofessionalmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportprofessionalmfee"] ? oportunityproducts.value[OPIndex]["ss_supportprofessionalmfee"] : 0.00);
                ss_supportprofessionalyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_supportprofessionalyfee"] ? oportunityproducts.value[OPIndex]["ss_supportprofessionalyfee"] : 0.00);

                ss_admin = oportunityproducts.value[OPIndex]["ss_admin"] ? oportunityproducts.value[OPIndex]["ss_admin"] : 0;
                ss_adminsetup = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminsetup"] ? oportunityproducts.value[OPIndex]["ss_adminsetup"] : 0.00);
                ss_adminmfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminmfee"] ? oportunityproducts.value[OPIndex]["ss_adminmfee"] : 0.00);
                ss_adminyfee = AddFormattings(oportunityproducts.value[OPIndex]["ss_adminyfee"] ? oportunityproducts.value[OPIndex]["ss_adminyfee"] : 0.00);


            }
            else {
                display_prop = "style='display:none'";
            }


            var sbassic = (ss_supportbasic || sBassicDefault) ? "checked" : "";
            var sprofessional = (ss_supportprofessional) ? "checked" : "";
            var ActivePName = "Active Policies ";
            var TableMainClass = "OppProducts3";
            var supportBClass = "supportb2";
            var supportPClass = "supportp2";
            if (productname === "EQS Approval Manager") {
                ActivePName = "Requests per Year ";
                TableMainClass = "OppProducts4";
                supportBClass = "supportb3";
                supportPClass = "supportp3";
            }



            var markup = "<tr class='" + TableMainClass + "' " + display_prop + "><td style='background: transparent;'></td><td class='class='text-center' colspan='4'>"
                + "<table class='table table-responsive table-sm text-center border-0 removetable ' id='" + opp_prodid + "_pt'  >"
                + "<tbody class='subtableBody' id='" + opp_prodid + "_p'>"
                + "<tr><td class='subfield'>User/Employees </td><td><input type='number' min='0' value='" + ss_employees + "' ></td><td><input type='text' class='subTableFee' value='" + ss_employeessetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_employeesmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_employeesyfee + "'></td></tr>"
                + "<tr><td class='subfield'>" + ActivePName + "</td><td><input type='number' min='0' value='" + ss_activepolicies_ps + "' ></td><td><input type='text' class='subTableFee' value='" + ss_activepoliciessfee_ps + "'></td><td><input type='text' class='subTableMFee' value='" + ss_activepoliciesmfee_ps + "'></td><td><input type='text' class='subTableYFee' value='" + ss_activepoliciesyfee_ps + "'></td></tr>"
                + "<tr><td class='subfield'>Admin - Named User</td><td><input type='number' min='0' value='" + ss_admin + "'></td><td><input type='text' class='subTableFee' value='" + ss_adminsetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_adminmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_adminyfee + "'></td></tr>"
                + "<tr><td class='subfield'>Languages </td><td><input type='number'  min='0' value='" + ss_languages + "'></td><td><input type='text' class='subTableFee' value='" + ss_languagessetup + "'></td><td><input type='text' class='subTableMFee' value='" + ss_languagesmfee + "'></td><td><input type='text' class='subTableYFee' value='" + ss_languagesyfee + "'></td></tr>"
                + "<tr><td class='mainSupportTd' colspan='5'> Support </td></tr>"
                + "<tr class='support ' ><td class='subfield'> Basic </td><td class='supportTd'><input type='checkbox' " + sbassic + " class='" + supportBClass + " subSupportCheckBox' name='" + sBassicDefault + "'></td><td><input type='text' class='subTableSupportFee subTableSupportSFee' value='" + ss_supportbasicsetup + "'></td><td><input type='text' class='subTableSupportFee subTableSupportMFee' value='" + ss_supportbasicmfee + "'></td><td><input type='text' class='subTableSupportFee subTableSupportYFee' value='" + ss_supportbasicyfee + "'></td></tr>"
                + "<tr class='support ' ><td class='subfield'> Professional </td><td class='supportTd'><input type='checkbox' " + sprofessional + " class='" + supportPClass + " subSupportCheckBox'></td><td><input type='text'  class='subTableSupportFee subTableSupportSFee' value='" + ss_supportprofessionalsfee + "'></td><td><input type='text' class='subTableSupportFee subTableSupportMFee' value='" + ss_supportprofessionalmfee + "'></td><td><input type='text' class='subTableSupportFee subTableSupportYFee' value='" + ss_supportprofessionalyfee + "'></td></tr>"
                + "</tbody></table></td></tr>";

            return markup;
        }
        //new
        function embedSubTableforRegulatoryandNews(productname, OPIndex, oportunityproducts, Prod_Id, ss_productdescription) {
            var ss_pakcheck = false;
            var ss_kapcheck = false;
            var display_prop = "";
            var display_Pak = "style='width:250px;'";
            var display_Kap = "style='width:250px;'";
            var ss_pakquantity = ss_kapamount = ss_kapquantity = "";
            if (OPIndex > 0) {
                ss_pakcheck = oportunityproducts.value[OPIndex]["ss_pakcheck"] ? oportunityproducts.value[OPIndex]["ss_pakcheck"] : false;
                ss_kapcheck = oportunityproducts.value[OPIndex]["ss_kapcheck"] ? oportunityproducts.value[OPIndex]["ss_kapcheck"] : false;
                ss_pakquantity = oportunityproducts.value[OPIndex]["ss_pakquantity"] ? oportunityproducts.value[OPIndex]["ss_pakquantity"] : 0;
                ss_kapamount = oportunityproducts.value[OPIndex]["ss_kapamount"] ? oportunityproducts.value[OPIndex]["ss_kapamount"] : 0;
                ss_kapquantity = oportunityproducts.value[OPIndex]["ss_kapquantity"] ? oportunityproducts.value[OPIndex]["ss_kapquantity"] : 0;
            }
            else {
                display_prop = "style='display:none'";
            }
            var pakcheck = ss_pakcheck ? "checked" : "";
            var kapcheck = ss_kapcheck ? "checked" : "";
            if(!ss_pakcheck)
            {               
             display_Pak = "style='display:none;width:200px;'";
            }
            if(!ss_kapcheck)
            {               
             display_Kap = "style='display:none;width:200px;'";
            }
            var TableMainClass = "OppProducts5";
            var regulatoryandnews = `<tr class=${TableMainClass} ${display_prop}><td style='background: transparent;'></td><td class='text-center' colspan='4'>
                <table class='table table-responsive table-sm text-center border-0 removetable ' id= ${Prod_Id}_pt>  
                <tbody class='subtableBody' id=${Prod_Id} +'_p'>

                    <tr> <td class ='subfield' style="width:100px;"><input type ='checkbox' id ='pak_chkbox' class ='fieldcheck_pak' ${pakcheck}>&nbsp;&nbsp;PAK</td>

                        <td id =${Prod_Id}_pak ${display_Pak} >Quantity:<input type ='number' id ='pak_quantity' class ='kap_pak' value = ${ss_pakquantity}></td>
                        <td style="width:200px;"></td>
                    </tr>

                    <tr> <td class ='subfield' style="width:100px;"><input type ='checkbox' id ='kap_chkbox' class = 'fieldcheck_kap' ${kapcheck}>&nbsp;&nbsp;KAP</td>

                        <td id =${Prod_Id}_kap_q ${display_Kap} class ='td'>Quantity:<input type ='number' id ='kap_quantity' class ='kap_pak' value = ${ss_kapquantity}></td>

                        <td id =${Prod_Id}_kap_am ${display_Kap} class ='td'>Amount:<input type ='number' id ='kap_amount' class ='kap_pak' value = ${ss_kapamount}></td>
                    </tr>

                </tbody></table></td></tr>`;

            return regulatoryandnews;
        }
        function AddSubTableDataForRegulatoryNews(entity, subtable, isLicProduct) {
            var subTBody = $(subtable).find('td:eq(1)').find('.subtableBody');
            var pak_chk = false;
            var kap_chk = false;
            var allRows = [];
            for (var i = 0; i < 2; i++) {
                allRows[i] = $(subTBody).find('tr:eq(' + i + ')');
            }
            entity.ss_pakcheck = $(allRows[0]).find('.fieldcheck_pak').prop("checked");
            entity.ss_kapcheck = $(allRows[1]).find('.fieldcheck_kap').prop("checked");
            pak_chk = $(allRows[0]).find('.fieldcheck_pak').prop("checked");
            kap_chk = $(allRows[1]).find('.fieldcheck_kap').prop("checked");
            entity.ss_pakquantity = pak_chk ? parseInt($(allRows[0]).find('#pak_quantity').val()) : 0;
            entity.ss_kapamount = kap_chk ? parseInt($(allRows[1]).find('#kap_amount').val()) : 0;
            entity.ss_kapquantity = kap_chk ? parseInt($(allRows[1]).find('#kap_quantity').val()) : 0;

            return entity;
        }
        function AddSubTableDataForPolicyManager(entity, subtable, isLicProduct) {
            var subTBody = $(subtable).find('td:eq(1)').find('.subtableBody');
            var tr1 = $(subTBody).find('tr:eq(0)');
            var tr2 = $(subTBody).find('tr:eq(1)');
            var tr3 = $(subTBody).find('tr:eq(2)');
            var tr4 = $(subTBody).find('tr:eq(3)');
            var tr5 = $(subTBody).find('tr:eq(4)');
            var tr6 = $(subTBody).find('tr:eq(5)');
            var tr7 = $(subTBody).find('tr:eq(6)');


            //Employees
            entity.ss_eqspolicymdata_ps = !isLicProduct ? "" : "User/Employees: ";
            entity.ss_employees = parseInt($(tr1).find('td:eq(1)').find('input[type=number]').val());
            entity.ss_eqspolicymdata_ps += !isLicProduct ? "" : entity.ss_employees;
            entity.ss_employeessetup = parseFloat(RemoveFormattings($(tr1).find('td:eq(2)').find('input[type=text]').val()));
            entity.ss_employeesmfee = !isLicProduct ? parseFloat(RemoveFormattings($(tr1).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
            entity.ss_employeesyfee = !isLicProduct ? parseFloat(RemoveFormattings($(tr1).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
            //Active Policies
            entity.ss_eqspolicymdata_ps += !isLicProduct ? "" : "\nActive Policies: ";
            entity.ss_activepolicies_ps = parseInt($(tr2).find('td:eq(1)').find('input[type=number]').val());
            entity.ss_eqspolicymdata_ps += !isLicProduct ? "" : entity.ss_activepolicies_ps;
            entity.ss_activepoliciessfee_ps = parseFloat(RemoveFormattings($(tr2).find('td:eq(2)').find('input[type=text]').val()));
            entity.ss_activepoliciesmfee_ps = !isLicProduct ? parseFloat(RemoveFormattings($(tr2).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
            entity.ss_activepoliciesyfee_ps = !isLicProduct ? parseFloat(RemoveFormattings($(tr2).find('td:eq(4)').find('input[type=text]').val())) : 0.00;

            //Admin - Named User
            entity.ss_eqspolicymdata_ps += !isLicProduct ? "" : "\nAdmin - Named User: ";
            entity.ss_admin = parseInt($(tr3).find('td:eq(1)').find('input[type=number]').val());
            entity.ss_eqspolicymdata_ps += !isLicProduct ? "" : entity.ss_admin;
            entity.ss_adminsetup = parseFloat(RemoveFormattings($(tr3).find('td:eq(2)').find('input[type=text]').val()));
            entity.ss_adminmfee = isLicProduct ? parseFloat(RemoveFormattings($(tr3).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
            entity.ss_adminyfee = isLicProduct ? parseFloat(RemoveFormattings($(tr3).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
            //Languages 
            entity.ss_languages = parseInt($(tr4).find('td:eq(1)').find('input[type=number]').val());
            entity.ss_languagessetup = parseFloat(RemoveFormattings($(tr4).find('td:eq(2)').find('input[type=text]').val()));
            entity.ss_languagesmfee = isLicProduct ? parseFloat(RemoveFormattings($(tr4).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
            entity.ss_languagesyfee = isLicProduct ? parseFloat(RemoveFormattings($(tr4).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
            //Support-Basic
            var sBasic = $(tr6).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
            var sprofessional = $(tr7).find('td:eq(1)').find('input[type=checkbox]').prop("checked");
            entity.ss_eqspolicymdata_ps += (sBasic && isLicProduct) ? "\nSupport: Basic\n\n" : ((sprofessional && isLicProduct) ? "\nSupport: Professional\n\n" : "");
            entity.ss_supportbasic = sBasic;
            entity.ss_supportbasicsetup = sBasic ? parseFloat(RemoveFormattings($(tr6).find('td:eq(2)').find('input[type=text]').val())) : 0.00;
            entity.ss_supportbasicmfee = (sBasic && isLicProduct) ? parseFloat(RemoveFormattings($(tr6).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
            entity.ss_supportbasicyfee = (sBasic && isLicProduct) ? parseFloat(RemoveFormattings($(tr6).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
            //Support-professional
            entity.ss_supportprofessional = sprofessional;
            entity.ss_supportprofessionalsfee = sprofessional ? parseFloat(RemoveFormattings($(tr7).find('td:eq(2)').find('input[type=text]').val())) : 0.00;
            entity.ss_supportprofessionalmfee = (sprofessional && isLicProduct) ? parseFloat(RemoveFormattings($(tr7).find('td:eq(3)').find('input[type=text]').val())) : 0.00;
            entity.ss_supportprofessionalyfee = (sprofessional && isLicProduct) ? parseFloat(RemoveFormattings($(tr7).find('td:eq(4)').find('input[type=text]').val())) : 0.00;
            //Setup Text Value
            entity.ss_stval_ps = isLicProduct ? "" : "Setup";
            return entity;
        }
        function CalculateImplementationHours(SFee) {
            if (SFee <= 800) {
                return 3;
            }
            else if (SFee >= 801 && SFee <= 1500) {
                return 5;
            }
            else if (SFee >= 1501 && SFee <= 3000) {
                return 10;
            }
            else if (SFee > 3000) {
                return 15;
            }
        }        
            $(document).on("change", ".contract_val", function () {
                var currentrow = $(this).closest('tr');
                var contractlength = $(currentrow).find('.contract_val').val();
                var startdate = $(currentrow).find('.start_Date').val();
                
                if(startdate !== null && startdate !== undefined && contractlength !== '7' && contractlength !== 7)
                {
                    var date = new Date(startdate);
                   
					date.setMonth(date.getMonth()+ parseInt(contractlength));
                    var day = ("0" + date.getDate()).slice(-2);
                    var month = ("0" + (date.getMonth() + 1)).slice(-2);
                    var formatedSDate = date.getFullYear()+"-"+(month)+"-"+(day) ;
                    $(currentrow).find('.end_Date').val(formatedSDate);

                }
                else if(contractlength === 7 || contractlength === '7')
                {
                   
                    $(currentrow).find('.end_Date').val('');
                }
                
            });
            function checkbox_click(current) {
                var rowid = $(current).closest('tr').attr('id');
                var currentrow = $(current).closest('tr');
                var ischecked = $(current).prop('checked');
                if (ischecked) {
                    $(currentrow).find('td.contract_field').show();
                }
                else {
                    $(currentrow).find('td.contract_field').hide();
                }
            }

    </script>








</body></html>