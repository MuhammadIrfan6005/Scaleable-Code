<html><head>
    <style type="text/css">P { margin: 0; }</style>
    <meta>
</head>
<body onload="Onload()" onfocusout="parent.setEmailRange();" style="overflow-wrap: break-word;">

<meta charset="utf-8">
<title>Exsiting Contacts</title>



<script src="ClientGlobalContext.js.aspx"></script>
<link rel="stylesheet" href="ss_ProductContractPageStyle">
<script src="ss_jquery"></script>
<script src="ss_sdksoap.min"></script>
<script src="ss_Sdk.RetrieveMultiple"></script>
<script src="ss_sdk.Create"></script>
<script src="ss_sdk.Update"></script>
<meta charset="utf-8">
<style>
    .table-custom > thead > tr > th {
        border: none;
    }
    .table-custom > tbody > tr {
        height: 40px !important;
    }

        .table-custom > tbody > tr > td {
            border-bottom: 1px solid #e4e4e4 !important;
            font-size: 11px !important;
            font-weight: bold !important;
        }

    .table-custom {
        border-spacing: 0;
        width: 100%;
        margin-bottom: 20px;
        border-bottom: 2px solid black;
    }

    .greybig {
        text-align: center;
        background-image: url(ss_grey);
        background-repeat: no-repeat;
        background-size: 21px 21px;
    }

    .orangebig {
        text-align: center;
        background-image: url(ss_orange);
        background-repeat: no-repeat;
        background-size: 21px 21px;
    }

    .image-class {
        text-align: center;
        background-repeat: no-repeat;
        background-size: 21px 21px;
        height: 20px;
        border-radius: 15px;
    }

    input[type="text"] {
        border: none;
    }

    input {
        border: none;
    }

    .table-custom > thead > tr > td {
        font-size: 12px !important;
        text-decoration: none !important;
    }

    select {
        width: 100%;
        height: 50%;
    }
</style>



<div id="top">
    <h3 id="headerName">Product Details</h3>
</div>
<div id="main">
    <div id="content">
        <div class="loaderStyle" id="msgDiv"><img alt="" src="/_imgs/advfind/progress.gif"><br></div>
        <div id="scrollable_content">
            <table id="ProductsTable" class="table-custom" style="z-index: 0; max-height:400px;">

                <thead>
                    <tr style="background-color: lightgrey;">
                        <th style="width:14%;color:black;font-weight:bold; font-size:14px;"> Product Group</th>
                        <th style="width:1%"></th>
                        <th style="width:5%;color:black;font-weight:bold;">NAV Contract</th>
                        <th style="width:8%;color:black;font-weight:bold;">Contract Start Date</th>
                        <th style="width:5%;color:black;font-weight:bold;">Contract Period</th>
                        <th style="width:8%;color:black;font-weight:bold;">Termination Period</th>
                        <th style="width:8%;color:black;font-weight:bold;">Turnover Last Year</th>
                        <th style="width:8%;color:black;font-weight:bold;">Invoice Date</th>
                        <th style="width:10%;color:black;font-weight:bold;">Product Status</th>
                        <th style="width:8%;color:black;font-weight:bold;">Status Date</th>
                        <th style="width:10%;color:black;font-weight:bold;">Competitor</th>
                        <th style="width:15%;color:black;font-weight:bold;">Comments</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="App">
                        <td>App</td>
                        <td id="App_color"> <img src="ss_grey" class="image-class"></td>
                        <td id="App_contract"></td>
                        <td id="App_contractdate"><input type="date" onchange="updateContractStartDate(this, 'App')"></td>
                        <td id="App_contract_period">
                            <select onchange="updateContractPeriod(this, 'App')">
                                <option value="0">None</option>
                                <option value="1">12</option>
                                <option value="2">18</option>
                                <option value="3">24</option>
                                <option value="4">36</option>
                            </select>
                        </td>
                        <td id="App_contract_termination">
                            <select onchange="updatecontractTermination(this, 'App')">
                                <option value="0">None</option><option value="1">1 months</option>
                                <option value="2">3 months</option>
                            </select>
                        </td>
                        <td id="App_turnover" class="turnOver">0</td>
                        <td id="App_invoicedate"></td>
                        <td id="App_status">
                            <select id="_App" onchange="return SaveUpdateRow(this, 'App');">
                                <option value="0">None</option><option value="1">competitor</option>
                                <option value="2">not interested</option><option value="3">In contact</option>
                                <option value="4">Cancelled</option> <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="App_statusdate"></td>
                        <td id="App_competitor"></td>
                        <td id="App_comments">
                            <textarea onchange="updateComments(this, 'App')" rows="3" cols="30"></textarea>
                        </td>
                    </tr>
                    <tr id="Audio">
                        <td>Audio Webcast</td>
                        <td id="Audio_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Audio_contract"></td>
                        <td id="Audio_contractdate"><input type="date" onchange="updateContractStartDate(this,'Audio Webcast')"> </td>
                        <td id="Audio_contract_period"><select onchange="updateContractPeriod(this, 'Audio Webcast')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Audio_contract_termination"><select onchange="updatecontractTermination(this, 'Audio Webcast')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="Audio_turnover" class="turnOver">0</td>
                        <td id="Audio_invoicedate"></td>
                        <td id="Audio_status">
                            <select id="_Audio" onchange="return SaveUpdateRow(this, 'Audio Webcast');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Audio_statusdate"></td>
                        <td id="Audio_competitor"></td>
                        <td id="Audio_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Audio Webcast')"></textarea> </td>
                    </tr>
                    <tr id="Charts">
                        <td>Charts &amp; Invest. Calc.</td>
                        <td id="Charts_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Charts_contract"></td>
                        <td id="Charts_contractdate"><input type="date" onchange="updateContractStartDate(this,'Charts &amp; Invest. Calc.')"></td>
                        <td id="Charts_contract_period"><select onchange="updateContractPeriod(this, 'Charts &amp; Invest. Calc.')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Charts_contract_termination"><select onchange="updatecontractTermination(this, 'Charts &amp; Invest. Calc.')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Charts_turnover" class="turnOver">0</td>
                        <td id="Charts_invoicedate"></td>
                        <td id="Charts_status">
                            <select id="_Charts" onchange="return SaveUpdateRow(this, 'Charts &amp; Invest. Calc.');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Charts_statusdate"></td>
                        <td id="Charts_competitor"></td>
                        <td id="Charts_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Charts &amp; Invest. Calc.')"></textarea></td>
                    </tr>
                    <tr id="Contact">
                        <td>Contact Manager</td>
                        <td id="Contact_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Contact_contract"></td>
                        <td id="Contact_contractdate"><input type="date" onchange="updateContractStartDate(this,'Contact Manager')"></td>
                        <td id="Contact_contract_period"><select onchange="updateContractPeriod(this, 'Contact Manager')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Contact_contract_termination"><select onchange="updatecontractTermination(this, 'Contact Manager')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Contact_turnover" class="turnOver">0</td>
                        <td id="Contact_invoicedate"></td>
                        <td id="Contact_status">
                            <select id="_Contact" onchange="return SaveUpdateRow(this, 'Contact Manager');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Contact_statusdate"></td>
                        <td id="Contact_competitor"></td>
                        <td id="Contact_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Contact Manager')"></textarea></td>
                    </tr>
                    <tr id="Corp">
                        <td>Corp Web &amp; Micro</td>
                        <td id="Corp_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Corp_contract"></td>
                        <td id="Corp_contractdate"><input type="date" onchange="updateContractStartDate(this,'Corp Web &amp; Micro')"></td>
                        <td id="Corp_contract_period"><select onchange="updateContractPeriod(this, 'Corp Web &amp; Micro')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Corp_contract_termination"><select onchange="updatecontractTermination(this, 'Corp Web &amp; Micro')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Corp_turnover" class="turnOver">0</td>
                        <td id="Corp_invoicedate"></td>
                        <td id="Corp_status">
                            <select id="_Corp" onchange="return SaveUpdateRow(this, 'Corp Web &amp; Micro');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Corp_statusdate"></td>
                        <td id="Corp_competitor"></td>
                        <td id="Corp_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Corp Web &amp; Micro')"></textarea></td>
                    </tr>
                    <tr id="Fact">
                        <td>Fact Sheet</td>
                        <td id="Fact_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Fact_contract"></td>
                        <td id="Fact_contractdate"><input type="date" onchange="updateContractStartDate(this,'Fact Sheet')"></td>
                        <td id="Fact_contract_period"><select onchange="updateContractPeriod(this, 'Fact Sheet')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Fact_contract_termination"><select onchange="updatecontractTermination(this, 'Fact Sheet')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Fact_turnover" class="turnOver">0</td>
                        <td id="Fact_invoicedate"></td>
                        <td id="Fact_status">
                            <select id="_Fact" onchange="return SaveUpdateRow(this, 'Fact Sheet');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Fact_statusdate"></td>
                        <td id="Fact_competitor"></td>
                        <td id="Fact_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Fact Sheet')"></textarea></td>
                    </tr>
                    <tr id="Insider">
                        <td>Insider Manager</td>
                        <td id="Insider_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Insider_contract"></td>
                        <td id="Insider_contractdate"><input type="date" onchange="updateContractStartDate(this,'Insider Manager')"></td>
                        <td id="Insider_contract_period"><select onchange="updateContractPeriod(this, 'Insider Manager')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Insider_contract_termination"><select onchange="updatecontractTermination(this, 'Insider Manager')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Insider_turnover" class="turnOver">0</td>
                        <td id="Insider_invoicedate"></td>
                        <td id="Insider_status">
                            <select id="_Insider" onchange="return SaveUpdateRow(this, 'Insider Manager');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Insider_statusdate"></td>
                        <td id="Insider_competitor"></td>
                        <td id="Insider_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Insider Manager')"></textarea></td>
                    </tr>
                    <tr id="IR">
                        <td>IR Website</td>
                        <td id="IR_color"><img src="ss_grey" class="image-class"></td>
                        <td id="IR_contract"></td>
                        <td id="IR_contractdate"><input type="date" onchange="updateContractStartDate(this,'IR Website')"></td>
                        <td id="IR_contract_period"><select onchange="updateContractPeriod(this, 'IR Website')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="IR_contract_termination"><select onchange="updatecontractTermination(this, 'IR Website')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="IR_turnover" class="turnOver">0</td>
                        <td id="IR_invoicedate"></td>
                        <td id="IR_status">
                            <select id="_IR" onchange="return SaveUpdateRow(this, 'IR Website');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="IR_statusdate"></td>
                        <td id="IR_competitor"></td>
                        <td id="IR_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'IR Website')"></textarea></td>
                    </tr>
                    <tr id="LEI">
                        <td>LEI</td>
                        <td id="LEI_color"><img src="ss_grey" class="image-class"></td>
                        <td id="LEI_contract"></td>
                        <td id="LEI_contractdate"><input type="date" onchange="updateContractStartDate(this,'LEI')"></td>
                        <td id="LEI_contract_period"><select onchange="updateContractPeriod(this, 'LEI')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="LEI_contract_termination"><select onchange="updatecontractTermination(this, 'LEI')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="LEI_turnover" class="turnOver">0</td>
                        <td id="LEI_invoicedate"></td>
                        <td id="LEI_status">
                            <select id="_LEI" onchange="return SaveUpdateRow(this, 'LEI');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="LEI_statusdate"></td>
                        <td id="LEI_competitor"></td>
                        <td id="LEI_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'LEI')"></textarea></td>
                    </tr>
                    <tr id="Media">
                        <td>Media Plan</td>
                        <td id="Media_color"> <img src="ss_grey" class="image-class"></td>
                        <td id="Media_contract"></td>
                        <td id="Media_contractdate"><input type="date" onchange="updateContractStartDate(this,'Media Plan')"></td>
                        <td id="Media_contract_period"><select onchange="updateContractPeriod(this, 'Media Plan')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Media_contract_termination"><select onchange="updatecontractTermination(this, 'Media Plan')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Media_turnover" class="turnOver">0</td>
                        <td id="Media_invoicedate"></td>
                        <td id="Media_status">
                            <select id="_Media" onchange="return SaveUpdateRow(this, 'Media Plan');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Media_statusdate"></td>
                        <td id="Media_competitor"></td>
                        <td id="Media_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Media Plan')"></textarea></td>
                    </tr>
                    <tr id="Newsfeed">
                        <td>Newsfeed</td>
                        <td id="Newsfeed_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Newsfeed_contract"></td>
                        <td id="Newsfeed_contractdate"><input type="date" onchange="updateContractStartDate(this,'Newsfeed')"></td>
                        <td id="Newsfeed_contract_period"><select onchange="updateContractPeriod(this, 'Newsfeed')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Newsfeed_contract_termination"><select onchange="updatecontractTermination(this, 'Newsfeed')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Newsfeed_turnover" class="turnOver">0</td>
                        <td id="Newsfeed_invoicedate"></td>
                        <td id="Newsfeed_status">
                            <select id="_Newsfeed" onchange="return SaveUpdateRow(this, 'Newsfeed');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Newsfeed_statusdate"></td>
                        <td id="Newsfeed_competitor"></td>
                        <td id="Newsfeed_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Newsfeed')"></textarea></td>
                    </tr>
                    <tr id="Online">
                        <td>Online Report</td>
                        <td id="Online_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Online_contract"></td>
                        <td id="Online_contractdate"><input type="date" onchange="updateContractStartDate(this,'Online Report')"></td>
                        <td id="Online_contract_period"><select onchange="updateContractPeriod(this, 'Online Report')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Online_contract_termination"><select onchange="updatecontractTermination(this, 'Online Report')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Online_turnover" class="turnOver">0</td>
                        <td id="Online_invoicedate"></td>
                        <td id="Online_status">
                            <select id="_Online" onchange="return SaveUpdateRow(this, 'Online Report');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Online_statusdate"></td>
                        <td id="Online_competitor"></td>
                        <td id="Online_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Online Report')"></textarea></td>
                    </tr>
                    <tr id="Others">
                        <td>Others</td>
                        <td id="Others_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Others_contract"></td>
                        <td id="Others_contractdate"><input type="date" onchange="updateContractStartDate(this,'Others')"></td>
                        <td id="Others_contract_period"><select onchange="updateContractPeriod(this, 'Others')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Others_contract_termination"><select onchange="updatecontractTermination(this, 'Others')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Others_turnover" class="turnOver">0</td>
                        <td id="Others_invoicedate"></td>
                        <td id="Others_status">
                            <select id="_Others" onchange="return SaveUpdateRow(this, 'Others');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Others_statusdate"></td>
                        <td id="Others_competitor"></td>
                        <td id="Others_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Others')"></textarea></td>
                    </tr>
                    <tr id="Portal">
                        <td>Portal Network</td>
                        <td id="Portal_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Portal_contract"></td>
                        <td id="Portal_contractdate"><input type="date" onchange="updateContractStartDate(this,'Portal Network')"></td>
                        <td id="Portal_contract_period"><select onchange="updateContractPeriod(this, 'Portal Network')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Portal_contract_termination"><select onchange="updatecontractTermination(this, 'Portal Network')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Portal_turnover" class="turnOver">0</td>
                        <td id="Portal_invoicedate"></td>
                        <td id="Portal_status">
                            <select id="_Portal" onchange="return SaveUpdateRow(this, 'Portal Network');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Portal_statusdate"></td>
                        <td id="Portal_competitor"></td>
                        <td id="Portal_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Portal Network')"></textarea> </td>
                    </tr>
                    <tr id="Quick">
                        <td>Quick Analyzer</td>
                        <td id="Quick_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Quick_contract"></td>
                        <td id="Quick_contractdate"><input type="date" onchange="updateContractStartDate(this,'Quick Analyzer')"></td>
                        <td id="Quick_contract_period"><select onchange="updateContractPeriod(this, 'Quick Analyzer')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Quick_contract_termination"><select onchange="updatecontractTermination(this, 'Quick Analyzer')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Quick_turnover" class="turnOver">0</td>
                        <td id="Quick_invoicedate"></td>
                        <td id="Quick_status">
                            <select id="_Quick" onchange="return SaveUpdateRow(this, 'Quick Analyzer');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Quick_statusdate"></td>
                        <td id="Quick_competitor"></td>
                        <td id="Quick_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Quick Analyzer')"></textarea></td>
                    </tr>
                    <tr id="Regulatory">
                        <td>Regulatory &amp; News</td>
                        <td id="Regulatory_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Regulatory_contract"></td>
                        <td id="Regulatory_contractdate"><input type="date" onchange="updateContractStartDate(this,'Regulatory &amp; News')"></td>
                        <td id="Regulatory_contract_period"><select onchange="updateContractPeriod(this, 'Regulatory &amp; News')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Regulatory_contract_termination"><select onchange="updatecontractTermination(this, 'Regulatory &amp; News')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Regulatory_turnover" class="turnOver">0</td>
                        <td id="Regulatory_invoicedate"></td>
                        <td id="Regulatory_status">
                            <select id="_Regulatory" onchange="return SaveUpdateRow(this, 'Regulatory &amp; News');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Regulatory_statusdate"></td>
                        <td id="Regulatory_competitor"></td>
                        <td id="Regulatory_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Regulatory &amp; News')"></textarea></td>
                    </tr>
                    <tr id="Telco">
                        <td>Telco</td>
                        <td id="Telco_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Telco_contract"></td>
                        <td id="Telco_contractdate"><input type="date" onchange="updateContractStartDate(this,'Telco')"></td>
                        <td id="Telco_contract_period"><select onchange="updateContractPeriod(this, 'Telco')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Telco_contract_termination"><select onchange="updatecontractTermination(this, 'Telco')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Telco_turnover" class="turnOver">0</td>
                        <td id="Telco_invoicedate"></td>
                        <td id="Telco_status">
                            <select id="_Telco" onchange="return SaveUpdateRow(this, 'Telco');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Telco_statusdate"></td>
                        <td id="Telco_competitor"></td>
                        <td id="Telco_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Telco')"></textarea> </td>
                    </tr>
                    <tr id="Video">
                        <td>Video Webcast</td>
                        <td id="Video_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Video_contract"></td>
                        <td id="Video_contractdate"><input type="date" onchange="updateContractStartDate(this,'Video Webcast')"></td>
                        <td id="Video_contract_period"><select onchange="updateContractPeriod(this, 'Video Webcast')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Video_contract_termination"><select onchange="updatecontractTermination(this, 'Video Webcast')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>

                        <td id="Video_turnover" class="turnOver">0</td>
                        <td id="Video_invoicedate"></td>
                        <td id="Video_status">
                            <select id="_Video" onchange="return SaveUpdateRow(this, 'Video Webcast');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Video_statusdate"></td>
                        <td id="Video_competitor"></td>
                        <td id="Video_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Video Webcast')"></textarea></td>
                    </tr>
                    <tr id="XML">
                        <td>XML Conversion</td>
                        <td id="XML_color"><img src="ss_grey" class="image-class"></td>
                        <td id="XML_contract"></td>
                        <td id="XML_contractdate"><input type="date" onchange="updateContractStartDate(this,'XML Conversion')"></td>
                        <td id="XML_contract_period"><select onchange="updateContractPeriod(this, 'XML Conversion')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="XML_contract_termination"><select onchange="updatecontractTermination(this, 'XML Conversion')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="XML_turnover" class="turnOver">0</td>
                        <td id="XML_invoicedate"></td>
                        <td id="XML_status">
                            <select id="_XML" onchange="return SaveUpdateRow(this, 'XML Conversion');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="XML_statusdate"></td>
                        <td id="XML_competitor"></td>
                        <td id="XML_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'XML Conversion')"></textarea></td>
                    </tr>

                    <!--added by haider shah-->

                    <tr id="Translation">
                        <td>Translation</td>
                        <td id="Translation_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Translation_contract"></td>
                        <td id="Translation_contractdate"><input type="date" onchange="updateContractStartDate(this, 'Translation')"></td>
                        <td id="Translation_contract_period"><select onchange="updateContractPeriod(this, 'Translation')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Translation_contract_termination"><select onchange="updatecontractTermination(this, 'Translation')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="Translation_turnover" class="turnOver">0</td>
                        <td id="Translation_invoicedate"></td>
                        <td id="Translation_status">
                            <select id="_Translation" onchange="return SaveUpdateRow(this, 'Translation');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Translation_statusdate"></td>
                        <td id="Translation_competitor"></td>
                        <td id="Translation_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Translation')"></textarea></td>
                    </tr>

                    <tr id="Integrity">
                        <td>Integrity Line</td>
                        <td id="Integrity_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Integrity_contract"></td>
                        <td id="Integrity_contractdate"><input type="date" onchange="updateContractStartDate(this, 'Integrity Line')"></td>
                        <td id="Integrity_contract_period"><select onchange="updateContractPeriod(this, 'Integrity Line')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Integrity_contract_termination"><select onchange="updatecontractTermination(this, 'Integrity Line')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="Integrity_turnover" class="turnOver">0</td>
                        <td id="Integrity_invoicedate"></td>
                        <td id="Integrity_status">
                            <select id="_Integrity" onchange="return SaveUpdateRow(this, 'Integrity Line');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Integrity_statusdate"></td>
                        <td id="Integrity_competitor"></td>
                        <td id="Integrity_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Integrity Line')"></textarea></td>
                    </tr>
                    <!-- Added by Bilal -->
                    <tr id="Policy">
                        <td>Policy Manager</td>
                        <td id="Policy_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Policy_contract"></td>
                        <td id="Policy_contractdate"><input type="date" onchange="updateContractStartDate(this, 'Policy Channel')"></td>
                        <td id="Policy_contract_period"><select onchange="updateContractPeriod(this, 'Policy Channel')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Policy_contract_termination"><select onchange="updatecontractTermination(this, 'Policy Channel')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="Policy_turnover" class="turnOver">0</td>
                        <td id="Policy_invoicedate"></td>
                        <td id="Policy_status">
                            <select id="_Policy" onchange="return SaveUpdateRow(this, 'Policy Channel');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Policy_statusdate"></td>
                        <td id="Policy_competitor"></td>
                        <td id="Policy_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Policy Channel')"></textarea></td>
                    </tr>
                    <!-- SS_Jawad Changes -->
                    <tr id="k3">
                        <td>K3 K4 Meldung</td>
                        <td id="k3_color"><img src="ss_grey" class="image-class"></td>
                        <td id="k3_contract"></td>
                        <td id="k3_contractdate"><input type="date" onchange="updateContractStartDate(this, 'k3 k4')"></td>
                        <td id="k3_contract_period"><select onchange="updateContractPeriod(this, 'k3 k4')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="k3_contract_termination"><select onchange="updatecontractTermination(this, 'k3 k4')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="k3_turnover" class="turnOver">0</td>
                        <td id="k3_invoicedate"></td>
                        <td id="k3_status">
                            <select id="_k3" onchange="return SaveUpdateRow(this, 'k3 k4 Meldung');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="k3_statusdate"></td>
                        <td id="k3_competitor"></td>
                        <td id="k3_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'k3 k4')"></textarea></td>
                    </tr>
                    <!-- End ss_Jawad Changes -->
                    <!-- Added by Bilal -->
                    <!-- EQS IR Cockpit -->
                    <tr id="EQS">
                        <td>EQS IR Cockpit</td>
                        <td id="EQS_color"><img src="ss_grey" class="image-class"></td>
                        <td id="EQS_contract"></td>
                        <td id="EQS_contractdate"><input type="date" onchange="updateContractStartDate(this, 'EQS IR Cockpit')"></td>
                        <td id="k3_contract_period"><select onchange="updateContractPeriod(this, 'EQS IR Cockpit')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="EQS_contract_termination"><select onchange="updatecontractTermination(this, 'EQS IR Cockpit')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="EQS_turnover" class="turnOver">0</td>
                        <td id="EQS_invoicedate"></td>
                        <td id="EQS_status">
                            <select id="_EQS" onchange="return SaveUpdateRow(this, 'EQS IR Cockpit');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="EQS_statusdate"></td>
                        <td id="EQS_competitor"></td>
                        <td id="EQS_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'EQS IR Cockpit')"></textarea></td>
                    </tr>
                    <tr id="ESEF">
                        <td>ESEF</td>
                        <td id="ESEF_color"><img src="ss_grey" class="image-class"></td>
                        <td id="ESEF_contract"></td>
                        <td id="ESEF_contractdate"><input type="date" onchange="updateContractStartDate(this, 'ESEF')"></td>
                        <td id="ESEF_contract_period"><select onchange="updateContractPeriod(this, 'ESEF')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="ESEF_contract_termination"><select onchange="updatecontractTermination(this, 'ESEF')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="ESEF_turnover" class="turnOver">0</td>
                        <td id="ESEF_invoicedate"></td>
                        <td id="ESEF_status">
                            <select id="_ESEF" onchange="return SaveUpdateRow(this, 'ESEF');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="ESEF_statusdate"></td>
                        <td id="ESEF_competitor"></td>
                        <td id="ESEF_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'ESEF')"></textarea></td>
                    </tr>
                    <tr id="Approval">
                        <td>Approval Manager</td>
                        <td id="Approval_color"><img src="ss_grey" class="image-class"></td>
                        <td id="Approval_contract"></td>
                        <td id="Approval_contractdate"><input type="date" onchange="updateContractStartDate(this, 'Approval')"></td>
                        <td id="Approval_contract_period"><select onchange="updateContractPeriod(this, 'Approval')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="Approval_contract_termination"><select onchange="updatecontractTermination(this, 'Approval')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="Approval_turnover" class="turnOver">0</td>
                        <td id="Approvalinvoicedate"></td>
                        <td id="Approval_status">
                            <select id="_Approval" onchange="return SaveUpdateRow(this, 'Approval');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="Approval_statusdate"></td>
                        <td id="Approval_competitor"></td>
                        <td id="Approval_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'Approval')"></textarea></td>
                    </tr>
                    <tr id="C2S2">
                        <td>Approval Manager</td>
                        <td id="C2S2_color"><img src="ss_grey" class="image-class"></td>
                        <td id="C2S2_contract"></td>
                        <td id="C2S2_contractdate"><input type="date" onchange="updateContractStartDate(this, 'C2S2')"></td>
                        <td id="C2S2_contract_period"><select onchange="updateContractPeriod(this, 'C2S2')"><option value="0">None</option><option value="1">12</option><option value="2">18</option><option value="3">24</option><option value="4">36</option></select></td>
                        <td id="C2S2_contract_termination"><select onchange="updatecontractTermination(this, 'C2S2')"><option value="0">None</option><option value="1">1 months</option><option value="2">3 months</option></select></td>
                        <td id="C2S2_turnover" class="turnOver">0</td>
                        <td id="C2S2invoicedate"></td>
                        <td id="C2S2_status">
                            <select id="_C2S2" onchange="return SaveUpdateRow(this, 'C2S2');">
                                <option value="0">None</option>
                                <option value="1">competitor</option>
                                <option value="2">not interested</option>
                                <option value="3">In contact</option>
                                <option value="4">Cancelled</option>
                                <option value="5">Opportunity</option>
                            </select>
                        </td>
                        <td id="C2S2_statusdate"></td>
                        <td id="C2S2_competitor"></td>
                        <td id="C2S2_comments"><textarea rows="3" cols="30" onchange="updateComments(this, 'C2S2')"></textarea></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    var globelcontext = parent.Xrm.Utility.getGlobalContext();
    var _Accountid = "";//"5A8F8B46-2443-E511-80E3-3863BB351E10";   //Daimler AG   5A8F8B46-2443-E511-80E3-3863BB351E10
    var page = 1;   //for invoice fetch
    var pagingcookie = "";  //for invoice fetch
    var segment = "";
    var currencySymbol = "";
    var currencySymbolId = "";
    var NumberSeparator = "";
    var DecimalSymbol = "";
    var rowId = "";
    var entityname = "";
    var checkproduct = false;
    var prodName = "";
    var statuscode = "";
    var statecode = "";
    function Onload() {
        if (location.search !== "") {
            vals = location.search.substr(1).split("&");
            for (var i in vals) {
                vals[i] = vals[i].replace(/\+/g, " ").split("=");
            }

            var found = false;
            for (var i in vals) {
                if (vals[i][0].toLowerCase() === "data") {
                    parseDataValue(vals[i][1]);
                    found = true;
                    break;
                }
            }
        }
        getFormType();
    }
    function getFormType() {
        var formLabel = "";
        if (parent.Xrm.Page.data != null)
        {
             entityname = parent.Xrm.Page.data.entity.getEntityName()
        }
        
        if (entityname !== "ss_visitreport") {
            if (rowId === "") {
                var formtype = opener.Xrm.Page.ui.getFormType();
                formLabel = opener.Xrm.Page.ui.formSelector.getCurrentItem().getLabel();
            }
            else {
                var formtype = opener.parent.Xrm.Page.ui.getFormType();
                formLabel = opener.parent.Xrm.Page.ui.formSelector.getCurrentItem().getLabel();
            }
        }
        if (entityname === "") {
            if (formtype === 1) {
                alert("Kindly create the record first.");
                window.close();
                return;
            }
        }
        try {
            
            if (formLabel === "EQS - IR DE") {
                //$("#LEI").css('visibility', 'hidden');
             //   $("#LEI").hide();
                //     $("#whitediv").hide();
              
                $("#Media").hide();
                $("#Others").hide();
                //   $(".column-1").css("width", "11%");

            }
            if (formLabel === "EQS - XML") {

                $("#Media").hide();
                $("#Others").hide();
                //   $(".column-1").css("width", "11%");


            }
            if (entityname === "") {
               
                if (rowId === "") {
                    _Accountid = opener.Xrm.Page.data.entity.getId().replace("{", "").replace("}", "");
                }
                else {
                    _Accountid = opener.parent.Xrm.Page.data.entity.getId().replace("{", "").replace("}", "");
                }
               
            }
            else
            {
               
                if (parent.Xrm.Page.data.entity.attributes.get("ss_accountid").getValue() != null)
                    _Accountid = parent.Xrm.Page.data.entity.attributes.get("ss_accountid").getValue()[0].id.replace("{", "").replace("}", "");;

               
            }
        } catch (e) {
            alert("Unable to read Accountid");
            window.close();
            return;
        }
        showLoadingMessage();
        //retrieveGroupStatus();
        checkoppproductsinside();
    }
    function parseDataValue(datavalue) {
        if (datavalue !== "") {
            var vals = new Array();
            vals = decodeURIComponent(datavalue).split("&");
            for (var i in vals) {
                vals[i] = vals[i].replace(/\+/g, " ").split("=");
            }
        }
        var arrayofValues = vals[0];
        arrayofValues = arrayofValues[0].split(",");

        rowId = arrayofValues[0];
        rowId = rowId.replace('"', '');
        rowId = rowId.replace('"', '');
        rowId = rowId;

        var trs = $("#ProductsTable").find("tbody>tr");
        for (var i = 0; i < trs.length; i++) {
            var id = trs[i].id;
            if (id !== rowId) {
                id = "#" + id;
                $(id).hide();
            }
        }
    }
    function checkoppproductsinside()
    {
        var fetchData = {
            accountid: _Accountid
        };
                        var fetchXml = [
                    "<fetch top='50'>",
                    "  <entity name='account'>",
                    "    <link-entity name='opportunity' from='parentaccountid' to='accountid' alias='opp'>",
                    "      <attribute name='name' />",
                    "      <attribute name='statuscode' />",
                    "      <attribute name='statecode' />",
                    "      <filter>",
                    "        <condition attribute='accountid' operator='eq' value='", fetchData.accountid,"'/>",
                    "      </filter>",
                    "      <link-entity name='opportunityproduct' from='opportunityid' to='opportunityid'       alias='accopp'>",
                    "        <attribute name='productname' />",
                    "        <link-entity name='product' from='productid' to='productid'>",
                    "          <attribute name='ss_crmproductgroupsname' />",
                    "          <attribute name='ss_crmproductgroups' />",
                    "        </link-entity>",
                    "      </link-entity>",
                    "    </link-entity>",
                    "  </entity>",
                    "</fetch>",
                        ].join("");
                    var statecode = "";
                    fetchXml = "?fetchXml=" + encodeURIComponent(fetchXml);
                    debugger;
                    window.opener.Xrm.WebApi.online.retrieveMultipleRecords("account", fetchXml).then(
                    function success(result)
			        {
                        console.log("Result is => " + result);
                        console.log("Response is = >" + result.response);
                        if(result.entities.length > 0)
				        {
                            for(var a = 0; a < result.entities.length; a++)
                            {
                                prodName += result.entities[a]["accopp.productname"] + ",";
                            }
                            console.log(`Product Names are ${prodName} `);
                            var statecode=result.entities[0]["opp.statecode"];
                            statuscode = result.entities[0]["opp.statuscode"];
                        }
                        if(prodName !="" && prodName!=null)
                        {
                            checkproduct = true;
                        }
                        changecolors(checkproduct, statuscode, statecode, prodName, result);
                        //FindInvoicesandContracts();
                   },
                    function(error)
				{
					console.log("Error is => " + console.error);
				}
			)
    }
    function changecolors(checkproduct, statuscode, statecode, prodName, result)
    {
        for(i = 0; i < result.entities.length; i++){
                var groupname = "";
                                groupname = result.entities[i]["product3.ss_crmproductgroups@OData.Community.Display.V1.FormattedValue"];
                                var statuscodename = result.entities[i]["opp.statuscode@OData.Community.Display.V1.FormattedValue"];
                                console.log(`Status Code Name is ${statuscodename}`);
                                var str = groupname.split(' ');
                                var id = "#" + str[0] + "_color";
                                var id2 = "_" + str[0];
                                console.log(`Dropdown ID is ${id2}`);
                                //for production
                                if (statuscode === 717800010 && checkproduct ){
                                    //for test2
                                //if (statuscode === 717800005 && checkproduct ) {
                                    $(id).html('<img src="ss_orange" class="image-class" />');
                                    $("#" + id2).append("<option value="+statuscode+">"+statuscodename+"</option>");
                                    $("#" + id2 + " > [value=" + statuscode + "]").attr("selected", "true");
                                    $("#" + id2).attr("disabled", true); 
                                }
                                //for production
                                else if(statecode === 2 && statuscode != 717800010 && checkproduct){
                                    //for test2
                                //else if(statecode === 2 && statuscode != 717800005 && checkproduct){
                                    //$(id).css('background', '#FF4B4B'); //#e6513e
                                    $(id).html('<img src="ss_red_Icon" class="image-class" />');
                                    $("#" + id2).append("<option value="+statuscode+">"+statuscodename+"</option>");
                                    $("#" + id2 + " > [value=" + statuscode + "]").attr("selected", "true");
                                    $("#" + id2).attr("disabled", true); 
                                }
                                else if (checkproduct) 
                                {
                                    $(id).html('<img src="ss_blue" class="image-class" />');
                                    $("#" + id2).append("<option value="+statuscode+">"+statuscodename+"</option>");
                                    $("#" + id2 + " > [value=" + statuscode + "]").attr("selected", "true");
                                    $("#" + id2).attr("disabled", true); 
                                }
                                else
                                {
                                    //$(id).css('background', '#d8d4d4');
                                    $(id).html('<img src="ss_green_Icon" class="image-class" />');
                                    $("#" + id2).attr("disabled", true); 
                                }
                            }
                            
            FindInvoicesandContracts();
    }
    function FindInvoicesandContracts() // My Account
    {
        var today = new Date();
        var formatedold = today.setMonth(today.getMonth() - 12);
        var pDate = new Date(formatedold);
        var currentYearFormated = new Date();

        var LatestDate = pDate.getMonth()+1 + "/" + pDate.getDate() + "/" + pDate.getFullYear();    // +1 on month
        //  var newDay = LatestDate.getDate();
        // var CurrentYear = "01" + "/" + "01" + "/" + LatestDate.getFullYear();

        // var Year = LatestDate.getFullYear() - 1;
        // LatestDate = "01" + "/" + "01" + "/" + Year;
        // var pDate = new Date(LatestDate);


        var FetchInvoices = '<fetch page="' + page + '"  mapping="logical">' +
                              '<entity name="invoicedetail" >' +
                                '<attribute name="productid" />' +
                                '<attribute name="baseamount" />' +
                                '<filter>' +
                                  '<condition attribute="productid" operator="not-null" />' +
                                '</filter>' +
                                '<link-entity name="invoice" from="invoiceid" to="invoiceid" link-type="inner" alias="invoice" >' +
                                  '<attribute name="accountid" />' +
                                  '<attribute name="name" />' +
                                  '<attribute name="ss_postingdate" />' +
                                     '<filter type="and"><condition attribute="ss_postingdate" operator="on-or-after" value="' + LatestDate + '" />' +
                                     '<filter type="or" >' +
                                    '<condition attribute="accountid" operator="eq" value="' + _Accountid + '" />' +
                                    '<condition attribute="customerid" operator="eq" value="' + _Accountid + '" />' +
                                  '</filter></filter>' +
                                '</link-entity>' +
                                  '<link-entity name="contract" from="contractid" to="ss_contractnolookup" link-type="outer" alias="contract" >' +
                                  '<attribute name="activeon" />' +
                                  '<attribute name="expireson" />' +
                                  '<attribute name="title" />' +
                                '</link-entity>' +
                                '<order attribute="productid" />' +
                                '<link-entity name="product" from="productid" to="productid" link-type="inner" >' +
                                    '<attribute name="ss_crmproductgroupsname" />' +
                                    '<attribute name="ss_crmproductgroups" />' +
                                    '<attribute name="productnumber" />' +
                              //     '<filter type="and" >        <condition attribute="ss_crmproductgroups" operator="eq" value="14" />      </filter>' +

                                 '</link-entity>' +
                              '</entity>' +
                            '</fetch>';
        var req = new XMLHttpRequest();
        if (entityname === "") {
            req.open("GET", opener.Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.0/invoicedetails?fetchXml=" + encodeURI(FetchInvoices), true);
        }
        else
        {
            req.open("GET", globelcontext.getClientUrl() + "/api/data/v8.0/invoicedetails?fetchXml=" + encodeURI(FetchInvoices), true);
        }
        req.setRequestHeader("OData-MaxVersion", "4.0");
        req.setRequestHeader("OData-Version", "4.0");
        req.setRequestHeader("Accept", "application/json");
        req.setRequestHeader("Prefer", "odata.include-annotations=\"OData.Community.Display.V1.FormattedValue\"");
        req.onreadystatechange = function () {
            if (this.readyState === 4) {
                if (this.status === 200) {
                    var results = JSON.parse(this.response);
                    var morerecords = false;
                    if (results.value['@Microsoft.Dynamics.CRM.fetchxmlpagingcookie']) {
                        morerecords = true;
                    }
                    var PreviousProductID = "empty";
                    var PreviousInvoicePostingDate = "01-01-1911";
                    var CRMProductName = "";
                    var preCRMProductName = "";
                    var preAmount = 0;
                    var PreviousContractFrom = "";
                    var PreviousContractTo = "";
                    for (var x = 0; x < results.value.length; x++) {
                        var ProductID = "";
                        var ContractFrom = "";
                        var ContractTo = "";
                        var InvoicePostingDate = "";
                        var baseAmount = 0;
                        if (results.value[x]['contract_x002e_activeon']) {
                            ContractFrom = results.value[x]['contract_x002e_activeon']
                        }
                        if (results.value[x]['contract_x002e_expireson']) {
                            ContractTo = results.value[x]['contract_x002e_expireson']
                        }
                        if (results.value[x]['invoice_x002e_ss_postingdate@OData.Community.Display.V1.FormattedValue']) {
                            InvoicePostingDate = results.value[x]['invoice_x002e_ss_postingdate']
                        }
                        if (currencySymbolId === "") {
                            if (results.value[x]['_transactioncurrencyid_value']) {
                                currencySymbolId = results.value[x]['_transactioncurrencyid_value'];
                            }
                        }
                        if (results.value[x]['product3_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue']) {
                            CRMProductName = results.value[x]['product3_x002e_ss_crmproductgroups@OData.Community.Display.V1.FormattedValue'];
                        }
                        if (results.value[x]['_productid_value']) {
                            ProductID = results.value[x]['_productid_value']
                        }
                        if (results.value[x]['baseamount']) {
                            baseAmount = results.value[x]['baseamount'];
                        }
                        if (ProductID === PreviousProductID) //old products reoccuring
                        {
                            var prevPostingDate = new Date(PreviousInvoicePostingDate).toUTCString();
                            prevPostingDate = new Date(prevPostingDate);
                            var NewPostingDate = new Date(InvoicePostingDate).toUTCString();
                            NewPostingDate = new Date(NewPostingDate);
                            if (prevPostingDate < NewPostingDate) {
                                PreviousInvoicePostingDate = InvoicePostingDate;
                            }

                            if (PreviousContractFrom === "" && PreviousContractTo === "")     //no contract in previous product
                            {
                                PreviousContractFrom = ContractFrom;
                                PreviousContractTo = ContractTo;
                            }
                            else {
                                var prevContTo = new Date(PreviousContractTo).toUTCString();
                                prevContTo = new Date(prevContTo);
                                var NewContTo = new Date(ContractTo).toUTCString();
                                NewContTo = new Date(NewContTo);
                                if (NewContTo > prevContTo) {
                                    PreviousContractTo = NewContTo;
                                }
                            }
                            if (InvoicePostingDate !== "") {
                                var NewPostingDate = new Date(InvoicePostingDate);
                                NewPostingDate = new Date(NewPostingDate);
                                if (NewPostingDate !== "" && NewPostingDate < currentYearFormated && NewPostingDate > pDate) //invoice exists within 12 months
                                {
                                    // //alert(baseAmount + " " + NewPostingDate + " " + currentYearFormated +  "  " + pDate);

                                    var newAmount = Number(preAmount) + Number(baseAmount);
                                    preAmount = newAmount;
                                }
                            }
                            //else let the previous one remain
                        } else  //new
                        {
                            if (PreviousProductID !== "empty")   //for first
                            {
                                //Turn the Light ON!

                                updateFields(preCRMProductName, PreviousInvoicePostingDate, preAmount, PreviousContractTo);
                            }

                            PreviousProductID = ProductID;
                            PreviousInvoicePostingDate = InvoicePostingDate;
                            preCRMProductName = CRMProductName
                            if (InvoicePostingDate !== "") {
                                var NewPostingDate = new Date(InvoicePostingDate);
                                NewPostingDate = new Date(NewPostingDate);
                                if (NewPostingDate !== "" && NewPostingDate < currentYearFormated && NewPostingDate > pDate) //invoice exists within 12 months
                                {
                                    preAmount = baseAmount;
                                }
                                else
                                    preAmount = 0;
                            }
                            else
                                preAmount = 0;
                            PreviousContractTo = ContractTo;
                        }
                        if (x === results.value.length - 1) {
                            updateFields(preCRMProductName, PreviousInvoicePostingDate, preAmount, PreviousContractTo);
                        }
                    }

                    if (morerecords === true) {
                        pagingcookie = results.value['@Microsoft.Dynamics.CRM.fetchxmlpagingcookie'];
                        pagingcookie = pagingcookie.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\"/g, "&quot;").replace(/\'/g, '&quot;').replace(/&amp;/g, "&amp;amp;");
                        page++;
                        FindInvoicesandContracts();
                    } else {
                        addcurrencySymbol();
                        hideLoadingMessage();
                    }
                }
                else {
                    //alert(this.statusText);
                    hideLoadingMessage();
                }
            }
        };
        req.send();
    }
    function retrieveGroupStatus() {
        var req = new XMLHttpRequest();
        if (entityname === "") {
            req.open("GET", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras?$select=modifiedon,ss_comments,_ss_accountcontractextra_value,ss_accountcontractextraid,ss_competitor,ss_contractperiod,ss_terminationperiod,ss_productstatusdate,ss_contractstartingdate,ss_name,ss_productstatus&$filter=_ss_accountcontractextra_value eq " + _Accountid, true);
        }
        else
        {
            req.open("GET", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras?$select=modifiedon,ss_comments,_ss_accountcontractextra_value,ss_accountcontractextraid,ss_competitor,ss_contractperiod,ss_terminationperiod,ss_productstatusdate,ss_contractstartingdate,ss_name,ss_productstatus&$filter=_ss_accountcontractextra_value eq " + _Accountid, true);

        }
        req.setRequestHeader("OData-MaxVersion", "4.0");
        req.setRequestHeader("OData-Version", "4.0");
        req.setRequestHeader("Accept", "application/json");
        req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
        req.onreadystatechange = function () {
            if (this.readyState === 4) {
                req.onreadystatechange = null;
                if (this.status === 200) {
                    var results = JSON.parse(this.response);
                    for (var i = 0; i < results.value.length; i++) {
                        var ss_competitor = results.value[i]["ss_competitor"];
                        var ss_name = results.value[i]["ss_name"];//TODO: use this name
                        var str = ss_name.split(" ");
                        var ss_productstatus = results.value[i]["ss_productstatus"];
                        var modifiedon = results.value[i]["modifiedon@OData.Community.Display.V1.FormattedValue"];
                        var statusmodifedon = "";
                        if (results.value[i]["modifiedon@OData.Community.Display.V1.FormattedValue"]) {
                            statusmodifedon = results.value[i]["modifiedon@OData.Community.Display.V1.FormattedValue"];
                        }
                        var ss_accountcontractextraid = results.value[i]["ss_accountcontractextraid"];
                        if (results.value[i]["ss_terminationperiod"])
                            var terminationDate = results.value[i]["ss_terminationperiod"];
                        else
                            var terminationDate = ""
                        if (results.value[i]["ss_contractperiod"])
                            var ContractPeriod = results.value[i]["ss_contractperiod"];
                        else
                            var ContractPeriod = ""
                        if (results.value[i]["ss_contractstartingdate"])
                            var ContractStartingDate = results.value[i]["ss_contractstartingdate"];
                        else
                            var ContractStartingDate = ""

                        if (terminationDate !== "") {
                            var termId = "#" + str[0] + "_contract_termination";
                            termId = termId + " select";
                            $(termId).val(terminationDate);
                        }
                        if (ContractPeriod !== "") {
                            var per = "#" + str[0] + "_contract_period";
                            per = per + " select";
                            $(per).val(ContractPeriod);
                        }
                        if (ContractStartingDate !== "") {
                            var contractd = "#" + str[0] + "_contractdate";
                            contractd = contractd + " input";

                            var contDate = new Date(ContractStartingDate);
                            var month = Number(contDate.getMonth() + 1);
                            contDate = contDate.getFullYear() + "-" + ("0" + month).slice(-2) + "-" + ("0" + contDate.getDate()).slice(-2);
                            $(contractd).val(contDate);
                        }
                        var id = "#" + str[0] + "_status"; //_statusdate //_competitor
                        var status = $(id).html();
                        var commentsId = "#" + str[0] + "_comments"
                        commentsId = commentsId + " textarea"
                        if (results.value[i]["ss_comments"]) {
                            var comments = results.value[i]["ss_comments"];
                            $(commentsId).val(comments);
                        }
                        if (status !== "" && status !== undefined) {
                            var statusDate = "#" + str[0] + "_statusdate";
                            var competitoroption = "#" + str[0] + "_competitor";
                            var selectOp = id + " select"
                            $(selectOp).val(ss_productstatus);
                            if (statusmodifedon !== "") {
                                var statusmodifedon = statusmodifedon.split(" ")
                                //statusmodifedon = statusmodifedon[0];

                                //statusmodifedon = new Date(statusmodifedon[0]);
                                //   statusmodifedon = statusmodifedon.getDate() + "." + Number(statusmodifedon.getMonth() + 1) + "." + statusmodifedon.getFullYear();
                                $(statusDate).html(statusmodifedon[0]);
                            }
                            //check if selected option is competitor.
                            if (ss_productstatus === 1) {
                                //set different competitors on the basis of prodcut group.
                                setCompetitors(str[0], ss_competitor, ss_accountcontractextraid);
                                var colorid = "#" + str[0] + "_color";
                                $(colorid).html('<img src="ss_orange" class="image-class" />');
                            }
                            //if (ss_productstatus === 1) {
                            //    var optionsetId = str[0] + "_" + ss_accountcontractextraid;
                            //    var selectedOptionVal = "";
                            //    if (ss_competitor === 1) {
                            //        selectedOptionVal = '<option value="0" >None</option><option value="1" selected ="selected">Nasdaq</option>' +
                            //      '<option value="2">Pressetext</option>' +
                            //      '<option value="3" >Investis</option>' +
                            //      '<option value="4">IR Asia</option>';
                            //    }
                            //    else if (ss_competitor === 2) {
                            //        selectedOptionVal = '<option value="0" >None</option><option value="1" >Nasdaq</option>' +
                            //      '<option value="2" selected ="selected">Pressetext</option>' +
                            //      '<option value="3" >Investis</option>' +
                            //      '<option value="4">IR Asia</option>';
                            //    }
                            //    else if (ss_competitor === 3) {
                            //        selectedOptionVal = '<option value="0" >None</option><option value="1" >Nasdaq</option>' +
                            //      '<option value="2" >Pressetext</option>' +
                            //      '<option value="3" selected ="selected" >Investis</option>' +
                            //      '<option value="4">IR Asia</option>';
                            //    }
                            //    else if (ss_competitor === 4) {
                            //        selectedOptionVal = '<option value="0" >None</option><option value="1" >Nasdaq</option>' +
                            //      '<option value="2" >Pressetext</option>' +
                            //      '<option value="3"  >Investis</option>' +
                            //      '<option value="4" selected ="selected">IR Asia</option>';
                            //    }
                            //    else {
                            //        selectedOptionVal = '<option value="0" >None</option><option value="1" >Nasdaq</option>' +
                            //    '<option value="2" >Pressetext</option>' +
                            //    '<option value="3"  >Investis</option>' +
                            //    '<option value="4">IR Asia</option>';
                            //    }
                            //    var competator = '<select id="' + optionsetId + '" onchange="return updateCompetitors(this);">' + selectedOptionVal + '</select>';
                            //    var competitorId = "#" + str[0] + "_competitor";
                            //    $(competitorId).html(competator);

                            //}
                        }

                        if (ss_productstatus === 3) {

                            var colorid = "#" + str[0] + "_color";
                            $(colorid).html('<img src="ss_yellow" class="image-class" />');
                        }
                        if (ss_productstatus === 5) {

                            var colorid = "#" + str[0] + "_color";
                            $(colorid).html('<img src="ss_blue" class="image-class" />');
                        }
                        if (ss_productstatus === 2 || ss_productstatus === 4) {
                            var colorid = "#" + str[0] + "_color";

                            $(colorid).html('<img src="ss_red_Icon" class="image-class" />');
                        }
                        //debugger;
                        if (results.value[i]["ss_contractstartingdate"] != null && results.value[i]["ss_contractstartingdate"] !== "") {
                            var id = "#" + str[0] + "_status"; //_statusdate //_competitor//ToDo....
                            var competitoroption = "#" + str[0] + "_competitor";
                            var colorid = "#" + str[0] + "_color";
                            $(colorid).html('<img src="ss_green_Icon" class="image-class" />');
                            $(id).html('');
                            $(competitoroption).html('');

                        }
                    }
                    FindInvoicesandContracts();

                } else {
                    if (entityname === "") {
                        // opener.Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                    else {
                    //    parent.Xrm.Utility.alertDialog(this.statusText);
                       var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                }
            }
        };
        req.send();
    }
    function setCompetitors(name, selectedVal, ss_accountcontractextraid) {
        var optionsetId = name + "_" + ss_accountcontractextraid;
        var selectedOptionVal = "";
        //Regulatory & News, Newsfeed
        if (name === "Regulatory" || name === "Newsfeed") {
            selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="2" >Pressetext</option>' +
                                '<option value="5">euro adhoc (APA)</option>' +
                                '<option value="1" >Nasdaq</option>' +
                                '<option value="6">Ipero</option>' +
                                '<option value="7" >Business Wire</option>' +
                                '<option value="8" >PR Newswire</option>' +
                                '<option value="9" >Others</option>';
        }
            //Charts, Invest Calc., App, IR Website, Portal Network, Quick Analyzer
        else if (name === "Charts" || name === "App" || name === "IR" || name === "Portal" || name === "Quick") {
            selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="3" >Investis</option>' +
                                '<option value="10">Euroland </option>' +
                                '<option value="11" >Q4</option>' +

                                '<option value="9" >Others</option>';
        }
            //Audio/Video Webcasts & Telco
        else if (name === "Audio" || name === "Telco" || name === "Video") {
            selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="1" >Nasdaq</option>' +
                                '<option value="12">Arkadin </option>' +
                                '<option value="13" >Meetyou</option>' +
                                '<option value="14" >Chorus Call</option>' +
                                '<option value="15" >World Television (VWC)</option>' +
                                '<option value="16" >Quadia (VWC)</option>' +
                                '<option value="17" >Telekom</option>' +
                                '<option value="9" >Others</option>';
        }

            //Online Report:
        else if (name === "Online") {
            selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="21" >nexxar</option>' +
                                '<option value="9" >Others</option>';
        }
            //Contact Manager
        else if (name === "Contact") {
            selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="18" >convento</option>' +
                                '<option value="19">Tensid (marCo.ch) </option>' +
                                '<option value="20" >Inhouse CRM</option>' +

                                '<option value="9" >Others</option>';
        }
            //EQS IR Cockpit
        else if (name === "EQS") {
            selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="18" >convento</option>' +
                                '<option value="19">Tensid (marCo.ch) </option>' +
                                '<option value="20" >Inhouse CRM</option>' +

                                '<option value="9" >Others</option>';
        }
            //INSIDER MANAGER
        else if (name === "Insider") {
            selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="22" >Altaris</option>' +
                                '<option value="23">InsiderLog </option>' +
                                '<option value="24" >Stitch</option>' +
                                '<option value="25" >Cytek</option>' +
                                '<option value="26" >Intapp</option>' +
                                '<option value="27" >Altares</option>' +
                                '<option value="28" >Blue Print One World</option>' +
                                '<option value="29" >Computershare</option>' +
                                '<option value="30" >Spafid</option>' +
                                '<option value="31" >Howells</option>' +
                                '<option value="9" >Others</option>';

        }
         else if (name === "LEI") 
         {
           selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="1" >Nasdaq</option>' +
                                '<option value="2" >Pressetext</option>' +
                                '<option value="3" >Investis</option>' +
                                '<option value="4">IR Asia</option>'+
                                '<option value="32">GMEI</option>'+
                                '<option value="33">WM Daten</option>'+
                                '<option value="34">Unione Italiana</option>'+
                                '<option value="35">LSE</option>'+
                                '<option value="36">INSEE</option>'+
                                '<option value="37">Registro Espana</option>'+
                                '<option value="38">KvK</option>'+
                                '<option value="39">CSD Prague</option>'+
                                '<option value="40">KDPW</option>'+
                                '<option value="41">JPX</option>'+
                                '<option value="42">ISE</option>'+
                                '<option value="43">PRH</option>'+
                                '<option value="44">LuxCSD</option>'+
                                '<option value="45">Bundesanzeiger</option>'+
                                '<option value="46">NSD Russia</option>'+
                                '<option value="47">Bronnoysund</option>'+
                                '<option value="48">CDCP</option>'+
                                '<option value="49">ZSE</option>'+
                                '<option value="50">China Financial</option>'+
                                '<option value="51">Central Sec Nigeroa</option>'+
                                '<option value="52">Bank of Argetina</option>'+
                                '<option value="53">Takasbank</option>'+
                                '<option value="54">CCCC Slovenia</option>'+
                                '<option value="55">APIR</option>'+
                                '<option value="56">KSD</option>'+
                                '<option value="57">Saudi Arabia Credit</option>'+
                                '<option value="58">Strate</option>'+
                                '<option value="59">LEI India</option>'+
                                '<option value="60">CDS Mauritius</option>'+
                                '<option value="61">Asociacion Mexicana</option>'+
                                '<option value="62">Kamer van Koophandel</option>'+
                                '<option value="63">Bloomberg</option>'+
                                '<option value="64">GS1</option>'+
                                '<option value="65">Agency of Slovenia</option>';
         
         }
         else if (name === "Integrity")
         {
            selectedOptionVal = '<option value="66">BKMS</option>' +
                                '<option value="67">Integrity Line</option>' +
                                '<option value="68">GotEthics</option>' +
                                '<option value="69">SecuReveal</option>' +
                                '<option value="70">safecall</option>' +
                                '<option value="9" >Others</option>';
        }
         else if (name === "Policy")
         {
            selectedOptionVal = '<option value="66">BKMS</option>' +
                                '<option value="67">Integrity Line</option>' +
                                '<option value="68">GotEthics</option>' +
                                '<option value="69">SecuReveal</option>' +
                                '<option value="70">safecall</option>' +
                                '<option value="9" >Others</option>';
        }
        
         else if (name === "k3")
         {
            selectedOptionVal = '<option value="66">BKMS</option>' +
                                '<option value="67">Integrity Line</option>' +
                                '<option value="68">GotEthics</option>' +
                                '<option value="69">SecuReveal</option>' +
                                '<option value="70">safecall</option>' +
                                '<option value="9" >Others</option>';
        }
        
        
        
            // Corp Web & Micro, Fact Sheet,Media Plan,Translation, Others, XML Conversion.
        else {
            selectedOptionVal = '<option value="0" >None</option>' +
                                '<option value="1" >Nasdaq</option>' +
                                '<option value="2" >Pressetext</option>' +
                                '<option value="3" >Investis</option>' +
                                '<option value="4">IR Asia</option>';
        }

        var competator = '<select id="' + optionsetId + '" onchange="return updateCompetitors(this);">' + selectedOptionVal + '</select>';
        var competitorId = "#" + name + "_competitor";
        $(competitorId).html(competator);
        $('#' + optionsetId).val(selectedVal).attr("selected", true);
    }
    function updateFields(crmgroupname, PreviousInvoicePostingDate, totalAmount, PreviousContractTo) {
        var str = crmgroupname.split(" ");
        var res = str[0] + "_color";
        var contractexpiry = "";
        var element_colour = document.getElementById(res);
        var LatestDate = new Date();
        var CurrentYear = "01" + "/" + "01" + "/" + LatestDate.getFullYear();
        var Year = LatestDate.getFullYear() - 1;

        LatestDate = "01" + "/" + "01" + "/" + Year;
        var UTCPreviousInvoicePostingDate = "";
        if (PreviousContractTo !== "")
            contractexpiry = PreviousContractTo;

        if (PreviousInvoicePostingDate !== "") {
            UTCPreviousInvoicePostingDate = new Date(PreviousInvoicePostingDate);  //.toUTCString()
            UTCPreviousInvoicePostingDate = new Date(UTCPreviousInvoicePostingDate);
        }
        var today = new Date();
        var formatedold = today.setMonth(today.getMonth() - 12);
        var lastYear = new Date(formatedold);
        if (UTCPreviousInvoicePostingDate !== "") {
            var pDate = new Date(LatestDate);

            var currentYearFormated = new Date(CurrentYear);

            var turnOverId = "#" + str[0] + "_turnover";
            var oldValue = Number($(turnOverId).html());
            if (oldValue === 0) {
                $(turnOverId).html(totalAmount);
            }
            else {
                var Amount = Number(totalAmount) + Number(oldValue);
                $(turnOverId).html(Amount);
            }

        }
        if (UTCPreviousInvoicePostingDate !== "" && UTCPreviousInvoicePostingDate > lastYear)    //invoice exists within 6 months
        {
            var id = "#" + res;
            $(id).html('<img src="ss_green_Icon" class="image-class" />');
            var statusOptions = "#" + str[0] + "_status";
            $(statusOptions).html("");
            //var commentsId = "#" + str[0] + "_comments";
            //$(commentsId).html("");

            var invoiceDate = new Date(PreviousInvoicePostingDate).toDateString();
            var incoicecolumnId = "#" + str[0] + "_invoicedate"
            var prevValue = $(incoicecolumnId).html();
            if (prevValue !== "") {
                prevValue = new Date(prevValue).toUTCString();
                prevValue = new Date(prevValue);
                var newVal = new Date(invoiceDate).toUTCString();
                newVal = new Date(newVal);
                if (newVal > prevValue) {
                    $(incoicecolumnId).html(invoiceDate);
                }
            }
            else {
                $(incoicecolumnId).html(invoiceDate);
            }
        }
        if (contractexpiry !== "")   //invoice exists
        {
            var contractId = "#" + str[0] + "_contract";
            var colorid = "#" + res;
            var contDate = "#" + str[0] + "_contractdate"
            var UTCContractExpiry = new Date(contractexpiry).toUTCString();
            var UTCContactRaw = new Date(UTCContractExpiry);
            var newtoday = new Date();
            if (UTCContactRaw > newtoday)   //contract is not expired
            {
                $(contractId).html("<img class='tick' src='ss_tick'>");
            }
        }
    }
    function retireveRelatedStatus(name) {
        var accountExtraId = "";
        var req = new XMLHttpRequest();
        if (entityname === "") {
            req.open("GET", opener.Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.1/ss_accountcontractextras?$select=ss_accountcontractextraid,_ss_accountrelatedid_value,ss_name&$filter=ss_name eq '" + encodeURIComponent(name) + " ' and  _ss_accountcontractextra_value eq " + _Accountid, true);
        }
        else {
            req.open("GET", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras?$select=ss_accountcontractextraid,_ss_accountrelatedid_value,ss_name&$filter=ss_name eq '" + encodeURIComponent(name) + " ' and  _ss_accountcontractextra_value eq " + _Accountid, true);
        }
        req.setRequestHeader("OData-MaxVersion", "4.0");
        req.setRequestHeader("OData-Version", "4.0");
        req.setRequestHeader("Accept", "application/json");
        req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
        req.onreadystatechange = function () {
            if (this.readyState === 4) {
                req.onreadystatechange = null;
                if (this.status === 200) {
                    var results = JSON.parse(this.response);
                    for (var i = 0; i < results.value.length; i++) {
                        accountExtraId = results.value[i]["ss_accountcontractextraid"];

                    }
                } else {
                    if (entityname === "") {
                        // Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                    else {
                        // Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                }
            }
        };
        req.send();
        return accountExtraId;
    }
    function updateRecord(name, SelectVal, id) {
        var entity = {};
        SelectVal = Number(SelectVal);
        entity.ss_productstatus = SelectVal;

        var req = new XMLHttpRequest();
        if (entityname === "") {
            req.open("PATCH", opener.Xrm.Utility.getGlobalContext().getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + id + ")", true);
        }
        else
        {
            req.open("PATCH", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + id + ")", true);
        }
        req.setRequestHeader("OData-MaxVersion", "4.0");
        req.setRequestHeader("OData-Version", "4.0");
        req.setRequestHeader("Accept", "application/json");
        req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
        req.onreadystatechange = function () {
            if (this.readyState === 4) {
                req.onreadystatechange = null;
                if (this.status === 204) {
                    var str = name.split(" ");
                    var dateColumnId = "#" + str[0] + "_statusdate"
                    $(dateColumnId).html('today');
                    if (SelectVal === 1) {
                        var optionsetId = str[0] + "_" + id;
                        setCompetitors(str[0], 0, id)
                        //var competator = '<select id="' + optionsetId + '" onchange="return updateCompetitors(this);"><option value="0" selected ="selected" >None</option><option value="1">Nasdaq</option><option value="2">Pressetext</option><option value="3" >Investis</option><option value="4" >IR Asia</option></select>';
                        //     var competitorId = "#" + str[0] + "_competitor";
                        //   $(competitorId).html(competator);
                        var colorid = "#" + str[0] + "_color";
                        $(colorid).html('<img src="ss_orange" class="image-class" />');

                    }
                    else {
                        var competitorId = "#" + str[0] + "_competitor";
                        $(competitorId).html("");
                    }

                    // if (SelectVal === 3) {
                    //     var colorid = "#" + str[0] + "_color";
                    //     $(colorid).html('<img src="ss_yellow" class="image-class" />');

                    // }
                    if (SelectVal === 5) {
                        var colorid = "#" + str[0] + "_color";
                        $(colorid).html('<img src="ss_blue" class="image-class" />');

                    }
                    // if (SelectVal === 2 || SelectVal === 4) {
                    //     var colorid = "#" + str[0] + "_color";
                    //     $(colorid).html('<img src="ss_red_Icon" class="image-class" />');
                    // }
                    if (SelectVal === 0 || SelectVal === 2 ||SelectVal === 3 || SelectVal === 4 ) {
                        var colorid = "#" + str[0] + "_color";
                        $(colorid).html('<img src="ss_red_Icon" class="image-class" />');
                    }
                    // if (SelectVal === 0) {
                    //     var colorid = "#" + str[0] + "_color";
                    //     $(colorid).html('<img src="ss_grey" class="image-class" />');
                    // }
                } else {
                    if (entityname === "") {
                        // Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                    else
                    {
                        //parent.Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                }
            }
        };
        req.send(JSON.stringify(entity));
    }
    function createNewRecord(selectedItem, name) {
        var entity = {};
        entity["ss_accountcontractextra@odata.bind"] = "/accounts(" + _Accountid.replace("{", "").replace("}", "") + ")";
        entity.ss_name = name;
        entity.ss_productstatus = parseInt(selectedItem);
        entity.ss_competitor = parseInt(0);

        var req = new XMLHttpRequest();
        if (entityname === "") {
            req.open("POST", Xrm.Page.context.getClientUrl() + "/api/data/v8.0/ss_accountcontractextras", true);
        }
        else
        {
            req.open("POST", globelcontext.getClientUrl() + "/api/data/v8.0/ss_accountcontractextras", true);
        }
        req.setRequestHeader("OData-MaxVersion", "4.0");
        req.setRequestHeader("OData-Version", "4.0");
        req.setRequestHeader("Accept", "application/json");
        req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        req.onreadystatechange = function () {
            if (this.readyState === 4) {
                if (this.status === 204) {
                    var uri = this.getResponseHeader("OData-EntityId");
                    var regExp = /\(([^)]+)\)/;
                    var matches = regExp.exec(uri);
                    var newEntityId = matches[1];
                    var str = name.split(" ");
                    var dateColumnId = "#" + str[0] + "_statusdate"
                    $(dateColumnId).html('today');
                    if (selectedItem === 1 || selectedItem === "1") {
                        setCompetitors(str[0], 0, newEntityId);
                        //var optionsetId = str[0] + "_" + newEntityId;
                        //var competator = '<select id="' + optionsetId + '" onchange="return updateCompetitors(this);">' +
                        //  '<option value="0" >None</option>' +
                        //  '<option value="1" >Nasdaq</option>' +
                        //  '<option value="2">Pressetext</option>' +
                        //  '<option value="3" >Investis</option>' +
                        //  '<option value="4">IR Asia</option>' +
                        //  '</select>';
                        //var competitorId = "#" + str[0] + "_competitor";
                        //$(competitorId).html(competator);
                        var colorid = "#" + str[0] + "_color";
                        $(colorid).html('<img src="ss_orange" class="image-class" />');

                    }

                    // if (selectedItem === 3) {
                    //     var colorid = "#" + str[0] + "_color";
                    //     $(colorid).html('<img src="ss_yellow" class="image-class" />');

                    // }
                    if (selectedItem === 5) {
                        var colorid = "#" + str[0] + "_color";
                        $(colorid).html('<img src="ss_blue" class="image-class" />');

                    }
                    if (selectedItem === 0 || selectedItem === 2 || selectedItem === 3 || selectedItem === 4) {
                        var colorid = "#" + str[0] + "_color";

                        $(colorid).html('<img src="ss_red_Icon" class="image-class" />');
                    }
                    // if (selectedItem === 0) {
                    //     var colorid = "#" + str[0] + "_color";

                    //     $(colorid).html('<img src="ss_grey" class="image-class" />');
                    // }
                }
                else {
                    //alert(this.statusText);
                }
            }
        };
        req.send(JSON.stringify(entity));
    }
    function updateCompetitors(com) {
    //debugger;
        var id = com.id;
        var str = id.split("_");
        var recordId = str[1];
        var statusDate = "#" + str[0] + "_statusdate";
        var entity = {};
        var selectedValue = com.value;
        entity.ss_competitor = parseInt(selectedValue);

        var req = new XMLHttpRequest();
        if (entityname === "") {
            req.open("PATCH", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);
        }
        else {
            req.open("PATCH", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);

        }
        req.setRequestHeader("OData-MaxVersion", "4.0");
        req.setRequestHeader("OData-Version", "4.0");
        req.setRequestHeader("Accept", "application/json");
        req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
        req.onreadystatechange = function () {
            if (this.readyState === 4) {
                req.onreadystatechange = null;
                if (this.status === 204) {
                    $(statusDate).html('today');
                } else {
                    if (entityname === "") {
                        //opener.Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                    else {
                        //parent.Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                }
            }
        };
        req.send(JSON.stringify(entity));
    }
    function SaveUpdateRow(select_element, name) {
        var recordId = retireveRelatedStatus(name);
        var selectedValue = select_element.value;
        if (recordId === "" || recordId === undefined) {
            createNewRecord(selectedValue, name);
        }
        else {
            updateRecord(name, selectedValue, recordId);
        }
    }
    function showLoadingMessage() {
        msgDiv.style.display = "block";
    }
    function hideLoadingMessage() {
        msgDiv.style.display = "none";
    }
    function updateComments(text, name) {
        var value = text.value;
        if (value !== "") {
            var recordId = retireveRelatedStatus(name);
            if (recordId === "" || recordId === undefined) {
                var entity = {};
                entity.ss_name = name;
                entity["ss_accountcontractextra@odata.bind"] = "/accounts(" + _Accountid + ")";
                entity.ss_comments = value;
                entity.ss_productstatus = 0;
                entity.ss_competitor = 0;

                var req = new XMLHttpRequest();
                if (entityname === "") {
                    req.open("POST", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras", true);
                }
                else
                {
                    req.open("POST", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras", true);
                }
                req.setRequestHeader("OData-MaxVersion", "4.0");
                req.setRequestHeader("OData-Version", "4.0");
                req.setRequestHeader("Accept", "application/json");
                req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
                req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
                req.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        req.onreadystatechange = null;
                        if (this.status === 204) {
                            var uri = this.getResponseHeader("OData-EntityId");
                            var regExp = /\(([^)]+)\)/;
                            var matches = regExp.exec(uri);
                            var newEntityId = matches[1];

                        } else {
                            if (entityname === "") {
                                //opener.Xrm.Utility.alertDialog(this.statusText);
                                var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                                var alertOptions = { height: 120, width: 260 };
                                opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                                function success(result) {
                                    //console.log("Alert dialog closed");
                                },
                                function (error) {
                                    //console.log(error.message);
                                });
                            }
                            else {
                               // parent.Xrm.Utility.alertDialog(this.statusText);
                                var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                                var alertOptions = { height: 120, width: 260 };
                                parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                                function success(result) {
                                    //console.log("Alert dialog closed");
                                },
                                function (error) {
                                    //console.log(error.message);
                                });
                            }
                        }
                    }
                };
                req.send(JSON.stringify(entity));
            }
            else {
                var entity = {};

                entity.ss_comments = value;

                var req = new XMLHttpRequest();
                if (entityname === "") {
                    req.open("PATCH", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);
                }
                else {
                    req.open("PATCH", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);

                }
                req.setRequestHeader("OData-MaxVersion", "4.0");
                req.setRequestHeader("OData-Version", "4.0");
                req.setRequestHeader("Accept", "application/json");
                req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
                req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
                req.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        req.onreadystatechange = null;
                        if (this.status === 204) {
                            //Success - No Return Data - Do Something
                        } else {
                            if (entityname === "") {
                                //opener.Xrm.Utility.alertDialog(this.statusText);
                                var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                                var alertOptions = { height: 120, width: 260 };
                                opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                                function success(result) {
                                    //console.log("Alert dialog closed");
                                },
                                function (error) {
                                    //console.log(error.message);
                                });
                            }
                            else {
                               // parent.Xrm.Utility.alertDialog(this.statusText);
                                var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                                var alertOptions = { height: 120, width: 260 };
                                parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                                function success(result) {
                                    //console.log("Alert dialog closed");
                                },
                                function (error) {
                                    //console.log(error.message);
                                });
                            }
                        }
                    }
                };
                req.send(JSON.stringify(entity));
            }
        }
    }
    function updateContractStartDate(d, name) {
        var str = name.split(" ");
        if (d.value !== "") {
            var date = new Date(d.value).toISOString();
        }
        else
            var date = null;
        var recordId = retireveRelatedStatus(name);
        if (recordId === "" || recordId === undefined) {
            var entity = {};
            entity["ss_accountcontractextra@odata.bind"] = "/accounts(" + _Accountid.replace("{", "").replace("}", "") + ")";
            entity.ss_name = name;
            entity.ss_productstatus = parseInt(0);
            entity.ss_competitor = parseInt(0);
            entity.ss_contractstartingdate = date;
            var req = new XMLHttpRequest();
            if (entityname === "") {
                req.open("POST", Xrm.Page.context.getClientUrl() + "/api/data/v8.0/ss_accountcontractextras", true);
            }
            else {
                req.open("POST", globelcontext.getClientUrl() + "/api/data/v8.0/ss_accountcontractextras", true);

            }
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    if (this.status === 204) {
                        var uri = this.getResponseHeader("OData-EntityId");
                        var regExp = /\(([^)]+)\)/;
                        var matches = regExp.exec(uri);
                        var newEntityId = matches[1];
                        if (d.value !== "") {
                            var colorid = "#" + str[0] + "_color";
                            var competitoroption = "#" + str[0] + "_competitor";
                            var id = "#" + str[0] + "_status"; //_statusdate //_competitor

                            $(colorid).html('<img src="ss_green_Icon" class="image-class" />');
                            $(id).html('');
                            $(competitoroption).html('');
                            //TODO : update Account new field Product tiles
                        }
                    }
                    else {
                        //alert(this.statusText);
                    }
                }
            };
            req.send(JSON.stringify(entity));
        }
        else {
            var entity = {};

            entity.ss_contractstartingdate = date;

            var req = new XMLHttpRequest();
            if (entityname === "") {
                req.open("PATCH", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);
            }
            else
            {
                req.open("PATCH", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);

            }
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    req.onreadystatechange = null;
                    if (this.status === 204) {
                        //Success - No Return Data - Do Something
                        if (d.value !== "") {
                            var colorid = "#" + str[0] + "_color";
                            var competitoroption = "#" + str[0] + "_competitor";
                            var id = "#" + str[0] + "_status"; //_statusdate //_competitor

                            $(colorid).html('<img src="ss_green_Icon" class="image-class" />');
                            $(id).html('');
                            $(competitoroption).html('');
                        }
                    } else {
                        if (entityname === "") {
                            //opener.Xrm.Utility.alertDialog(this.statusText);
                            var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                            var alertOptions = { height: 120, width: 260 };
                            opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                            function success(result) {
                                //console.log("Alert dialog closed");
                            },
                            function (error) {
                                //console.log(error.message);
                            });
                        }
                        else {
                            //parent.Xrm.Utility.alertDialog(this.statusText);
                            var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                            var alertOptions = { height: 120, width: 260 };
                            parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                            function success(result) {
                                //console.log("Alert dialog closed");
                            },
                            function (error) {
                                //console.log(error.message);
                            });
                        }
                    }
                }
            };
            req.send(JSON.stringify(entity));
        }
    }
    function updateContractPeriod(period, name) {

        var period = period.value;

        var recordId = retireveRelatedStatus(name);
        if (recordId === "" || recordId === undefined) {
            var entity = {};
            entity["ss_accountcontractextra@odata.bind"] = "/accounts(" + _Accountid.replace("{", "").replace("}", "") + ")";
            entity.ss_name = name;
            entity.ss_productstatus = parseInt(0);
            entity.ss_competitor = parseInt(0);
            entity.ss_contractperiod = parseInt(period);
            var req = new XMLHttpRequest();
            if (entityname === "") {
                req.open("POST", Xrm.Page.context.getClientUrl() + "/api/data/v8.0/ss_accountcontractextras", true);
            }
            else
            {
                req.open("POST", globelcontext.getClientUrl() + "/api/data/v8.0/ss_accountcontractextras", true);
            }
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    if (this.status === 204) {
                        var uri = this.getResponseHeader("OData-EntityId");
                        var regExp = /\(([^)]+)\)/;
                        var matches = regExp.exec(uri);
                        var newEntityId = matches[1];

                    }
                    else {
                        //alert(this.statusText);
                    }
                }
            };
            req.send(JSON.stringify(entity));
        }
        else {
            var entity = {};
            entity.ss_contractperiod = parseInt(period);

            var req = new XMLHttpRequest();
            if (entityname === "") {
                req.open("PATCH", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);
            }
            else {
                req.open("PATCH", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);
            }
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    req.onreadystatechange = null;
                    if (this.status === 204) {
                        //Success - No Return Data - Do Something
                    } else {
                        if (entityname === "") {
                            //opener.Xrm.Utility.alertDialog(this.statusText);
                            var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                            var alertOptions = { height: 120, width: 260 };
                            opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                            function success(result) {
                                //console.log("Alert dialog closed");
                            },
                            function (error) {
                                //console.log(error.message);
                            });
                        }
                        else {
                            //parent.Xrm.Utility.alertDialog(this.statusText);
                            var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                            var alertOptions = { height: 120, width: 260 };
                            parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                            function success(result) {
                                //console.log("Alert dialog closed");
                            },
                            function (error) {
                                //console.log(error.message);
                            });
                        }
                    }
                }
            };
            req.send(JSON.stringify(entity));
        }
    }
    function updatecontractTermination(period, name) {
        var period = period.value;
        var recordId = retireveRelatedStatus(name);
        if (recordId === "" || recordId === undefined) {
            var entity = {};
            entity["ss_accountcontractextra@odata.bind"] = "/accounts(" + _Accountid.replace("{", "").replace("}", "") + ")";
            entity.ss_name = name;
            entity.ss_productstatus = parseInt(0);
            entity.ss_competitor = parseInt(0);
            entity.ss_terminationperiod = parseInt(period);
            var req = new XMLHttpRequest();
            if (entityname === "") {
                req.open("POST", Xrm.Page.context.getClientUrl() + "/api/data/v8.0/ss_accountcontractextras", true);
            }
            else {
                req.open("POST", globelcontext.getClientUrl() + "/api/data/v8.0/ss_accountcontractextras", true);

            }
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    if (this.status === 204) {
                        var uri = this.getResponseHeader("OData-EntityId");
                        var regExp = /\(([^)]+)\)/;
                        var matches = regExp.exec(uri);
                        var newEntityId = matches[1];

                    }
                    else {
                        //alert(this.statusText);
                    }
                }
            };
            req.send(JSON.stringify(entity));
        }
        else {
            var entity = {};
            entity.ss_terminationperiod = parseInt(period);
            var req = new XMLHttpRequest();
            if (entityname === "") {
                req.open("PATCH", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);
            }
            else {
                req.open("PATCH", globelcontext.getClientUrl() + "/api/data/v8.1/ss_accountcontractextras(" + recordId + ")", true);
            }
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    req.onreadystatechange = null;
                    if (this.status === 204) {
                        //Success - No Return Data - Do Something
                    } else {
                        if (entityname === "") {
                            //opener.Xrm.Utility.alertDialog(this.statusText);
                            var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                            var alertOptions = { height: 120, width: 260 };
                            opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                            function success(result) {
                                //console.log("Alert dialog closed");
                            },
                            function (error) {
                                //console.log(error.message);
                            });
                        }
                        else {
                           // parent.Xrm.Utility.alertDialog(this.statusText);
                            var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                            var alertOptions = { height: 120, width: 260 };
                            parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                            function success(result) {
                                //console.log("Alert dialog closed");
                            },
                            function (error) {
                                //console.log(error.message);
                            });
                        }
                    }
                }
            };
            req.send(JSON.stringify(entity));
        }
    }
    function addcurrencySymbol() {

        var allDivs = $(".turnOver");
        retrieveSymbol();
        for (var i = 0; i < allDivs.length; i++) {
            var inerVal = $(allDivs[i]).html();
            inerVal = Number(inerVal);
            inerVal = currencySymbol + (inerVal).formatMoney(2, DecimalSymbol, NumberSeparator);

            $(allDivs[i]).html(inerVal);
        }
    }
    function retrieveSymbol() {
        if (currencySymbolId !== "" && currencySymbolId !== undefined) {
            var req = new XMLHttpRequest();
            if (entityname === "") {
                req.open("GET", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/transactioncurrencies(" + currencySymbolId + ")?$select=currencysymbol", true);
            }
            else {
                req.open("GET", globelcontext.getClientUrl() + "/api/data/v8.1/transactioncurrencies(" + currencySymbolId + ")?$select=currencysymbol", true);

            }
            req.setRequestHeader("OData-MaxVersion", "4.0");
            req.setRequestHeader("OData-Version", "4.0");
            req.setRequestHeader("Accept", "application/json");
            req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
            req.onreadystatechange = function () {
                if (this.readyState === 4) {
                    req.onreadystatechange = null;
                    if (this.status === 200) {
                        var result = JSON.parse(this.response);
                        currencySymbol = result["currencysymbol"];
                        formatingSymbols();
                    } else {
                        if (entityname === "") {
                            //opener.Xrm.Utility.alertDialog(this.statusText);
                             var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                              var alertOptions = { height: 120, width: 260 };
                              opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                              function success(result) {
                                    //console.log("Alert dialog closed");
                               },
                               function (error) {
                                    //console.log(error.message);
                               });
                        }
                        else {
                            //parent.Xrm.Utility.alertDialog(this.statusText);
                              var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                              var alertOptions = { height: 120, width: 260 };
                              parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                              function success(result) {
                                    //console.log("Alert dialog closed");
                               },
                               function (error) {
                                    //console.log(error.message);
                               });
                        }
                    }
                }
            };
            req.send();
        } else {
            formatingSymbols();

        }
    }
    Number.prototype.formatMoney = function (c, d, t) {
        var n = this,
         //   c = isNaN(c = Math.abs(c)) ? 2 : c,
        //    d = d === undefined ? "." : d,
          //  t = t === undefined ? "," : t,
            s = n < 0 ? "-" : "",
            i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "",
            j = (j = i.length) > 3 ? j % 3 : 0;
        return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
    };
    function formatingSymbols() {
        //debugger;
        var userId = globelcontext.userSettings.userId.replace("}", "").replace("{", "");  ///parent.Xrm.Page.context.getUserId().replace("}", "").replace("{", "");

        var req = new XMLHttpRequest();
        if (entityname === "") {
            req.open("GET", Xrm.Page.context.getClientUrl() + "/api/data/v8.1/usersettingscollection?$select=decimalsymbol,numberseparator&$filter=systemuserid eq " + userId, true);
        }
        else {
            req.open("GET", globelcontext.getClientUrl() + "/api/data/v8.1/usersettingscollection?$select=decimalsymbol,numberseparator&$filter=systemuserid eq " + userId, true);
        }
        req.setRequestHeader("OData-MaxVersion", "4.0");
        req.setRequestHeader("OData-Version", "4.0");
        req.setRequestHeader("Accept", "application/json");
        req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
        req.onreadystatechange = function () {
            if (this.readyState === 4) {
                req.onreadystatechange = null;
                if (this.status === 200) {
                    var results = JSON.parse(this.response);
                    for (var i = 0; i < results.value.length; i++) {
                        DecimalSymbol = results.value[i]["decimalsymbol"];
                        NumberSeparator = results.value[i]["numberseparator"];

                    }
                } else {
                    if (entityname === "") {
                        //opener.Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        opener.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                    else {
                       // parent.Xrm.Utility.alertDialog(this.statusText);
                        var alertStrings = { confirmButtonLabel: "Ok", text:  this.statusText };
                        var alertOptions = { height: 120, width: 260 };
                        parent.Xrm.Navigation.openAlertDialog(alertStrings, alertOptions).then(
                        function success(result) {
                            //console.log("Alert dialog closed");
                        },
                        function (error) {
                            //console.log(error.message);
                        });
                    }
                }
            }
        };
        req.send();
    }
</script>



</body></html>